import{a as f}from"./chunk-G6P33L2Y.js";import{c as k}from"./chunk-5V4PC647.js";import{Ac as i,Bc as p,da as s,ia as d,j as u,k as a,qa as h,r as l,sa as b}from"./chunk-3AA7O2RR.js";function v(c,e){!e?.injector&&d(v);let t=e?.injector??s(h),n=new a(1),o=p(()=>{let r;try{r=c()}catch(m){i(()=>n.error(m));return}i(()=>n.next(r))},{injector:t,manualCleanup:!0});return t.get(b).onDestroy(()=>{o.destroy(),n.complete()}),n.asObservable()}var g=class{constructor(e,t,n,o,r){this.oauthUrl=e,this.tokenUrl=t,this.refreshUrl=n,this.logoutUrl=o,this.cookieName=r,this.POPUP_WIDTH=500,this.POPUP_HEIGHT=650,this.http=s(k),this.cookies=s(f),this.tokensRecieved=new u(null),this.tokensRecieved$=this.tokensRecieved.asObservable()}login(){this.http.get(`${this.oauthUrl}`,{withCredentials:!0}).subscribe({next:e=>{this.beginExchange(e)},error:e=>{console.log(e)}})}logout$(){return this.http.get(`${this.logoutUrl}`,{withCredentials:!0}).pipe(l(e=>(this.tokensRecieved.next(null),e)))}getTokens$(e){return this.http.get(`${this.tokenUrl}?code=${e}`,{withCredentials:!0})}refreshTokens$(e){return this.http.get(`${this.refreshUrl}?refreshToken=${e}`,{withCredentials:!0})}setTokenCookie(e,t){t?this.cookies.set(this.cookieName,e,t):this.cookies.set(this.cookieName,e)}getTokenCookie(){return this.cookies.get(this.cookieName)}deleteTokenCookie(){return this.cookies.delete(this.cookieName)}beginExchange(e){if(e&&e!=""){let t=window.open(e,"popup",`popup=true, width=${this.POPUP_WIDTH}, height=${this.POPUP_HEIGHT}`),n=this.tokensRecieved,o=function(r){r.data.access_token&&(n.next(r.data),window.removeEventListener("message",o))};window.addEventListener("message",o)}}};export{g as a,v as b};
