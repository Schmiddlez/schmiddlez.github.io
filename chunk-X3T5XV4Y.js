import{a as Me,b as Ee,c as ye}from"./chunk-IZTFWVE7.js";import{a as Pe,b as be}from"./chunk-COWYPX6I.js";import{a as y}from"./chunk-RZGKKGXP.js";import"./chunk-CRXCR2JF.js";import{a as Ce,b as _e,c as xe,d as F,e as ve,g as q,h as Se}from"./chunk-U54IN6QP.js";import"./chunk-YR2LWUA2.js";import{a as we,b as K}from"./chunk-TLFBGYCR.js";import{a as ue,b as M}from"./chunk-GSXTAEMJ.js";import{j as ee}from"./chunk-H2UTJKOZ.js";import{a as H,b as U,g as z,h as W,i as Z,j as J}from"./chunk-N7TBWEAR.js";import{a as P,c as me,d as x}from"./chunk-NPZLEDH6.js";import{O as le}from"./chunk-WTDRPXX3.js";import"./chunk-HU7WFQWJ.js";import{b as A,c as C,e as R,f as $,g as D,i as v,k as G,n as j,o as pe,p as ge,q as B,u as he,v as L,w as fe,y as b,z as E}from"./chunk-HUAPMYXL.js";import"./chunk-LUEFBJHU.js";import"./chunk-GT3HK5I6.js";import{d as de}from"./chunk-KVX4MIOR.js";import"./chunk-5V4PC647.js";import"./chunk-OOKV5ZR5.js";import{Da as V,F as ie,Fb as u,Lb as h,Mb as re,Nb as ae,Ob as X,Pb as Y,Qb as s,R as oe,Rb as o,Sb as w,Ub as N,Wb as p,Xb as d,_b as ce,ab as a,bb as T,da as f,gc as r,hc as m,ka as I,la as O,mb as _,qb as se,tb as g,ya as S,za as Q}from"./chunk-3AA7O2RR.js";function De(n,c){n&1&&(s(0,"mat-hint"),r(1,"Enter your current password"),o())}function ke(n,c){n&1&&(s(0,"mat-hint"),r(1,"Incorrect password"),o())}function Ve(n,c){if(n&1&&(s(0,"mat-hint"),r(1),o()),n&2){let e=d();a(),m(e.minLengthHint)}}function Ae(n,c){if(n&1&&(s(0,"mat-hint"),r(1),o()),n&2){let e=d();a(),m(e.invalidPasswordHint)}}function Re(n,c){if(n&1&&(s(0,"mat-hint"),r(1),o()),n&2){let e=d();a(),m(e.unconfirmedHint)}}var qe=(()=>{class n{constructor(){this.userService=f(y),this.data=Q.required(),this.onSuccess=S(),this.onFailure=S();let e=new v(void 0,[C.required,C.minLength(8),ye.invalidPassword()]),t=new v(void 0,[C.required,this.passwordConfirmed(e)]);this.passwordForm=new D({currentPassword:new v(void 0,[C.required]),newPassword:e,confirmPassword:t})}ngOnInit(){}get currentPassword(){return this.passwordForm.controls.currentPassword}get newPassword(){return this.passwordForm.controls.newPassword}get confirmPassword(){return this.passwordForm.controls.confirmPassword}get minLengthHint(){return`Min Length: ${this.newPassword.getError("minlength").requiredLength}`}get invalidPasswordHint(){return`Invalid Character(s): ${this.newPassword.getError("invalidPassword").invalidCharacters.map(t=>`'${t}'`).join(", ")}`}get unconfirmedHint(){return this.confirmPassword.getError("notMatching").value}changePassword(){let e=this.passwordForm.controls.currentPassword.value,t=this.passwordForm.controls.newPassword.value,i=this.passwordForm.controls.confirmPassword.value;this.userService.changePassword$(e,t,i).subscribe({next:l=>this.handleSuccess(l),error:l=>this.handleError(l)})}handleSuccess(e){e.message=="success"?this.onSuccess.emit("success"):e.message=="invalid password"&&this.currentPassword.setErrors({incorrectPassword:"incorrect password"})}handleError(e){e.status==403?this.currentPassword.setErrors({incorrectPassword:"incorrect password"}):e.status==400&&this.currentPassword.setErrors({bad:e.error.message}),this.onFailure.emit("failure")}passwordConfirmed(e){return t=>t.value==e.value?null:{notMatching:{value:"Passwords do not match"}}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=_({type:n,selectors:[["change-password"]],inputs:{data:[1,"data"]},outputs:{onSuccess:"onSuccess",onFailure:"onFailure"},decls:26,vars:5,consts:[[1,"change-password",3,"formGroup"],["appearance","outline",1,"settings-input"],["formControlName","currentPassword","type","password","matInput","","maxlength","256","placeholder","Password...","cdkFocusInitial",""],["formControlName","newPassword","type","password","matInput","","maxlength","256","placeholder","Password..."],["formControlName","confirmPassword","type","password","matInput","","maxlength","256","placeholder","Password..."],[1,"change-buttons"],["mat-flat-button","",1,"change-btn","confirm",3,"click","disabled"],["mat-flat-button","","mat-dialog-close","",1,"change-btn","cancel"]],template:function(t,i){t&1&&(s(0,"form",0)(1,"div")(2,"mat-form-field",1)(3,"mat-label"),r(4,"Current Password"),o(),w(5,"input",2),g(6,De,2,0,"mat-hint")(7,ke,2,0,"mat-hint"),o()(),s(8,"div")(9,"mat-form-field",1)(10,"mat-label"),r(11,"New Password"),o(),w(12,"input",3),g(13,Ve,2,1,"mat-hint")(14,Ae,2,1,"mat-hint"),o()(),s(15,"div")(16,"mat-form-field",1)(17,"mat-label"),r(18,"Confirm Password"),o(),w(19,"input",4),g(20,Re,2,1,"mat-hint"),o()(),s(21,"div",5)(22,"button",6),p("click",function(){return i.changePassword()}),r(23,"Confirm"),o(),s(24,"button",7),r(25,"Cancel"),o()()()),t&2&&(u("formGroup",i.passwordForm),a(6),h(i.currentPassword.hasError("required")?6:i.currentPassword.hasError("incorrectPassword")?7:-1),a(7),h(i.newPassword.hasError("minlength")?13:i.newPassword.hasError("invalidPassword")?14:-1),a(7),h(i.confirmPassword.hasError("notMatching")?20:-1),a(2),u("disabled",i.passwordForm.invalid))},dependencies:[b,G,A,R,$,L,q,F,M,x,P,J,Z,z,H,U,K,W,E,j,B],styles:[".change-password[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;justify-content:center}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.settings-input[_ngcontent-%COMP%]{width:100%}.change-buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:1rem;justify-content:space-between}.change-btn[_ngcontent-%COMP%]{flex:1;border:2px solid;border-radius:3px}.change-btn[_ngcontent-%COMP%]:hover{background-color:#dcdcdc!important;color:#000}.cancel[_ngcontent-%COMP%]{border-color:#646464;background-color:#646464}.confirm[_ngcontent-%COMP%]{border-color:#4682b4;background-color:#4682b4}"]})}}return n})();function $e(n,c){n&1&&(s(0,"mat-hint"),r(1,"Enter your current password"),o())}function Ge(n,c){n&1&&(s(0,"mat-hint"),r(1,"Incorrect password"),o())}function je(n,c){if(n&1&&(s(0,"mat-option",9),r(1),o()),n&2){let e=d().$index,t=d();u("value",t.myQuestion(e)),a(),m(t.myQuestion(e))}}function Be(n,c){if(n&1&&(s(0,"mat-option",9),r(1),o()),n&2){let e=c.$implicit;u("value",e),a(),m(e)}}function Le(n,c){n&1&&(s(0,"mat-hint"),r(1,"Enter answer"),o())}function He(n,c){if(n&1){let e=N();s(0,"div",4)(1,"mat-select",8),p("selectionChange",function(){I(e);let i=d();return O(i.updateRemainingQuestions())}),g(2,je,2,2,"mat-option",9),X(3,Be,2,2,"mat-option",9,ae),o(),s(5,"mat-form-field",1)(6,"mat-label"),r(7,"Answer"),o(),w(8,"input",10),g(9,Le,2,0,"mat-hint"),o()()}if(n&2){let e=c.$index,t=d();ce("formGroupName",e),a(2),h(t.myQuestion(e)?2:-1),a(),Y(t.remainingQuestions()),a(6),h(-1)}}var Ie=(()=>{class n{constructor(){this.userService=f(y),this.numberQuestions=Ee.NUMBER_REGISTRATION_QUESTIONS,this.questions=Q.required(),this.data=Q.required(),this.onSuccess=S(),this.onFailure=S(),this.remainingQuestions=V([]);let e=new D({currentPassword:new v(void 0,C.required),questions:new fe([])});for(let t=0;t<this.numberQuestions;t++)e.controls.questions.push(new D({question:new v(void 0,{nonNullable:!0,validators:C.required}),answer:new v(void 0,{nonNullable:!0,validators:C.required})}));this.questionsForm=e}ngOnInit(){this.remainingQuestions.set([...this.questions()])}getQuestion(e,t){return t?this.questionsFormArray.at(e).controls.answer:this.questionsFormArray.at(e).controls.question}myQuestion(e){return this.getQuestion(e).value}updateRemainingQuestions(){let e=[...this.questions()];for(let t=0;t<this.numberQuestions;t++){let i=this.getQuestion(t).value,l=e.findIndex(k=>k==i);l>-1&&e.splice(l,1)}this.remainingQuestions.set(e)}changeQuestions(){let e=this.currentPassword.value?this.currentPassword.value.trim():this.currentPassword.value,t=[];for(let i=0;i<this.numberQuestions;i++){let l=this.getQuestion(i).value,k=this.getQuestion(i,!0).value;k&&t.push({question:l,answer:k.trim()})}this.userService.changeQuestions$(e,t).subscribe({next:i=>this.handleSuccess(i),error:i=>this.handleError(i)})}handleSuccess(e){e.message=="success"&&this.onSuccess.emit("success")}handleError(e){e.status==403?this.currentPassword.setErrors({incorrectPassword:"incorrect password"}):e.status==400&&this.currentPassword.setErrors({bad:e.error.message}),this.onFailure.emit("failure")}get currentPassword(){return this.questionsForm.controls.currentPassword}get questionsFormArray(){return this.questionsForm.get("questions")}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=_({type:n,selectors:[["change-questions"]],inputs:{questions:[1,"questions"],data:[1,"data"]},outputs:{onSuccess:"onSuccess",onFailure:"onFailure"},decls:16,vars:3,consts:[[1,"change-question",3,"formGroup"],["appearance","outline",1,"settings-input"],["formControlName","currentPassword","type","password","matInput","","maxlength","256","placeholder","Password...","cdkFocusInitial",""],["formArrayName","questions",1,"questions"],[1,"input-group",3,"formGroupName"],[1,"change-buttons"],["mat-flat-button","",1,"change-btn","confirm",3,"click","disabled"],["mat-flat-button","","mat-dialog-close","",1,"change-btn","cancel"],["formControlName","question","placeholder","Select a Question","required","",3,"selectionChange"],[3,"value"],["formControlName","answer","type","password","matInput","","maxlength","256","placeholder","Answer...","required",""]],template:function(t,i){t&1&&(s(0,"form",0)(1,"div")(2,"mat-form-field",1)(3,"mat-label"),r(4,"Current Password"),o(),w(5,"input",2),g(6,$e,2,0,"mat-hint")(7,Ge,2,0,"mat-hint"),o()(),s(8,"div",3),X(9,He,10,3,"div",4,re),o(),s(11,"div",5)(12,"button",6),p("click",function(){return i.changeQuestions()}),r(13,"Confirm"),o(),s(14,"button",7),r(15,"Cancel"),o()()()),t&2&&(u("formGroup",i.questionsForm),a(6),h(i.currentPassword.hasError("required")?6:i.currentPassword.hasError("incorrectPassword")?7:-1),a(3),Y(i.questionsFormArray.controls),a(3),u("disabled",i.questionsForm.invalid))},dependencies:[b,G,A,R,$,he,L,q,F,M,x,P,J,Z,z,H,U,K,we,le,W,E,j,B,pe,ge],styles:[".change-question[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;justify-content:center}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.settings-input[_ngcontent-%COMP%]{width:100%}.change-buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:1rem;justify-content:space-between}.change-btn[_ngcontent-%COMP%]{flex:1;border:2px solid;border-radius:3px}.change-btn[_ngcontent-%COMP%]:hover{background-color:#dcdcdc!important;color:#000}.cancel[_ngcontent-%COMP%]{border-color:#646464;background-color:#646464}.confirm[_ngcontent-%COMP%]{border-color:#4682b4;background-color:#4682b4}.questions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}"]})}}return n})();function Ue(n,c){if(n&1){let e=N();s(0,"change-password",7),p("onSuccess",function(){I(e);let i=d();return O(i.onPasswordSuccess())}),o()}if(n&2){let e=d();u("data",e.data)}}function ze(n,c){if(n&1){let e=N();s(0,"change-questions",8),p("onSuccess",function(){I(e);let i=d();return O(i.onQuestionSuccess())}),o()}if(n&2){let e=d();u("questions",e.questions())("data",e.data)}}function We(n,c){}var Oe=(()=>{class n extends Se{constructor(e,t){super(),this.data=e,this.dialogRef=t,this.invalidRegex=/[^A-Za-z0-9?!@#$%&.?!:;]/,this.questions=V([]),this.data.questions&&(this.questions=this.data.questions)}ngOnInit(){}onQuestionSuccess(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!0})}onPasswordSuccess(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!0})}close(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!1})}get headerTitle(){return`Change ${this.capAllWords(this.data.setting)}`}capAllWords(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.substring(1)).join(" ")}static{this.\u0275fac=function(t){return new(t||n)(T(_e),T(Ce))}}static{this.\u0275cmp=_({type:n,selectors:[["change-settings"]],features:[se],decls:11,vars:2,consts:[[1,"change-settings"],[1,"change-header"],["mat-icon-button","","mat-dialog-close","",1,"change-cancel"],["fontIcon","close"],[1,"change-title"],[3,"data"],[3,"questions","data"],[3,"onSuccess","data"],[3,"onSuccess","questions","data"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"button",2),w(3,"mat-icon",3),o(),s(4,"div",4)(5,"h5"),r(6),o()()(),s(7,"mat-dialog-content"),g(8,Ue,1,1,"change-password",5)(9,ze,1,2,"change-questions",6)(10,We,0,0),o()()),t&2&&(a(6),m(i.headerTitle),a(2),h(i.data.setting=="password"?8:i.data.setting=="questions"?9:i.data.setting=="password-reset"?10:-1))},dependencies:[b,q,F,ve,M,ue,x,me,E,Ie,qe],styles:[".change-settings[_ngcontent-%COMP%]{width:100vw;max-width:560px;padding:.1rem 0rem;box-sizing:border-box}.change-header[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:2rem;align-items:center;padding:.5rem 1rem;border-bottom:1px solid rgba(30,30,30,.75)}.change-content[_ngcontent-%COMP%]{padding:.5rem 1rem}.change-title[_ngcontent-%COMP%]{font-size:1.25rem}@media (max-width:600px){.change-settings[_ngcontent-%COMP%]{width:80vw}}"]})}}return n})();var zt=(()=>{class n{constructor(e){this.router=e,this.userService=f(y),this.userVerifyService=f(be),this.sessionService=f(Pe),this.dialog=f(xe),this.subs=[],this.me=this.userService.me$,this.questions=this.userVerifyService.questions$,this.validSecuredSessionCheck=setInterval(()=>{this.userVerifyService.isSecured$().subscribe(i=>this.securedCheck(i))},1e3*60*1);let t=this.sessionService.securedSession$.pipe(oe(1)).subscribe(i=>this.checkSession(i));this.subs.push(t)}ngOnInit(){}ngOnDestroy(){clearInterval(this.validSecuredSessionCheck);for(let e of this.subs)e.unsubscribe()}securedCheck(e){e||this.sessionService.sessionExpired("secured")}checkSession(e){!e&&this.sessionExpiredDialogRef==null&&(this.sessionExpiredDialogRef=this.dialog.open(Me,{disableClose:!0,restoreFocus:!1,scrollStrategy:new ee,data:{session:"secured",state:this.router.routerState.snapshot}}),this.sessionExpiredDialogRef.afterClosed().subscribe(t=>{this.sessionExpiredDialogRef=void 0}))}changeSetting(e){this.dialog.open(Oe,{restoreFocus:!1,scrollStrategy:new ee,closeOnNavigation:!0,data:{user:this.me(),setting:e,questions:this.questions}}).afterClosed().pipe(ie(1)).subscribe(i=>{i&&i.hasChanged&&console.log(`${e} changed`)})}static{this.\u0275fac=function(t){return new(t||n)(T(de))}}static{this.\u0275cmp=_({type:n,selectors:[["sns-settings"]],decls:34,vars:2,consts:[[1,"main-content"],[1,"sns-settings"],[1,"settings-index"],[1,"settings-content"],[1,"settings-group"],[1,"group-header"],[1,"group-content"],[1,"group-item"],[1,"item-title"],[1,"username"],[1,"displayName"],["mat-flat-button","",1,"change-btn",3,"click"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),r(4,"Profile"),o(),s(5,"div"),r(6,"Account"),o(),s(7,"div"),r(8,"Logout"),o()(),s(9,"div",3)(10,"div",4)(11,"div",5),r(12,"Account Settings"),o(),s(13,"div",6)(14,"div",7)(15,"div",8),r(16,"Username"),o(),s(17,"div",9),r(18),o()(),s(19,"div",7)(20,"div",8),r(21,"Display name"),o(),s(22,"div",10),r(23),o()(),s(24,"div",7)(25,"div",8),r(26,"Password"),o(),s(27,"button",11),p("click",function(){return i.changeSetting("password")}),r(28,"Change Password"),o()(),s(29,"div",7)(30,"div",8),r(31,"Security Questions"),o(),s(32,"button",11),p("click",function(){return i.changeSetting("questions")}),r(33,"Change Questions"),o()()()()()()()),t&2&&(a(18),m("@"+i.me().username),a(5),m(i.me().displayName))},dependencies:[x,P],styles:[".main-content[_ngcontent-%COMP%]{max-width:calc(var(--sns-main-content-max-width) + var(--sns-side-content-max-width))!important}.sns-settings[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:6rem;padding:6rem 0rem}.settings-index[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-end;flex-direction:column;min-width:10rem}.settings-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.group-header[_ngcontent-%COMP%]{font-size:1.75rem;border-bottom:1px solid var(--sns-username-color)}.group-item[_ngcontent-%COMP%]{padding:1rem 2rem;border-bottom:1px solid var(--sns-username-color)}.item-title[_ngcontent-%COMP%]{font-size:1.25rem}.username[_ngcontent-%COMP%]{color:var(--sns-username-color)}.change-btn[_ngcontent-%COMP%]{border-radius:3px}@media (max-width:1080px){.main-content[_ngcontent-%COMP%]{max-width:var(--sns-main-content-max-width)!important;padding-right:1rem}}"]})}}return n})();export{zt as SnsSettingsComponent};
