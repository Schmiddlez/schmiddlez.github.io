import{c as b}from"./chunk-2ZA7EJYY.js";import{da as i,ia as a,k as o,qa as l,sa as d,xc as c,yc as h}from"./chunk-6543YJRO.js";function v(u,e){!e?.injector&&a(v);let n=e?.injector??i(l),t=new o(1),s=h(()=>{let r;try{r=u()}catch(f){c(()=>t.error(f));return}c(()=>t.next(r))},{injector:n,manualCleanup:!0});return n.get(d).onDestroy(()=>{s.destroy(),t.complete()}),t.asObservable()}var p=class{constructor(e,n,t){this.oauthUrl=e,this.tokenUrl=n,this.refreshUrl=t,this.POPUP_WIDTH=500,this.POPUP_HEIGHT=650,this.http=i(b),this.tokensRecieved=new o(1),this.tokensRecieved$=this.tokensRecieved.asObservable()}login(){this.http.get(`${this.oauthUrl}`,{withCredentials:!0}).subscribe({next:e=>{this.beginExchange(e)},error:e=>{}})}getTokens$(e){return this.http.get(`${this.tokenUrl}?code=${e}`,{withCredentials:!0})}refreshTokens$(e){return this.http.get(`${this.refreshUrl}?refreshToken=${e}`,{withCredentials:!0})}beginExchange(e){if(e&&e!=""){let n=window.open(e,"popup",`popup=true, width=${this.POPUP_WIDTH}, height=${this.POPUP_HEIGHT}`),t=this.tokensRecieved,s=function(r){r.data.access_token&&(t.next(r.data),window.removeEventListener("message",s))};window.addEventListener("message",s)}}};export{p as a,v as b};
