import{a as j,b as D}from"./chunk-R4JIVO77.js";import{C as M,b as T,f as E,g as O,l as U,o as x,r as N,t as A,u as L}from"./chunk-ESTKDGOR.js";import{a as I}from"./chunk-C5RMYWSX.js";import{m as w}from"./chunk-MB2EZ7OD.js";import{$ as u,Fa as l,H as p,Ib as i,P as h,Rb as R,Sb as S,Tb as o,Ub as n,Vb as m,Zb as b,cb as d,db as v,fa as _,jc as C,k as y,pb as $,r as c}from"./chunk-UUT3EF6T.js";var f=class{constructor(a){this.MAX_RETRY_COUNT=0,this.DELAY_COUNT=3e3,this.loaService=_(j),this.toastService=_(I),this.resourceUrl=a}get(a){return this.loaService.get(a)}post(a,e){return this.loaService.post(a,e)}delete(a){return this.loaService.delete(a)}getAll(){return this.get(this.resourceUrl)}getById(a){return this.get(`${this.resourceUrl}/${a}`)}create(a){return this.post(this.resourceUrl,a)}update(a,e){return this.post(`${this.resourceUrl}/${a}`,e)}deleteById(a){return this.delete(`${this.resourceUrl}/${a}`)}};var ee=(()=>{class s extends f{constructor(){super("/characters"),this.loaClasses=l([]),this.loaClasses$=this.loaClasses.asReadonly(),this.character=l(void 0),this.character$=this.character.asReadonly(),this.characterChanged=new y,this.characterChanges$=this.characterChanged.asObservable(),this.signupChanged=new y(1),this.signupChanges$=this.signupChanged.asObservable(),this.get(`${this.resourceUrl}/classes`).pipe(h(this.MAX_RETRY_COUNT),p(this.DELAY_COUNT)).subscribe({next:e=>{this.loaClasses.set(e)},error:e=>{console.log(e),this.toastService.show({header:"Error",body:"An unexpected error has occured.",type:"danger",source_feature:"loa-assistant"})}})}characterChange(e,t){this.characterChanged.next({character:e,change:t})}addCharacter(e){this.create(e).subscribe({next:t=>{this.characterChange(t,"edit"),this.toastService.show({header:"Character",body:`Character '${t.name}' updated!`,type:"success",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Character",body:`Failed to save '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}editCharacter(e){this.update(e.id,e).subscribe({next:t=>{this.characterChange(t,"edit"),this.toastService.show({header:"Character",body:`Character '${t.name}' updated!`,type:"success",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Character",body:`Failed to save '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}deleteCharacter(e){this.deleteById(e.id).subscribe({next:()=>{this.characterChange(e,"delete"),this.toastService.show({header:"Character",body:`Character '${e.name}' deleted!`,type:"warning",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Character",body:`Failed to delete '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}signupChange(e){this.signupChanged.next(e)}signup(e){this.post(`/characters/${e.id}/raids`,e.raids).pipe(c(t=>t)).subscribe({next:t=>{this.characterChange(t,"signup"),this.toastService.show({header:"Character",body:`Character '${t.name}' updated!`,type:"success",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Character",body:`Failed to save '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}signupRepeat(e){this.post(`/characters/${e.id}/repeats`,e.repeats).pipe(c(t=>t)).subscribe({next:t=>{this.characterChange(t,"signup"),this.toastService.show({header:"Character",body:`Character '${t.name}' updated!`,type:"success",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Character",body:`Failed to save '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var Y=(()=>{class s extends f{constructor(){super("/raids"),this.loaRaids=l([]),this.loaRaids$=this.loaRaids.asReadonly(),this.raidpost=l(void 0),this.raidpost$=this.raidpost.asReadonly(),this.myRaids=l([]),this.myRaids$=this.myRaids.asReadonly(),this.myRepeats=l([]),this.myRepeats$=this.myRepeats.asReadonly(),this.raidChanged=new y,this.raidChanges$=this.raidChanged.asObservable(),this.get(`${this.resourceUrl}/raids`).pipe(h(this.MAX_RETRY_COUNT),p(this.DELAY_COUNT)).subscribe({next:e=>{this.loaRaids.set(e)},error:e=>{console.log(e),this.toastService.show({header:"Error",body:"An unexpected error has occured.",type:"danger",source_feature:"loa-assistant"})}})}raidpostChange(e,t){this.raidChanged.next({raidpost:e,change:t})}getMyRaids(){this.get("/players/@me/raids?all=true").pipe(h(this.MAX_RETRY_COUNT),p(this.DELAY_COUNT)).subscribe({next:e=>{this.myRaids.set(e)},error:e=>{console.log(e),e.error.message=="Please login again"?this.toastService.show({header:"Error",body:"Please Re-Login / Refresh",type:"danger",source_feature:"loa-assistant",link:"loa-assistant/login",delay:7500}):this.toastService.show({header:"Error",body:"An unexpected error has occured. Failed to rerieve user's raids",type:"danger",source_feature:"loa-assistant"})}})}getMyRepeats(){this.get("/players/@me/repeats?all=true").pipe(h(this.MAX_RETRY_COUNT),p(this.DELAY_COUNT)).subscribe({next:e=>{this.myRepeats.set(e)},error:e=>{console.log(e),e.error.message=="Please login again"?this.toastService.show({header:"Error",body:"Please Re-Login / Refresh",type:"danger",source_feature:"loa-assistant",link:"loa-assistant/login",delay:7500}):this.toastService.show({header:"Error",body:"An unexpected error has occured. Failed to rerieve user's repeating raidposts",type:"danger",source_feature:"loa-assistant"})}})}addPost(e){this.create(e).subscribe({next:t=>{t.type=="raidpost"?this.myRaids.update(r=>[...r,t]):this.myRepeats.update(r=>[...r,t]),this.raidpostChange(t,"add"),this.toastService.show({header:"Raidpost",body:`Raidpost '${t.name}' added!`,type:"success",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Raidpost",body:`Failed to add '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}editPost(e){this.update(e.id,e).subscribe({next:t=>{this.raidpostChange(t,"edit"),this.toastService.show({header:"Raidpost",body:`Raidpost '${t.name}' updated!`,type:"success",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Raidpost",body:`Failed to save '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}deletePost(e){this.deleteById(e.id).subscribe({next:()=>{this.raidpostChange(e,"delete"),this.toastService.show({header:"Raidpost",body:`Raidpost '${e.name}' deleted!`,type:"warning",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Raidpost",body:`Failed to delete '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}signup(e){this.post(`/raids/${e.id}/signups`,e.signups).pipe(c(t=>t)).subscribe({next:t=>{this.raidpostChange(t,"signup"),this.toastService.show({header:"Raidpost",body:`Raidpost '${t.name}' updated!`,type:"success",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Raidpost",body:`Failed to save '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}groups(e){this.post(`/raids/${e.id}/groups`,e.groups).pipe(c(t=>t)).subscribe({next:t=>{console.log(t),this.raidpostChange(t,"groups"),this.toastService.show({header:"Raidpost",body:`Raidpost '${t.name}' updated!`,type:"success",source_feature:"loa-assistant"})},error:t=>{console.log(t),this.toastService.show({header:"Raidpost",body:`Failed to save '${e.name}'`,type:"danger",source_feature:"loa-assistant"})}})}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var P=(()=>{class s{constructor(){this.raidFilterId=0,this.groupId=0}get nextRaidFilterId(){return this.raidFilterId++}get nextGroupId(){return this.groupId--}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var G=(s,a)=>a.id;function B(s,a){if(s&1&&m(0,"option",6),s&2){let e=a.$implicit;i("value",e.name)}}function V(s,a){if(s&1&&m(0,"option",6),s&2){let e=a.$implicit;i("value",e.name)}}var ce=(()=>{class s{constructor(e,t,r){this.idGen=e,this.playerService=t,this.raidService=r,this.subs=[],this.raids=this.raidService.loaRaids$,this.servers=this.playerService.myServers$}ngOnInit(){this.myId=this.idGen.nextRaidFilterId}ngOnDestroy(){for(let e of this.subs)e.unsubscribe()}focused(e){this.filterForm.controls[e].setValue("")}any(e){let t=this.filterForm.controls[e];this.inputInDataList(t.value,e)||t.setValue("Any")}select(e){console.log(e)}inputInDataList(e,t){switch(t){case"raid":return this.raids().map(r=>r.name).includes(e)||!1;case"server":return this.servers().map(r=>r.name).includes(e)||!1;case"status":return["Any","Signed Up","Not Signed Up"].includes(e)}return!1}static{this.\u0275fac=function(t){return new(t||s)(v(P),v(D),v(Y))}}static{this.\u0275cmp=$({type:s,selectors:[["raid-filter"]],inputs:{player:"player",servers:"servers",filterForm:"filterForm",raids:"raids"},decls:25,vars:7,consts:[[1,"d-flex","gap-2","p-2","raid-filter",3,"formGroup"],[1,"form-floating"],["formControlName","raid","list","raidFilterOptions","placeholder","Raid",1,"form-control","form-control-sm",3,"focus","blur","id"],[3,"for"],["id","raidFilterOptions"],["value","Any"],[3,"value"],["formControlName","server","list","serverFilterOptions","placeholder","Server",1,"form-control","form-control-sm",3,"focus","blur","id"],["id","serverFilterOptions"],["formControlName","status","list","statusFilterOptions","placeholder","Signed Up",1,"form-control","form-control-sm",3,"focus","blur","id"],["id","statusFilterOptions"],["value","Signed Up"],["value","Not Signed Up"]],template:function(t,r){t&1&&(o(0,"form",0)(1,"div",1)(2,"input",2),b("focus",function(){return r.focused("raid")})("blur",function(){return r.any("raid")}),n(),o(3,"label",3),C(4,"Raid"),n(),o(5,"datalist",4),m(6,"option",5),R(7,B,1,1,"option",6,G),n()(),o(9,"div",1)(10,"input",7),b("focus",function(){return r.focused("server")})("blur",function(){return r.any("server")}),n(),o(11,"label",3),C(12,"Server"),n(),o(13,"datalist",8),m(14,"option",5),R(15,V,1,1,"option",6,G),n()(),o(17,"div",1)(18,"input",9),b("focus",function(){return r.focused("status")})("blur",function(){return r.any("status")}),n(),o(19,"label",3),C(20,"Status"),n(),o(21,"datalist",10),m(22,"option",5)(23,"option",11)(24,"option",12),n()()()),t&2&&(i("formGroup",r.filterForm),d(2),i("id","raidFilter"+r.myId),d(),i("for","raidFilter"+r.myId),d(4),S(r.raids()),d(3),i("id","serverFilter"+r.myId),d(),i("for","serverFilter"+r.myId),d(4),S(r.servers()),d(3),i("id","statusFilter"+r.myId),d(),i("for","statusFilter"+r.myId))},dependencies:[w,M,U,A,L,T,E,O,x,N],styles:[".raid-filter[_ngcontent-%COMP%]{background-color:var(--discord-menu)}"]})}}return s})();export{ee as a,Y as b,P as c,ce as d};
