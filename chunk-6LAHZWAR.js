import{a as y}from"./chunk-LE6ER5HQ.js";import{a as m}from"./chunk-R7EBFGLF.js";import{c}from"./chunk-B6GQN5TU.js";import{Ca as o,G as l,N as n,Z as a,ca as i,r as p,vc as h}from"./chunk-X7EC65UH.js";var d=(()=>{class s{constructor(e){this.http=e,this.baseUrl=m.loa()+"/api",this.options={}}get(e){return this.http.get(this.baseUrl+e,this.options)}post(e,r){return this.http.post(this.baseUrl+e,r,this.options)}delete(e){return this.http.delete(this.baseUrl+e,this.options)}getHttpClient(){return this.http}static{this.\u0275fac=function(r){return new(r||s)(i(c))}}static{this.\u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var $=(()=>{class s{constructor(e,r){this.loaService=e,this.toastService=r,this.MAX_RETRY_COUNT=0,this.DELAY_COUNT=3e3,this.player=o(void 0),this.player$=this.player.asReadonly(),this.me=o(void 0),this.me$=this.me.asReadonly(),this.myCharacters$=h(()=>this.me$()?.characters||[]),this.myServers=o([]),this.myServers$=this.myServers.asReadonly(),this.myRaids$=h(()=>this.myServers$().flatMap(t=>t.raids)),this.myRepeats$=h(()=>this.myServers$().flatMap(t=>t.repeats)),this.loaService.get("/players/@me").pipe(n(this.MAX_RETRY_COUNT),l(this.DELAY_COUNT)).subscribe({next:t=>{this.me.set(t)},error:t=>{console.log(t),this.toastService.show({header:"Player",body:"Failed to get player data",type:"danger",source_feature:"loa-assistant"})}}),this.loaService.get("/players/@me/servers").pipe(n(this.MAX_RETRY_COUNT),l(this.DELAY_COUNT)).subscribe({next:t=>{this.myServers.set(t)},error:t=>{console.log(t),t.error.message=="Please login again"?this.toastService.show({header:"Error",body:"Please Re-Login / Refresh",type:"danger",source_feature:"loa-assistant",link:"loa-assistant/login",delay:7500}):this.toastService.show({header:"Player",body:"Failed to get player's servers",type:"danger",source_feature:"loa-assistant"})}})}updateMe(e){this.me.set(e)}getPlayer$(e){return this.loaService.get(`/players/${e}`)}setPlayer(e){this.player.set(e)}logout(e){return this.loaService.post("/logout",e.id).pipe(p(r=>r))}static{this.\u0275fac=function(r){return new(r||s)(i(d),i(y))}}static{this.\u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{d as a,$ as b};
