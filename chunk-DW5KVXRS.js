import{a as mt,b as pt,c as dt,d as gt,f as ut,g as ht,h as ft,i as xt}from"./chunk-ZFOFE4YQ.js";import{a as P}from"./chunk-LUY36RVE.js";import{a as Ct,b as vt,c as Mt,d as _t,e as Pt,f as wt,g as Ot}from"./chunk-INS7BFHF.js";import{j as lt}from"./chunk-3PMNG65X.js";import{a as nt,b as it,g as rt,h as at,i as st,j as ct}from"./chunk-4P6JCT6G.js";import{B as et,C as ot,b as q,f as J,g as K,i as W,k as X,l as Z,y as tt}from"./chunk-ESTKDGOR.js";import{a as G,b as Y}from"./chunk-QCGIDFDQ.js";import{a as U,c as H,d as Q}from"./chunk-RA5YA7SP.js";import{b as $,d as B}from"./chunk-CG5ODPV4.js";import{$ as S,$a as f,Ca as D,G as k,Ib as g,Pb as R,Rb as T,Sb as j,Tb as r,Ub as a,Vb as m,Xb as x,Zb as v,_b as z,cb as s,db as p,dc as V,ec as A,fa as d,fc as N,ib as I,ic as b,jc as c,kc as M,lc as _,ma as u,na as h,pb as C,rb as F,tb as E,xa as O,xc as L}from"./chunk-UUT3EF6T.js";var bt=(()=>{class n extends P{static{this.COMMENT_SERVICE_URL="/comments"}constructor(){super(n.COMMENT_SERVICE_URL)}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275prov=S({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var yt=(()=>{class n{constructor(t,e){this.eleRef=t,this.render=e,this.rows=1,this.textarea=this.eleRef.nativeElement,this.render.setStyle(this.textarea,"width","100%"),this.textarea.setAttribute("rows",this.rows);let o=function(i){let l=i.target;e.setStyle(l,"height","auto"),e.setStyle(l,"height",`${l.scrollHeight+2}px`)};this.checkHeight=o,this.textarea.addEventListener("input",o)}ngOnDestroy(){let t=this.checkHeight;this.textarea.removeEventListener("input",t)}static{this.\u0275fac=function(e){return new(e||n)(p(D),p(I))}}static{this.\u0275dir=F({type:n,selectors:[["","rich-input",""]]})}}return n})();var It=["postForm"];function Ft(n,Dt){if(n&1){let t=x();r(0,"div",24)(1,"div",30)(2,"button",31),v("click",function(){let o=u(t),i=o.$implicit,l=o.$index,w=z();return h(w.removeMedia(i,l))}),m(3,"mat-icon",6),a()(),m(4,"img",32),a()}if(n&2){let t=Dt.$implicit;s(4),g("src",t.data,f)}}var kt=(()=>{class n extends xt{constructor(t,e){super(),this.data=t,this.dialogRef=e,this.commentService=d(bt),this.post=t.post,this.user=t.user}ngOnInit(){}createPost(){let t=new Date,e={id:"",title:this.postForm.value.title,content:this.postForm.value.comment,author:this.user,views:0,likes:0,comments:0,created_on:t,last_updated_on:t,originalPost:this.post,type:"comment"};console.log(e),console.log(this.media);let o=new FormData;o.append("post",new Blob([JSON.stringify(e)],{type:"application/json"})),o.append("media",this.media[0]),this.commentService.newPost$(o).subscribe({next:i=>{console.log(i),this.dialogRef.close({hasPosted:!0,hasCommented:!0,post:i})},error:i=>{console.log(i);let l=i.error.message;this.toastService.show({type:"danger",source_feature:"sns",header:"Failed to post comment"})}})}close(){this.dialogRef.close({hasCommented:!1})}addMedia(t){this.selectedMedia.length=0,this.media.length=0,super.addMedia(t)}get date(){return St.getDate(this.post)}static{this.\u0275fac=function(e){return new(e||n)(p(vt),p(Ct))}}static{this.\u0275cmp=C({type:n,selectors:[["compose-comment"]],viewQuery:function(e,o){if(e&1&&V(It,5),e&2){let i;A(i=N())&&(o.postForm=i.first)}},features:[E],decls:53,vars:13,consts:[["postForm","ngForm"],["title",""],["comment",""],[1,"compose-post"],[1,"compose-header"],["mat-icon-button","","mat-dialog-close","",1,"compose-cancel"],["fontIcon","close"],[1,"compose-description"],["appearance","outlined",1,"compose-comment-original-post"],["mat-card-avatar","",3,"src","title"],[1,"post-title",3,"title"],[1,"post-date"],[1,"author-identification"],[1,"author-displayname"],[1,"author-username"],[3,"submit"],[1,"create-post"],[1,"avatar-wrapper"],[1,"avatar",3,"title","src"],["appearance","outline",1,"compose-input"],["name","title","matInput","","ngModel","","maxlength","256","placeholder","Title...","cdkFocusInitial",""],["name","comment","rich-input","","matInput","","ngModel","","maxlength","256","placeholder","Leave a comment..."],["align","end"],[1,"selected-media-list"],[1,"selected-media"],["title","Add Media",1,"upload-media"],["for","add-image"],["fontIcon","image",1,"upload-label"],["id","add-image","type","file",1,"add-file-image",3,"change","accept"],["type","submit","mat-button","",3,"disabled"],[1,"remove-media"],["mat-icon-button","","title","Remove Media",3,"click"],[1,"selected-media-media",3,"src"]],template:function(e,o){if(e&1){let i=x();r(0,"div",3)(1,"div",4)(2,"button",5),m(3,"mat-icon",6),a(),r(4,"div",7)(5,"span"),c(6,"Replying to post"),a()()(),r(7,"mat-card",8)(8,"mat-card-header"),m(9,"img",9),r(10,"mat-card-title",10)(11,"span"),c(12),a()(),r(13,"div",11)(14,"span"),c(15),a()(),r(16,"mat-card-subtitle")(17,"div",12)(18,"span",13),c(19),a(),m(20,"span"),r(21,"span",14),c(22),a()()()(),r(23,"mat-card-content"),c(24),a()(),r(25,"form",15,0),v("submit",function(){return u(i),h(o.createPost())}),r(27,"div",16)(28,"div",17),m(29,"img",18),a(),r(30,"mat-dialog-content")(31,"mat-form-field",19)(32,"mat-label"),c(33,"Title"),a(),m(34,"input",20,1),a(),r(36,"mat-form-field",19)(37,"mat-label"),c(38,"Comment"),a(),m(39,"textarea",21,2),r(41,"mat-hint",22),c(42),a()(),r(43,"div",23),T(44,Ft,5,1,"div",24,R),a()()(),r(46,"mat-dialog-actions")(47,"div",25)(48,"label",26),m(49,"mat-icon",27),a(),r(50,"input",28),v("change",function(w){return u(i),h(o.addMedia(w))}),a()(),r(51,"button",29),c(52,"Done"),a()()()()}if(e&2){let i=b(26),l=b(40);s(9),g("src",o.post.author.avatar,f)("title",o.post.author.username),s(),g("title",o.post.title),s(2),M(o.post.title),s(3),M(o.date),s(4),M(o.post.author.displayName),s(3),_("@",o.post.author.username,""),s(2),_(" ",o.post.content," "),s(5),g("title","avatar")("src",o.user.avatar,f),s(13),_("",l.value.length," / 256"),s(2),j(o.selectedMedia),s(6),g("accept",o.validMediaTypes),s(),g("disabled",i.invalid)}},dependencies:[et,Z,q,J,K,tt,X,W,Q,U,H,Ot,_t,wt,Pt,ot,ft,mt,ht,dt,ut,gt,pt,at,rt,nt,it,ct,st,Y,G,yt],styles:["mat-card-actions[_ngcontent-%COMP%]{justify-content:end;gap:1rem;padding:0rem 1rem}.post[_ngcontent-%COMP%]{color:#000;border-color:var(--sns-post-border-color);border-radius:5px;overflow:hidden;background-color:var(--sns-post-bg-color)}.post[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:var(--sns-hover-color)}.post-title[_ngcontent-%COMP%], .author-identification[_ngcontent-%COMP%], .post-date[_ngcontent-%COMP%], .post-content[_ngcontent-%COMP%], .post-summary[_ngcontent-%COMP%]{color:var(--sns-post-text-color)}.post-title[_ngcontent-%COMP%]{text-wrap:nowrap;text-overflow:ellipsis;overflow:hidden}.author-identification[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:.5rem}.author-displayname[_ngcontent-%COMP%]{text-wrap:nowrap;text-overflow:ellipsis;overflow:hidden}.author-username[_ngcontent-%COMP%]{text-wrap:nowrap;color:var(--sns-username-color)}.post-media[_ngcontent-%COMP%]{max-height:700px;object-fit:cover}.post-action[_ngcontent-%COMP%]{height:1.75rem;box-shadow:none!important;background-color:transparent;color:var(--sns-post-text-color)}.post-action[_ngcontent-%COMP%]:hover{scale:1.05}.delete-post[_ngcontent-%COMP%]{position:absolute;left:1rem}.action-like[_ngcontent-%COMP%]{color:var(--sns-like-post-color)}.action-comment[_ngcontent-%COMP%]{color:var(--sns-comment-post-color)}.action-delete[_ngcontent-%COMP%]{color:red}.post-date[_ngcontent-%COMP%]{flex:1;justify-self:end;text-align:end;text-wrap:nowrap}.post-categories[_ngcontent-%COMP%]{flex:1;font-size:.9rem;display:flex;flex-flow:row nowrap;gap:.5rem;text-overflow:ellipsis}.post-categories[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.post-purpose[_ngcontent-%COMP%], .post-topic[_ngcontent-%COMP%], .post-mood[_ngcontent-%COMP%]{padding:.2rem;border:1px solid rgba(0,0,0,35%);border-radius:.3rem}.post-purpose[_ngcontent-%COMP%]{background-color:var(--sns-post-purpose-color)}.post-topic[_ngcontent-%COMP%]{background-color:var(--sns-post-topic-color)}.post-mood[_ngcontent-%COMP%]{background-color:var(--sns-post-mood-color)}.post-footer[_ngcontent-%COMP%]{padding-top:1rem;padding-bottom:.5rem}@media (max-width:1080px){.post-title[_ngcontent-%COMP%]{font-size:1.25rem}.author-identification[_ngcontent-%COMP%], .post-date[_ngcontent-%COMP%]{font-size:.9rem}.post-content[_ngcontent-%COMP%], .post-summary[_ngcontent-%COMP%]{font-size:1rem}.post-action[_ngcontent-%COMP%]{padding:.25rem}}.compose-post[_ngcontent-%COMP%]{--avatar-size: 3rem;min-width:30rem;border-radius:0rem!important}.compose-header[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;justify-content:space-between;align-items:center;padding:.1rem 0rem}.compose-cancel[_ngcontent-%COMP%]{margin:0rem .25rem}.compose-cancel[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-bottom:5px}.compose-description[_ngcontent-%COMP%]{margin:0rem 1rem}.create-post[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:.5rem;align-items:start;padding:.5rem}.avatar-wrapper[_ngcontent-%COMP%]{position:relative;float:left;flex-shrink:0;width:var(--avatar-size);height:var(--avatar-size);margin-top:.75rem;border-radius:100%;overflow:hidden}.avatar[_ngcontent-%COMP%]{width:var(--avatar-size);height:var(--avatar-size);object-fit:cover}.compose-input[_ngcontent-%COMP%]{width:100%}.upload-media[_ngcontent-%COMP%]{position:relative;margin-right:auto}.add-file-image[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:0px;width:0px;overflow:hidden}.upload-label[_ngcontent-%COMP%]:hover{cursor:pointer;scale:1.05}.selected-media-list[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:.5rem}.selected-media[_ngcontent-%COMP%]{position:relative}.selected-media-media[_ngcontent-%COMP%]{height:150px;border:1px solid;border-radius:3px}.remove-media[_ngcontent-%COMP%]{position:absolute;top:.1rem;right:.1rem;border-radius:100%;background-color:#00000080}.remove-media[_ngcontent-%COMP%]:hover{background-color:#00000059}.remove-media[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:red}mat-dialog-content[_ngcontent-%COMP%]{padding:1rem .75rem .25rem!important}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:.25rem!important}@media (max-width:32rem){.compose-post[_ngcontent-%COMP%]{min-width:unset;width:400px}}.compose-comment-original-post[_ngcontent-%COMP%]{border-radius:0rem;border-left:none;border-right:none}.comment-to-original[_ngcontent-%COMP%]{margin-top:1rem;margin-left:.1rem;rotate:90deg;vertical-align:text-bottom;float:left}"]})}}return n})();var St=(()=>{class n{static{this.day=864e5}static{this.hour=36e5}static{this.minute=6e4}constructor(t){this.postService=t,this.isDeleted=!1,this.changeRef=d(L),this.dialog=d(Mt),this.router=d(B),this.route=d($),this.onComment=new O,this.onDelete=new O}ngOnInit(){}del(t){t?.stopPropagation(),this.user?.id===this.post.author.id&&confirm("Are you sure to want to delete this post? This action cannot be undone.")&&this.deletePost()}fav(t){t?.stopPropagation(),this.user&&(this.user.likes.findIndex(o=>o==this.post.id)>-1?this.unfavPost():this.favPost())}deletePost(){this.postService.deleteById$(this.post.id).subscribe(t=>{let e=t.message;e&&(console.log("Deleted:",e),this.isDeleted=!0,this.onDelete.emit(e)),this.changeRef.markForCheck()})}favPost(){this.postService.favoritePost$(this.post.id).subscribe(t=>{let e=t.message;this.user&&(this.user.likes.push(e),this.post.likes++,this.changeRef.markForCheck())})}unfavPost(){this.postService.unfavoritePost$(this.post.id).subscribe(t=>{let e=t.message;if(this.user){let o=this.user.likes.findIndex(i=>i==e);this.user.likes.splice(o,1),this.post.likes--,this.changeRef.markForCheck()}})}isFav(){if(this.user){for(let t of this.user.likes)if(t==this.post.id)return!0}return!1}commentPost(t){t?.stopPropagation(),this.dialog.open(kt,{restoreFocus:!1,scrollStrategy:new lt,data:{post:this.post,user:this.user}}).afterClosed().pipe(k(1)).subscribe(o=>{o.hasCommented&&(this.post.comments=this.post.comments+1,this.onComment.emit(o.post),this.changeRef.markForCheck())})}toProfile(t){t?.stopPropagation(),this.post&&this.post.author&&window.getSelection()?.toString().length==0&&this.router.navigate([this.post.author.username],{relativeTo:this.route.parent})}toPost(t){t?.stopPropagation(),this.post&&window.getSelection()?.toString().length==0&&this.router.navigate(["posts",this.post.id],{relativeTo:this.route.parent})}get date(){return n.getDate(this.post)}static getDate(t){if(!t)return"unknown time";let e=new Date(Date.parse(t.created_on.toString())),o=Date.now()-e.getTime();return o<n.hour?(o/n.minute).toFixed(0)+"min ago":o<n.day?(o/n.hour).toFixed(0)+"hr ago":e.getUTCFullYear()==new Date().getUTCFullYear()?e.toLocaleDateString("locale",{month:"short",day:"numeric"}):e.toLocaleDateString("locale",{month:"short",day:"numeric",year:"numeric"})}static{this.\u0275fac=function(e){return new(e||n)(p(P))}}static{this.\u0275cmp=C({type:n,selectors:[["ng-component"]],inputs:{post:"post",user:"user"},outputs:{onComment:"onComment",onDelete:"onDelete"},decls:0,vars:0,template:function(e,o){},styles:["mat-card-actions[_ngcontent-%COMP%]{justify-content:end;gap:1rem;padding:0rem 1rem}.post[_ngcontent-%COMP%]{color:#000;border-color:var(--sns-post-border-color);border-radius:5px;overflow:hidden;background-color:var(--sns-post-bg-color)}.post[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:var(--sns-hover-color)}.post-title[_ngcontent-%COMP%], .author-identification[_ngcontent-%COMP%], .post-date[_ngcontent-%COMP%], .post-content[_ngcontent-%COMP%], .post-summary[_ngcontent-%COMP%]{color:var(--sns-post-text-color)}.post-title[_ngcontent-%COMP%]{text-wrap:nowrap;text-overflow:ellipsis;overflow:hidden}.author-identification[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:.5rem}.author-displayname[_ngcontent-%COMP%]{text-wrap:nowrap;text-overflow:ellipsis;overflow:hidden}.author-username[_ngcontent-%COMP%]{text-wrap:nowrap;color:var(--sns-username-color)}.post-media[_ngcontent-%COMP%]{max-height:700px;object-fit:cover}.post-action[_ngcontent-%COMP%]{height:1.75rem;box-shadow:none!important;background-color:transparent;color:var(--sns-post-text-color)}.post-action[_ngcontent-%COMP%]:hover{scale:1.05}.delete-post[_ngcontent-%COMP%]{position:absolute;left:1rem}.action-like[_ngcontent-%COMP%]{color:var(--sns-like-post-color)}.action-comment[_ngcontent-%COMP%]{color:var(--sns-comment-post-color)}.action-delete[_ngcontent-%COMP%]{color:red}.post-date[_ngcontent-%COMP%]{flex:1;justify-self:end;text-align:end;text-wrap:nowrap}.post-categories[_ngcontent-%COMP%]{flex:1;font-size:.9rem;display:flex;flex-flow:row nowrap;gap:.5rem;text-overflow:ellipsis}.post-categories[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.post-purpose[_ngcontent-%COMP%], .post-topic[_ngcontent-%COMP%], .post-mood[_ngcontent-%COMP%]{padding:.2rem;border:1px solid rgba(0,0,0,35%);border-radius:.3rem}.post-purpose[_ngcontent-%COMP%]{background-color:var(--sns-post-purpose-color)}.post-topic[_ngcontent-%COMP%]{background-color:var(--sns-post-topic-color)}.post-mood[_ngcontent-%COMP%]{background-color:var(--sns-post-mood-color)}.post-footer[_ngcontent-%COMP%]{padding-top:1rem;padding-bottom:.5rem}@media (max-width:1080px){.post-title[_ngcontent-%COMP%]{font-size:1.25rem}.author-identification[_ngcontent-%COMP%], .post-date[_ngcontent-%COMP%]{font-size:.9rem}.post-content[_ngcontent-%COMP%], .post-summary[_ngcontent-%COMP%]{font-size:1rem}.post-action[_ngcontent-%COMP%]{padding:.25rem}}"]})}}return n})();export{bt as a,St as b};
