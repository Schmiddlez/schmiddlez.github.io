import{a as l}from"./chunk-7E7XWTTT.js";import{e as k}from"./chunk-KE4LITEF.js";import{ha as h,k as r,u as n}from"./chunk-W56RDURX.js";var a=class{constructor(e,t,s,i,o){this.oauthUrl=e,this.tokenUrl=t,this.refreshUrl=s,this.logoutUrl=i,this.cookieName=o,this.POPUP_WIDTH=500,this.POPUP_HEIGHT=650,this.http=h(k),this.cookies=h(l),this.tokensRecieved=new r(null),this.tokensRecieved$=this.tokensRecieved.asObservable()}login(){this.http.get(`${this.oauthUrl}`,{withCredentials:!0}).subscribe({next:e=>{this.beginExchange(e)},error:e=>{console.log(e)}})}logout$(){return this.http.get(`${this.logoutUrl}`,{withCredentials:!0}).pipe(n(e=>(this.tokensRecieved.next(null),e)))}getTokens$(e,t){return this.http.get(`${this.tokenUrl}?code=${e}${t?`&state=${t}`:""}`,{withCredentials:!0})}refreshTokens$(e){return this.http.get(`${this.refreshUrl}?refreshToken=${e}`,{withCredentials:!0})}setTokenCookie(e,t){t?this.cookies.set(this.cookieName,e,{expires:t,path:"/"}):this.cookies.set(this.cookieName,e,{path:"/"})}getTokenCookie(){return this.cookies.get(this.cookieName)}deleteTokenCookie(){return this.cookies.delete(this.cookieName)}beginExchange(e){if(e&&e!=""){let t=window.open(e,"popup",`popup=true, width=${this.POPUP_WIDTH}, height=${this.POPUP_HEIGHT}`),s=this.tokensRecieved,i=function(o){o.data.access_token&&(s.next(o.data),window.removeEventListener("message",i))};window.addEventListener("message",i)}}};export{a};
