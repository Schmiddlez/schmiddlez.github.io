import{a as et,b as he,c as X}from"./chunk-IZTFWVE7.js";import{a as He,b as ze,c as Qe,d as Ye,e as Je,f as Ke,g as Xe,h as Ze}from"./chunk-DGBRVGTQ.js";import{a as nt}from"./chunk-JQPVAIZA.js";import{a as fe,b as ge}from"./chunk-COWYPX6I.js";import{a as tt}from"./chunk-EDOFCG4F.js";import{a as B}from"./chunk-RZGKKGXP.js";import"./chunk-CRXCR2JF.js";import{h as Ge,i as We}from"./chunk-Y3TTJPGN.js";import{a as j,b as q,c as H,e as z,g as Q,h as G}from"./chunk-U54IN6QP.js";import{a as ue}from"./chunk-YR2LWUA2.js";import{b as Le}from"./chunk-WIG5QM3W.js";import{a as Ee,c as Re}from"./chunk-UOSUV5A5.js";import{b as qe}from"./chunk-TLFBGYCR.js";import{a as ie,b as V}from"./chunk-GSXTAEMJ.js";import{j as O}from"./chunk-H2UTJKOZ.js";import{a as me,b as je,g as ce,i as pe,j as de}from"./chunk-N7TBWEAR.js";import{a as x,b as Ie,d as S}from"./chunk-NPZLEDH6.js";import"./chunk-WTDRPXX3.js";import"./chunk-HU7WFQWJ.js";import{b as oe,c as D,e as U,f as re,g as Ce,h as Ae,i as I,j as $e,k as se,m as Ne,n as Ve,q as Ue,w as Be,y as ae,z as le}from"./chunk-HUAPMYXL.js";import{a as Oe}from"./chunk-LUEFBJHU.js";import"./chunk-GT3HK5I6.js";import{b as N,c as Te,d as b,e as F,f as De,i as T}from"./chunk-KVX4MIOR.js";import"./chunk-5V4PC647.js";import"./chunk-OOKV5ZR5.js";import{$a as ee,Ab as R,B as Se,Bb as A,Da as L,Fb as u,Lb as C,N as J,Ob as te,Pb as ne,Qb as i,R as we,Rb as r,Sb as l,Ub as k,Wb as f,Xb as c,Z,ab as p,ac as ye,bb as g,bc as Me,cc as Pe,da as d,gc as s,hc as $,ic as K,ka as M,l as ve,la as P,mb as h,nc as ke,oc as Fe,qb as E,r as Y,tb as v,ub as be}from"./chunk-3AA7O2RR.js";var it=(()=>{class n{constructor(){this.snsHttp=d(ue),this.userService=d(B),this.BASE_URL="/posts/feed",this.loadDate=new Date,this.lastUpdateDate=this.loadDate,this.view="top",this.top=L([]),this.top$=this.top.asReadonly(),this.latest=L([]),this.latest$=this.latest.asReadonly(),this.follows=L([]),this.follows$=this.follows.asReadonly(),this.newTop=L([]),this.newTop$=this.newTop.asReadonly(),this.newLatest=L([]),this.newLatest$=this.newLatest.asReadonly(),this.newFollows=L([]),this.newFollows$=this.newFollows.asReadonly(),this.pages={top:0,latest:0,follows:0},this.scrolls={top:0,latest:0,follows:0},this.loading={top:!1,latest:!1,follows:!1},this.subs=[],this.loading.top=!0,this.loading.latest=!0,this.loading.follows=!0,this.getTop({before:this.loadDate,page:0}).subscribe(e=>{this.top.set(e),this.pages.top=1}).add(()=>this.loading.top=!1),this.getLatest({before:this.loadDate,page:0}).subscribe(e=>{this.latest.set(e),this.pages.latest=1}).add(()=>this.loading.latest=!1),this.getFollows({before:this.loadDate,page:0}).subscribe(e=>{this.follows.set(e),this.pages.follows=1}).add(()=>this.loading.follows=!1)}ngOnDestroy(){for(let e of this.subs)e.unsubscribe()}setView(e){this.view=e}get currentView(){return this.view}loadMore(e){if(!this.loading[e]){var t;switch(e){case"top":t=this.getTop({before:this.loadDate,page:this.pages[e]});break;case"latest":t=this.getLatest({before:this.loadDate,page:this.pages[e]});break;case"follows":t=this.getFollows({before:this.loadDate,page:this.pages[e]});break}this.handleRequest(t,e)}}checkForUpdates(){this.getNewTop({after:this.lastUpdateDate,page:0}).subscribe(e=>{e.length>0&&this.newTop.update(t=>[...e,...t])}),this.getNewLatest({after:this.lastUpdateDate,page:0}).subscribe(e=>{e.length>0&&this.newLatest.update(t=>[...e,...t])}),this.getNewFollows({after:this.lastUpdateDate,page:0}).subscribe(e=>{e.length>0&&this.newFollows.update(t=>[...e,...t])}),this.lastUpdateDate=new Date}showNewPosts(e){switch(e){case"top":this.top.update(t=>[...this.newTop(),...t]),this.newTop.set([]);break;case"latest":this.latest.update(t=>[...this.newLatest(),...t]),this.newLatest.set([]);break;case"follows":this.follows.update(t=>[...this.newFollows(),...t]),this.newFollows.set([]);break}}updateScroll(e,t){switch(e){case"top":this.scrolls[e]=t;break;case"latest":this.scrolls[e]=t;break;case"follows":this.scrolls[e]=t;break}}getScroll(e){switch(e){case"top":return this.scrolls[e];case"latest":return this.scrolls[e];case"follows":return this.scrolls[e]}return 0}getTop(e){return this.get(`${this.BASE_URL}/top?${this.params(e)}`)}getLatest(e){return this.get(`${this.BASE_URL}/latest?${this.params(e)}`)}getFollows(e){return this.get(`${this.BASE_URL}/follows?${this.params(e)}`)}getNewTop(e){return this.get(`${this.BASE_URL}/top/new?${this.params(e)}`)}getNewLatest(e){return this.get(`${this.BASE_URL}/latest/new?${this.params(e)}`)}getNewFollows(e){return this.get(`${this.BASE_URL}/follows/new?${this.params(e)}`)}handleRequest(e,t){let o=this.pages[t];this.loading[t]=!0,e.subscribe({next:m=>{switch(this.pages[t]=o+1,t){case"top":this.top.update(_=>this.appendMorePosts(_,m));break;case"latest":this.latest.update(_=>this.appendMorePosts(_,m));break;case"follows":this.follows.update(_=>this.appendMorePosts(_,m));break}},error:m=>{console.log(m)}}).add(()=>this.loading[t]=!1)}appendMorePosts(e,t){let o=[...e];for(let m of t)o.findIndex(St=>St.id==m.id)<0&&o.push(m);return o}params(e){var t=[];return e.before&&t.push(`before=${e.before}`),e.after&&t.push(`after=${e.after}`),t.push(`page=${e.page}`),t.join("&")}get(e){return this.snsHttp.get(e)}post(e,t){return this.snsHttp.post(e,t)}delete(e){return this.snsHttp.delete(e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var xe=(n,a)=>a.id,Ct=()=>[import("./chunk-VHDVOQFF.js").then(n=>n.AnnouncementComponent),import("./chunk-5TZ3XW5B.js").then(n=>n.ArticleComponent),import("./chunk-HBVOAVQJ.js").then(n=>n.PictorialComponent),import("./chunk-YI4IKFIW.js").then(n=>n.CommentComponent)];function xt(n,a){if(n&1){let e=k();i(0,"div",11),f("click",function(){M(e);let o=c(2);return P(o.showNewPosts("top"))}),i(1,"span"),s(2),r()()}if(n&2){let e=c(2);p(2),$("Show "+e.newTop().length+" New Posts")}}function wt(n,a){}function bt(n,a){if(n&1&&l(0,"sns-announcement",12),n&2){let e=c().$implicit,t=c(2);u("post",t.announcement(e))("user",t.me())}}function yt(n,a){if(n&1&&l(0,"sns-comment",12),n&2){let e=c().$implicit,t=c(2);u("post",t.comment(e))("user",t.me())}}function Mt(n,a){if(n&1&&l(0,"sns-pictorial",12),n&2){let e=c().$implicit,t=c(2);u("post",t.pictorial(e))("user",t.me())}}function Pt(n,a){if(n&1&&l(0,"sns-article",12),n&2){let e=c().$implicit,t=c(2);u("post",t.article(e))("user",t.me())}}function kt(n,a){if(n&1&&v(0,wt,0,0)(1,bt,1,2,"sns-announcement",12)(2,yt,1,2,"sns-comment",12)(3,Mt,1,2,"sns-pictorial",12)(4,Pt,1,2,"sns-article",12),n&2){let e,t=a.$implicit;C((e=t.type)==="basic"?0:e==="announcement"?1:e==="comment"?2:e==="pictorial"?3:e==="article"?4:-1)}}function Ft(n,a){if(n&1){let e=k();i(0,"div",11),f("click",function(){M(e);let o=c(2);return P(o.showNewPosts("latest"))}),i(1,"span"),s(2),r()()}if(n&2){let e=c(2);p(2),$("Show "+e.newLatest().length+" New Posts")}}function Tt(n,a){}function Dt(n,a){if(n&1&&l(0,"sns-announcement",12),n&2){let e=c().$implicit,t=c(2);u("post",t.announcement(e))("user",t.me())}}function It(n,a){if(n&1&&l(0,"sns-comment",12),n&2){let e=c().$implicit,t=c(2);u("post",t.comment(e))("user",t.me())}}function Lt(n,a){if(n&1&&l(0,"sns-pictorial",12),n&2){let e=c().$implicit,t=c(2);u("post",t.pictorial(e))("user",t.me())}}function Ot(n,a){if(n&1&&l(0,"sns-article",12),n&2){let e=c().$implicit,t=c(2);u("post",t.article(e))("user",t.me())}}function Et(n,a){if(n&1&&v(0,Tt,0,0)(1,Dt,1,2,"sns-announcement",12)(2,It,1,2,"sns-comment",12)(3,Lt,1,2,"sns-pictorial",12)(4,Ot,1,2,"sns-article",12),n&2){let e,t=a.$implicit;C((e=t.type)==="basic"?0:e==="announcement"?1:e==="comment"?2:e==="pictorial"?3:e==="article"?4:-1)}}function Rt(n,a){if(n&1){let e=k();i(0,"div",11),f("click",function(){M(e);let o=c(2);return P(o.showNewPosts("follows"))}),i(1,"span"),s(2),r()()}if(n&2){let e=c(2);p(2),$("Show "+e.newFollows().length+" New Posts")}}function At(n,a){}function $t(n,a){if(n&1&&l(0,"sns-announcement",12),n&2){let e=c().$implicit,t=c(2);u("post",t.announcement(e))("user",t.me())}}function Nt(n,a){if(n&1&&l(0,"sns-comment",12),n&2){let e=c().$implicit,t=c(2);u("post",t.comment(e))("user",t.me())}}function Vt(n,a){if(n&1&&l(0,"sns-pictorial",12),n&2){let e=c().$implicit,t=c(2);u("post",t.pictorial(e))("user",t.me())}}function Ut(n,a){if(n&1&&l(0,"sns-article",12),n&2){let e=c().$implicit,t=c(2);u("post",t.article(e))("user",t.me())}}function Bt(n,a){if(n&1&&v(0,At,0,0)(1,$t,1,2,"sns-announcement",12)(2,Nt,1,2,"sns-comment",12)(3,Vt,1,2,"sns-pictorial",12)(4,Ut,1,2,"sns-article",12),n&2){let e,t=a.$implicit;C((e=t.type)==="basic"?0:e==="announcement"?1:e==="comment"?2:e==="pictorial"?3:e==="article"?4:-1)}}function jt(n,a){if(n&1&&(i(0,"div",8),v(1,xt,3,1,"div",9),i(2,"div",10),te(3,kt,5,1,null,null,xe),r()(),i(5,"div",8),v(6,Ft,3,1,"div",9),i(7,"div",10),te(8,Et,5,1,null,null,xe),r()(),i(10,"div",8),v(11,Rt,3,1,"div",9),i(12,"div",10),te(13,Bt,5,1,null,null,xe),r()()),n&2){let e=c();u("hidden",e.feedView.value!="top"),p(),C(e.newTop().length>0?1:-1),p(2),ne(e.top()),p(2),u("hidden",e.feedView.value!="latest"),p(),C(e.newLatest().length>0?6:-1),p(2),ne(e.latest()),p(2),u("hidden",e.feedView.value!="follows"),p(),C(e.newFollows().length>0?11:-1),p(2),ne(e.follows())}}function qt(n,a){n&1&&(i(0,"div",13),l(1,"mat-progress-spinner",14),r())}function Ht(n,a){n&1&&(i(0,"div"),s(1,"Failed to load posts"),r())}var rt=(()=>{class n{constructor(){this.userService=d(B),this.feedService=d(it),this.feedView=new I("top"),this.throttler=new Re,this.subs=[],this.announcement=Ye,this.comment=Je,this.pictorial=Ke,this.article=Xe,this.me=this.userService.me$,this.top=this.feedService.top$,this.latest=this.feedService.latest$,this.follows=this.feedService.follows$,this.newTop=this.feedService.newTop$,this.newLatest=this.feedService.newLatest$,this.newFollows=this.feedService.newFollows$,this.feedView.setValue(this.feedService.currentView),this.updateChecks=setInterval(()=>{this.feedService.checkForUpdates()},6e4)}ngOnInit(){}ngOnDestroy(){for(let e of this.subs)e.unsubscribe();clearInterval(this.updateChecks)}switchView(e){let t=e.value;switch(t){case"top":this.feedService.setView(t);break;case"latest":this.feedService.setView(t);break;case"follows":this.feedService.setView(t);break}window.scrollTo({top:this.feedService.getScroll(t),behavior:"instant"})}showNewPosts(e){this.feedService.showNewPosts(e)}onScroll(){let e=window.document.documentElement,t=e.scrollHeight-(e.scrollTop+e.offsetHeight);this.feedService.updateScroll(this.feedView.value,e.scrollTop),t<Math.min(2e3,e.scrollHeight*.1)&&this.throttler.throttle(()=>{let o=this.feedView.value;this.feedService.loadMore(o)},3e3)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=h({type:n,selectors:[["sns-feed"]],hostBindings:function(t,o){t&1&&f("scroll",function(){return o.onScroll()},!1,ee)},decls:17,vars:3,consts:[[1e3,null],["id","sns-feed"],["value","top",3,"change","formControl"],["value","top",3,"checked"],["value","latest"],["value","follows"],[1,"new-post"],["rich-input",""],[3,"hidden"],[1,"view-new-posts"],[1,"post-feed"],[1,"view-new-posts",3,"click"],[3,"post","user"],[1,"loading"],["mode","indeterminate"]],template:function(t,o){t&1&&(i(0,"div",1)(1,"mat-button-toggle-group",2),f("change",function(_){return o.switchView(_)}),i(2,"mat-button-toggle",3),s(3,"Top"),r(),i(4,"mat-button-toggle",4),s(5,"Latest"),r(),i(6,"mat-button-toggle",5),s(7,"Follows"),r()(),i(8,"div",6)(9,"span"),s(10,"Text"),r(),l(11,"textarea",7),r(),v(12,jt,15,6)(13,qt,2,0)(14,Ht,2,0),R(15,12,Ct,13,null,14,0,null,be),r()),t&2&&(p(),u("formControl",o.feedView),p(),u("checked",!0),p(13),A(o.me))},dependencies:[V,Qe,He,ze,S,Ee,Ge,Le,le,U,Ne,We],styles:["#sns-feed[_ngcontent-%COMP%]{flex:1;display:flex;flex-flow:column;gap:1rem}mat-button-toggle-group[_ngcontent-%COMP%]{position:sticky;top:0%;width:100%;padding-top:1rem;border:none;border-radius:0;background-color:var(--sns-bg-trans);z-index:100}mat-button-toggle[_ngcontent-%COMP%]{color:var(--sns-text-color);width:100%;border:none!important}.post-feed[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:1rem}.new-post[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:1rem;align-items:center}.loading[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;padding-top:10rem}.view-new-posts[_ngcontent-%COMP%]{font-size:1.1rem;padding:1rem;margin:1rem 0rem 2rem;border:1px solid var(--sns-show-posts-border-color);border-radius:3px}.view-new-posts[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:var(--sns-hover-color)}"]})}}return n})();var st=(()=>{class n{constructor(){}ngOnInit(){}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=h({type:n,selectors:[["sns-home"]],decls:3,vars:0,consts:[["id","sns-home"],[1,"main-content"],[1,"side-content"]],template:function(t,o){t&1&&(i(0,"div",0),l(1,"sns-feed",1)(2,"sns-search",2),r())},dependencies:[rt,Ze],styles:["#sns-home[_ngcontent-%COMP%]{position:relative;display:flex;flex-flow:row nowrap;justify-content:center;width:100%;max-height:100%}@media (max-width:1080px){.main-content[_ngcontent-%COMP%]{min-width:10rem;padding-right:1rem}.side-content[_ngcontent-%COMP%]{display:none}}"]})}}return n})();var w=(()=>{class n{constructor(){this.resourceUrl="/auth",this.http=d(ue)}login$(e,t){return this.http.get(`${this.resourceUrl}/login?username=${e}&password=${t}`)}logout$(){return this.http.get(`${this.resourceUrl}/logout`)}register$(e,t,o,m){let _={username:e,password:t,displayName:o,questions:m};return this.http.post(`${this.resourceUrl}/register`,_)}isLoggedIn$(){return this.http.get(`${this.resourceUrl}/isLoggedIn`).pipe(Y(e=>e.message=="true"))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var mt=(()=>{class n extends G{constructor(e,t){super(),this.data=e,this.dialogRef=t,this.authService=d(w),this.hasLoggedOut=!1}ngOnInit(){}logout(){this.authService.logout$().pipe(J(3)).subscribe({next:e=>{console.log(e),this.hasLoggedOut=!0,this.router.navigate(["/sns/logout"])},error:e=>{console.log(e)}})}close(){this.dialogRef.close({hasLoggedOut:this.hasLoggedOut})}static{this.\u0275fac=function(t){return new(t||n)(g(q),g(j))}}static{this.\u0275cmp=h({type:n,selectors:[["logout-promt"]],features:[E],decls:13,vars:0,consts:[[1,"logout-prompt"],[1,"logout-prompt-header"],[1,"logout-prompt-content"],["mat-flat-button","",1,"return-btn",3,"click"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h5"),s(4,"Logout"),r()()(),i(5,"mat-dialog-content")(6,"div",2)(7,"div"),s(8,"Are you sure you wish to logout?"),r(),i(9,"button",3),f("click",function(){return o.logout()}),s(10,"Logout"),r(),i(11,"button",3),f("click",function(){return o.close()}),s(12,"Cancel"),r()()()())},dependencies:[Q,z,S,x],styles:[".logout-prompt[_ngcontent-%COMP%]{padding:1rem 0rem;box-sizing:border-box}.logout-prompt-header[_ngcontent-%COMP%]{padding:0rem 1rem;border-bottom:1px solid rgba(30,30,30,.5)}.logout-prompt-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;font-size:1.25rem;text-align:center}.return-btn[_ngcontent-%COMP%]{border-radius:3px}"]})}}return n})();var ct=(()=>{class n{constructor(e,t){this.router=e,this.route=t,this.width=window.innerWidth}ngOnInit(){}toProfile(){this.router.navigate([this.user.username],{relativeTo:this.route.parent})}get avatarSize(){return this.width<1295?"4rem":"5rem"}get avatarOverrides(){let e={};return this.width<1295&&(e["justify-self"]="center"),e}onResize(){this.width=window.innerWidth}static{this.\u0275fac=function(t){return new(t||n)(g(b),g(N))}}static{this.\u0275cmp=h({type:n,selectors:[["sns-user-summary"]],hostBindings:function(t,o){t&1&&f("resize",function(){return o.onResize()},!1,ee)},inputs:{user:"user"},decls:21,vars:9,consts:[[1,"user-summary"],[1,"avatar-name",3,"click"],[1,"avatar",3,"username","avatar","size","styleOverrides"],[1,"name"],[1,"username"],[1,"stats"],["title","Articles","aria-hidden","false","aria-label","number articles","fontIcon","article"],["title","Pictorials","aria-hidden","false","aria-label","number pictorials","fontIcon","image"],["title","Comments","aria-hidden","false","aria-label","number comments","fontIcon","comment"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1),f("click",function(){return o.toProfile()}),l(2,"sns-user-avatar",2),i(3,"div",3)(4,"span"),s(5),r()()(),i(6,"div",4),s(7),r(),i(8,"div",5)(9,"div"),s(10,"#"),l(11,"mat-icon",6),s(12),r(),i(13,"div"),s(14,"#"),l(15,"mat-icon",7),s(16),r(),i(17,"div"),s(18,"#"),l(19,"mat-icon",8),s(20),r()()()),t&2&&(p(2),u("username",o.user.username)("avatar",o.user.avatar)("size",o.avatarSize)("styleOverrides",o.avatarOverrides),p(3),$(o.user.displayName),p(2),K(" @",o.user.username," "),p(5),K(": ",o.user.articles," "),p(4),K(": ",o.user.pictorials,""),p(4),K(": ",o.user.comments,""))},dependencies:[V,ie,tt],styles:["mat-icon[_ngcontent-%COMP%]{vertical-align:text-bottom}.user-summary[_ngcontent-%COMP%]{width:100%}.avatar-name[_ngcontent-%COMP%]{margin-top:1rem;border-bottom:2px solid;border-bottom-right-radius:2px}.avatar-name[_ngcontent-%COMP%]:hover{cursor:pointer}.name[_ngcontent-%COMP%]{font-size:1.2rem;letter-spacing:.15rem;align-content:end}.avatar[_ngcontent-%COMP%]{position:relative;float:left;transform:translateY(-20%);margin-right:.5rem}.username[_ngcontent-%COMP%]{letter-spacing:.15rem;color:var(--sns-username-color)}.stats[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;justify-content:space-between;gap:.5rem;opacity:80%;text-wrap:nowrap}@media (max-width: 1295px){.stats[_ngcontent-%COMP%], .username[_ngcontent-%COMP%], .name[_ngcontent-%COMP%]{display:none}.avatar-name[_ngcontent-%COMP%]{border-bottom:none}.avatar[_ngcontent-%COMP%]{float:none;margin:unset;justify-self:center}}"]})}}return n})();var Qt=n=>["/sns",n],Gt=()=>["/sns/settings"],pt=(()=>{class n{constructor(e){this.router=e,this.userService=d(B),this.authService=d(w),this.sessionService=d(fe),this.user=this.userService.me$,this.dialog=d(H),this.subs=[],this.validLoginSessionCheck=setInterval(()=>{this.authService.isLoggedIn$().subscribe(o=>this.loginCheck(o))},1e3*60*5);let t=this.sessionService.loginSession$.pipe(we(1)).subscribe(o=>this.checkSession(o));this.subs.push(t)}ngOnInit(){}ngOnDestroy(){clearInterval(this.validLoginSessionCheck);for(let e of this.subs)e.unsubscribe()}promptLogout(){this.dialog.open(mt,{disableClose:!0,restoreFocus:!1,scrollStrategy:new O,data:{state:this.router.routerState.snapshot}})}loginCheck(e){e||this.sessionService.sessionExpired("login")}checkSession(e){!e&&this.dialogRef==null&&(this.dialogRef=this.dialog.open(et,{disableClose:!0,restoreFocus:!1,scrollStrategy:new O,data:{session:"login",state:this.router.routerState.snapshot}}),this.dialogRef.afterClosed().subscribe(t=>{this.dialogRef=void 0}))}static{this.\u0275fac=function(t){return new(t||n)(g(b))}}static{this.\u0275cmp=h({type:n,selectors:[["sns-index"]],decls:41,vars:6,consts:[["id","sns-index",1,"index"],[1,"index-sections"],["id","sns-nav"],[1,"logo"],[3,"user"],["mat-fab","","extended","",1,"new-post-btn"],["aria-hidden","false","aria-label","new post","fontIcon","post_add"],[1,"nav-list"],["title","Home","routerLink","/sns/home","routerLinkActive","active-link",1,"nav-link"],["aria-hidden","false","aria-label","home","fontIcon","home",1,"link-icon"],[1,"link-text"],["title","search TBA",1,"nav-link"],["aria-hidden","false","aria-label","search","fontIcon","search",1,"link-icon","TBA"],["title","notifications TBA",1,"nav-link"],["aria-hidden","false","aria-label","notifications","fontIcon","notifications",1,"link-icon","TBA"],["title","bookmarks TBA",1,"nav-link"],["aria-hidden","false","aria-label","bookmarks","fontIcon","bookmarks",1,"link-icon","TBA"],["title","Profile","routerLinkActive","active-link",1,"nav-link",3,"routerLink"],["aria-hidden","false","aria-label","profile","fontIcon","person",1,"link-icon"],["title","settings",1,"nav-link",3,"routerLink"],["aria-hidden","false","aria-label","settings","fontIcon","settings",1,"link-icon"],["title","logout",1,"nav-link","logout",3,"click"],["aria-hidden","false","aria-label","logout","fontIcon","logout",1,"link-icon"],["id","content"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),s(4," Logo "),r(),l(5,"sns-user-summary",4),i(6,"button",5),l(7,"mat-icon",6),i(8,"span"),s(9,"New post"),r()(),i(10,"div",7)(11,"div",8),l(12,"mat-icon",9),i(13,"span",10),s(14,"Home"),r()(),i(15,"div",11),l(16,"mat-icon",12),i(17,"span",10),s(18,"Search TBA"),r()(),i(19,"div",13),l(20,"mat-icon",14),i(21,"span",10),s(22,"Notifications TBA"),r()(),i(23,"div",15),l(24,"mat-icon",16),i(25,"span",10),s(26,"Bookmarks TBA"),r()(),i(27,"div",17),l(28,"mat-icon",18),i(29,"span",10),s(30,"Profile"),r()(),i(31,"div",19),l(32,"mat-icon",20),i(33,"span",10),s(34,"Settings"),r()(),i(35,"div",21),f("click",function(){return o.promptLogout()}),l(36,"mat-icon",22),i(37,"span",10),s(38,"Logout"),r()()()(),i(39,"section",23),l(40,"router-outlet"),r()()()),t&2&&(p(5),u("user",o.user()),p(22),u("routerLink",Fe(3,Qt,o.user().username)),p(4),u("routerLink",ke(5,Gt)))},dependencies:[V,ie,S,Ie,T,Te,F,De,ct],styles:[".index[_ngcontent-%COMP%]{--nav-width: 20rem;width:100%;min-height:100%;padding-left:calc(100vw - 100%);color:#c8c8c8;background-color:var(--sns-bg)}.index-sections[_ngcontent-%COMP%]{position:relative;height:100%;width:100%;max-width:fit-content;margin:auto}#sns-nav[_ngcontent-%COMP%]{position:fixed;top:0rem;display:flex;flex-direction:column;align-items:center;gap:1rem;width:var(--nav-width);height:calc(100% - 2rem);padding:1rem;box-sizing:border-box}.logo[_ngcontent-%COMP%]{height:3rem;text-align:center}sns-user-summary[_ngcontent-%COMP%]{width:100%}.new-post-btn[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;height:3rem;width:100%}.nav-list[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:1.5rem;margin-top:1.5rem}.nav-link[_ngcontent-%COMP%]{font-size:1.15rem;display:flex;flex-flow:row nowrap;gap:.25rem;align-items:end;text-decoration:none;color:transparent}.nav-link[_ngcontent-%COMP%]:hover{cursor:pointer;color:#5f92b2}.link-icon[_ngcontent-%COMP%]{margin:auto 0rem;-webkit-text-stroke-color:lightskyblue;-webkit-text-stroke-width:1px}.TBA[_ngcontent-%COMP%]{color:#f08080!important;-webkit-text-stroke-color:lightcoral!important}.link-text[_ngcontent-%COMP%], .active-link[_ngcontent-%COMP%]{color:#87cefa}.logout[_ngcontent-%COMP%]{margin-top:auto}#content[_ngcontent-%COMP%]{width:calc(100% - var(--nav-width));min-height:calc(100vh - 2rem);margin-left:var(--nav-width)}@media (max-width: 1295px){.index[_ngcontent-%COMP%]{--nav-width: 5rem}.nav-list[_ngcontent-%COMP%]{gap:2.5rem}.nav-link[_ngcontent-%COMP%]{justify-content:center;transform:scale(1.2)}.nav-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.new-post-btn[_ngcontent-%COMP%]{align-self:center;justify-content:center;padding:unset}.new-post-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:auto}.new-post-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}}"]})}}return n})();var dt=(()=>{class n extends G{constructor(e,t){super(),this.data=e,this.dialogRef=t}ngOnInit(){}close(){}logout(){this.dialogRef.close(),this.router.navigate(["/sns/logout"])}returnToHome(){this.dialogRef.close(),this.router.navigate(["/sns/home"])}static{this.\u0275fac=function(t){return new(t||n)(g(q),g(j))}}static{this.\u0275cmp=h({type:n,selectors:[["already-logged-in"]],features:[E],decls:13,vars:0,consts:[[1,"logged-in"],[1,"logged-in-header"],[1,"logged-in-content"],["mat-flat-button","",1,"return-btn",3,"click"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h5"),s(4,"Already Logged In"),r()()(),i(5,"mat-dialog-content")(6,"div",2)(7,"div"),s(8,"You are already logged in. Would you like to logout?"),r(),i(9,"button",3),f("click",function(){return o.logout()}),s(10,"Logout"),r(),i(11,"button",3),f("click",function(){return o.returnToHome()}),s(12,"Return to home"),r()()()())},dependencies:[Q,z,S,x],styles:[".logged-in[_ngcontent-%COMP%]{padding:1rem 0rem;box-sizing:border-box}.logged-in-header[_ngcontent-%COMP%]{padding:0rem 1rem;border-bottom:1px solid rgba(30,30,30,.5)}.logged-in-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;font-size:1.25rem;text-align:center}.return-btn[_ngcontent-%COMP%]{border-radius:3px}"]})}}return n})();var Jt=["loginForm"],ut=(()=>{class n{constructor(e,t,o){this.authService=e,this.router=t,this.route=o,this.sessionService=d(fe),this.dialog=d(H),this.returnTo=this.route.snapshot.queryParams.returnTo}ngOnInit(){this.authService.isLoggedIn$().subscribe(e=>{e&&this.dialog.open(dt,{disableClose:!0,restoreFocus:!0,scrollStrategy:new O})})}onSubmit(){let e=this.loginForm.value;this.authService.login$(e.username,e.password).subscribe({next:t=>{console.log(t),this.redirect()}})}redirect(){this.sessionService.newSession("login"),this.returnTo?this.router.navigateByUrl(this.returnTo):this.router.navigate(["../home"],{relativeTo:this.route})}static{this.\u0275fac=function(t){return new(t||n)(g(w),g(b),g(N))}}static{this.\u0275cmp=h({type:n,selectors:[["sns-login"]],viewQuery:function(t,o){if(t&1&&ye(Jt,5),t&2){let m;Me(m=Pe())&&(o.loginForm=m.first)}},decls:18,vars:0,consts:[["loginForm","ngForm"],[1,"sns-login"],[1,"sns-login-form",3,"submit"],["appearance","outline"],["name","username","ngModel","","matInput","","lowerCaseInput","","placeholder","Username..."],["name","password","type","password","ngModel","","matInput","","placeholder","Password..."],["mat-raised-button",""],["routerLink","/sns/register",1,"link"]],template:function(t,o){if(t&1){let m=k();i(0,"div",1)(1,"div")(2,"form",2,0),f("submit",function(){return M(m),P(o.onSubmit())}),i(4,"h3"),s(5,"Login"),r(),i(6,"mat-form-field",3)(7,"mat-label"),s(8,"Username"),r(),l(9,"input",4),r(),i(10,"mat-form-field",3)(11,"mat-label"),s(12,"Password"),r(),l(13,"input",5),r(),i(14,"button",6),s(15,"Submit"),r(),i(16,"a",7),s(17,"No account? Register here"),r()()()()}},dependencies:[T,F,ae,se,oe,U,re,$e,Ae,de,pe,ce,me,S,x,nt],styles:[".sns-login[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.sns-login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;min-width:10rem;max-width:30rem;width:100%;margin:auto;margin-top:3rem;padding:1rem;color:#000;border:1px solid black;border-radius:3px;background-color:#c8c8c8}.link[_ngcontent-%COMP%]{color:#00008b}"]})}}return n})();var ft=(n,a)=>{let e=d(b),t=d(w),o=()=>(console.log("Invalid credentials"),e.navigate(["/sns/login"],{queryParams:{returnTo:a.url}}),ve);return t.isLoggedIn$().pipe(Y(m=>m||(o(),!1)),Se((m,_)=>o()))},gt=(n,a)=>{let e=d(b),t=d(ge),o=()=>(console.log("User not confirmed"),e.navigate(["/sns/confirm-user"],{queryParams:{returnTo:a.url}}),ve);return t.isSecured$().pipe(Y(m=>m||(o(),!1)),Se((m,_)=>o()))};var ht=(()=>{class n extends G{constructor(e,t){super(),this.data=e,this.dialogRef=t}ngOnInit(){}close(){}return(){this.dialogRef.close(),this.router.navigate(["/sns/login"],{queryParams:{returnTo:this.data.returnTo}})}static{this.\u0275fac=function(t){return new(t||n)(g(q),g(j))}}static{this.\u0275cmp=h({type:n,selectors:[["registration-success"]],features:[E],decls:11,vars:0,consts:[[1,"registration-success"],[1,"success-header"],[1,"success-content"],["mat-flat-button","",1,"return-btn",3,"click"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h5"),s(4,"Registration Succcessful"),r()()(),i(5,"mat-dialog-content")(6,"div",2)(7,"div"),s(8,"You've succesfully registered, you may return to login."),r(),i(9,"button",3),f("click",function(){return o.return()}),s(10,"Return to login"),r()()()())},dependencies:[Q,z,S,x],styles:[".registration-success[_ngcontent-%COMP%]{padding:1rem 0rem;box-sizing:border-box}.success-header[_ngcontent-%COMP%]{padding:0rem 1rem;border-bottom:1px solid rgba(30,30,30,.5)}.success-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;font-size:1.25rem;text-align:center}.return-btn[_ngcontent-%COMP%]{border-radius:3px}"]})}}return n})();var Kt=()=>[F,se,oe,U,re,Ve,Ue,pe,ce,me,je,x,import("./chunk-2RGGOVZK.js").then(n=>n.LowercaseInputDirective),import("./chunk-BOS2I2PJ.js").then(n=>n.SecurityQuestionsFormComponent)];function Xt(n,a){n&1&&(i(0,"mat-hint"),s(1,"Enter a username"),r())}function Zt(n,a){n&1&&(i(0,"mat-hint"),s(1,"Username contains invalid characters"),r())}function en(n,a){n&1&&(i(0,"mat-hint"),s(1,"Invalid username. Must not start with '.', '_' OR be consecutive"),r())}function tn(n,a){n&1&&(i(0,"mat-hint"),s(1,"Enter a password"),r())}function nn(n,a){n&1&&(i(0,"mat-hint"),s(1,"Password cannot contain spaces"),r())}function on(n,a){n&1&&(i(0,"mat-hint"),s(1,"Enter a display name"),r())}function rn(n,a){if(n&1){let e=k();i(0,"div")(1,"form",1),f("submit",function(){M(e);let o=c();return P(o.register())}),i(2,"h3"),s(3,"Register"),r(),i(4,"mat-form-field",2)(5,"mat-label"),s(6,"Username"),r(),l(7,"input",3),v(8,Xt,2,0,"mat-hint")(9,Zt,2,0,"mat-hint")(10,en,2,0,"mat-hint"),r(),i(11,"mat-form-field",2)(12,"mat-label"),s(13,"Password"),r(),l(14,"input",4),v(15,tn,2,0,"mat-hint")(16,nn,2,0,"mat-hint"),r(),i(17,"mat-form-field",2)(18,"mat-label"),s(19,"DisplayName"),r(),l(20,"input",5),v(21,on,2,0,"mat-hint"),r(),l(22,"security-questions-form",6),i(23,"button",7),s(24,"Submit"),r(),i(25,"a",8),s(26,"Already have an account? Login Here"),r()()()}if(n&2){let e=c();p(),u("formGroup",e.registrationForm),p(7),C(e.username.hasError("required")?8:e.username.hasError("invalidUsernameCharacter")?9:e.username.hasError("invalidUsernameSeq")?10:-1),p(7),C(e.password.hasError("required")?15:e.password.hasError("invalidPassword")?16:-1),p(6),C(e.password.hasError("required")?21:-1),p(),u("form",e.registrationForm)("questions",e.questions())("numberQuestions",e.numberQuestions)}}var _t=(()=>{class n{constructor(e,t,o){this.authService=e,this.router=t,this.route=o,this.userVerifyService=d(ge),this.toastService=d(Oe),this.numberQuestions=he.NUMBER_REGISTRATION_QUESTIONS,this.dialog=d(H),this.returnTo=this.route.snapshot.queryParams.returnTo,this.questions=this.userVerifyService.questions$;let m=new Ce({username:new I(void 0,[D.required,D.minLength(he.USERNAME_MIN_LENGTH),X.invalidUsernameCharacter(),X.invalidUsernameSeq()]),password:new I(void 0,[D.required,D.minLength(he.PASSWORD_MIN_LENGTH),X.invalidPassword()]),displayName:new I(void 0,D.required),questions:new Be([])});for(let _=0;_<this.numberQuestions;_++)m.controls.questions.push(new Ce({question:new I(void 0,{nonNullable:!0,validators:D.required}),answer:new I(void 0,{nonNullable:!0,validators:[D.required,X.invalidSecurityQuestionAnswerSeq()]})}));this.registrationForm=m}ngOnInit(){}getQuestion(e,t){return t?this.questionsFormArray.at(e).controls.answer:this.questionsFormArray.at(e).controls.question}register(){let e=this.registrationForm.value,t=this.questionsArrayToMap(this.formatQuestions());this.authService.register$(e.username,e.password,e.displayName,t).subscribe({next:o=>{let m=this.dialog.open(ht,{restoreFocus:!1,scrollStrategy:new O,closeOnNavigation:!0,data:{state:this.returnTo}})},error:o=>{console.log(o),this.toastService.show({type:"danger",source_feature:"sns",header:"Error",body:"Failed to register"})}})}formatQuestions(){let e=[];for(let t=0;t<this.numberQuestions;t++){let o=this.getQuestion(t).value,m=this.getQuestion(t,!0).value;m&&e.push({question:o,answer:m.trim()})}return e}questionsArrayToMap(e){return e.reduce((t,o)=>(t[o.question]=o.answer,t),{})}get username(){return this.registrationForm.controls.username}get password(){return this.registrationForm.controls.password}get displayName(){return this.registrationForm.controls.displayName}get questionsFormArray(){return this.registrationForm.get("questions")}static{this.\u0275fac=function(t){return new(t||n)(g(w),g(b),g(N))}}static{this.\u0275cmp=h({type:n,selectors:[["sns-register"]],decls:4,vars:1,consts:[[1,"sns-register"],[1,"sns-register-form",3,"submit","formGroup"],["appearance","outline"],["name","username","formControlName","username","matInput","","lowerCaseInput","","placeholder","Username...","cdkFocusInitial",""],["name","password","formControlName","password","type","password","matInput","","placeholder","Password..."],["name","displayName","formControlName","displayName","matInput","","placeholder","Display name..."],[3,"form","questions","numberQuestions"],["mat-raised-button","",1,"submit-btn"],["routerLink","/sns/login",1,"link"]],template:function(t,o){t&1&&(i(0,"div",0),v(1,rn,27,7),R(2,1,Kt),r()),t&2&&(p(2),A(o.questions().length>0))},dependencies:[T,le,ae,de,S,qe],styles:[".sns-register[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.sns-register-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;min-width:10rem;max-width:30rem;width:100%;margin:auto;margin-top:3rem;padding:1rem;color:#000;border:1px solid black;border-radius:3px;background-color:#c8c8c8}.link[_ngcontent-%COMP%]{color:#00008b}"]})}}return n})();var sn=()=>[F,x];function an(n,a){n&1&&(i(0,"div",0)(1,"div",1)(2,"h5"),s(3,"Successfully Logged Out"),r(),i(4,"a",2),s(5,"No account? Register here"),r(),i(6,"a",3),s(7,"Already have an account? Login here"),r()()())}function ln(n,a){if(n&1){let e=k();i(0,"div",0)(1,"div",1)(2,"h5"),s(3,"Would you like to logout?"),r(),i(4,"button",4),f("click",function(){M(e);let o=c(2);return P(o.logout())}),s(5,"Logout"),r(),i(6,"a",5),s(7,"Cancel"),r()()()}}function mn(n,a){if(n&1&&v(0,an,8,0,"div",0)(1,ln,8,0,"div",0),n&2){let e=c();C(e.isLoggedIn=="no"?0:1)}}function cn(n,a){n&1&&(i(0,"div",0)(1,"div",1)(2,"h5"),s(3,"Checking login status"),r()()())}var vt=(()=>{class n{constructor(){this.authService=d(w),this.authService.isLoggedIn$().pipe(J(3)).subscribe(e=>{e?this.isLoggedIn="yes":this.isLoggedIn="no"})}ngOnInit(){}logout(){this.authService.logout$().pipe(J(3)).subscribe(()=>{this.isLoggedIn="no"})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=h({type:n,selectors:[["logout-page"]],decls:4,vars:1,consts:[[1,"sns-logout"],[1,"sns-logout-form"],["routerLink","/sns/register",1,"link"],["routerLink","/sns/login",1,"link"],["mat-flat-button","",3,"click"],["routerLink","/sns/home",1,"link"]],template:function(t,o){t&1&&(v(0,mn,2,1)(1,cn,4,0),R(2,0,sn,null,1)),t&2&&(p(2),A(o.isLoggedIn))},dependencies:[T,S],styles:[".sns-logout[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.sns-logout-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;min-width:10rem;max-width:30rem;width:100%;margin:auto;margin-top:3rem;padding:1rem;color:#000;border:1px solid black;border-radius:3px;background-color:#c8c8c8}.link[_ngcontent-%COMP%]{color:#00008b}"]})}}return n})();var pn=[{path:"home",component:st},{path:"confirm-user",loadComponent:()=>import("./chunk-FP3K2L7O.js").then(n=>n.SnsVerifyUserComponent)},{path:"posts/:id",loadComponent:()=>import("./chunk-CZUF5YQL.js").then(n=>n.SnsViewPostComponent)},{path:"settings",loadComponent:()=>import("./chunk-X3T5XV4Y.js").then(n=>n.SnsSettingsComponent),canActivate:[gt]},{path:":username",loadComponent:()=>import("./chunk-QAV6VCSZ.js").then(n=>n.SnsProfileComponent)},{path:":username/:section",loadComponent:()=>import("./chunk-QAV6VCSZ.js").then(n=>n.SnsProfileComponent)},{path:"**",redirectTo:"home",pathMatch:"full"}],go=[{path:"login",component:ut},{path:"logout",component:vt},{path:"register",component:_t},{path:"",component:pt,loadChildren:()=>pn,canActivate:[ft]}];export{pn as contentRoutes,go as snsRoutes};
