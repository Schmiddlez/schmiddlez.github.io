import{a as T,b as j,d as P}from"./chunk-GBDRTGKW.js";import{f as L,g as v,i as u,k as O,n as I,y as M}from"./chunk-4B4OTB3X.js";import{a as $}from"./chunk-4ZTZTUK3.js";import"./chunk-2XN2X2Z5.js";import{b as V}from"./chunk-HK5PXVLE.js";import"./chunk-52426QOG.js";import"./chunk-TCERKDUY.js";import"./chunk-K6APHVDK.js";import"./chunk-2ZA7EJYY.js";import"./chunk-7WIWJOLM.js";import{$a as l,Ca as E,Db as m,Gb as x,Lb as y,Mb as R,Nb as a,Ob as s,Pb as h,Rb as w,Tb as f,Ub as c,da as b,dc as p,fc as F,ka as S,la as _,lb as k,vc as A}from"./chunk-6543YJRO.js";var G=(n,d)=>d.id;function N(n,d){if(n&1){let e=w();a(0,"div",12)(1,"raid-post",20),f("click",function(){let t=S(e).$implicit,i=c();return _(i.toggleSignup(t))}),s()()}if(n&2){let e=d.$implicit,r=c();l(),x(r.raidStatus(e)),m("raidpost",e)("player",r.character.player)("shortened",!0)}}function D(n,d){if(n&1&&(a(0,"div",12)(1,"span"),p(2),s()()),n&2){let e=c();l(2),F("Character has no ",e.repeats.length>0?"filtered":""," current raids")}}function U(n,d){if(n&1){let e=w();a(0,"div",12)(1,"raid-post",20),f("click",function(){let t=S(e).$implicit,i=c();return _(i.toggleSignup(t))}),s()()}if(n&2){let e=d.$implicit,r=c();l(),x(r.raidStatus(e)),m("raidpost",e)("player",r.character.player)("shortened",!0)}}function z(n,d){if(n&1&&(a(0,"div",12)(1,"span"),p(2),s()()),n&2){let e=c();l(2),F("No Available ",e.repeats().length>0?"Filtered":""," Raids")}}var te=(()=>{class n{constructor(){this.playerService=b(V),this.characterService=b(T),this.raidService=b(j),this.repeats=E([]),this.repeatSignupList=[],this.subs=[],this.repeatSignupForm=new v({}),this.currentRepeatFilterForm=new v({raid:new u("Any"),server:new u("Any"),status:new u("Any")}),this.availableRepeatFilterForm=new v({raid:new u("Any"),server:new u("Any"),status:new u("Any")}),this.repeats=A(()=>{let e=[];for(let r of[...this.character.repeats,...this.playerService.myRepeats$()])e.findIndex(t=>t.id===r.id)<=-1&&e.push(r);return e})}ngOnInit(){this.repeatSignupList=Object.assign(this.repeatSignupList,this.character.repeats)}ngOnDestroy(){for(let e of this.subs)e.unsubscribe()}get currentRaids(){if(!this.character.repeats)return[];let e=[...this.character.repeats];for(let[r,t]of Object.entries(this.currentRepeatFilterForm.controls))if(t.value!="Any")switch(r){case"raid":e=e.filter(i=>i.properties.loaRaid.name==t.value||t.value==="");break;case"server":e=e.filter(i=>i.server.name==t.value||t.value==="");break;case"status":break}return e}get availableRaids(){if(!this.character.repeats)return[];let e=[...this.repeats()];for(let[r,t]of Object.entries(this.availableRepeatFilterForm.controls))if(t.value!="Any")switch(r){case"raid":e=e.filter(i=>i.properties.loaRaid.name==t.value||t.value==="");break;case"server":e=e.filter(i=>i.server.name==t.value||t.value==="");break;case"status":t.value=="Not Signed Up"?e=e.filter(i=>!i.repeatingSignups.find(o=>o.id==this.character.id)):t.value=="Signed Up"&&(e=e.filter(i=>i.repeatingSignups.find(o=>o.id==this.character.id)));break}return e}toggleSignup(e){let r=this.repeatSignupList.findIndex(t=>t.id===e.id);r==-1?this.repeatSignupList.push(e):this.repeatSignupList.splice(r,1)}raidStatus(e){let r=this.character.repeats,t=this.repeatSignupList,i=!!r.find(C=>C.id===e.id),o=!!t.find(C=>C.id===e.id),g={};return i&&o&&(g.backgroundColor="green"),i&&!o&&(g.backgroundColor="red"),!i&&o&&(g.backgroundColor="yellow"),g}submit(){let e=this.character.repeats.filter(t=>!this.repeatSignupList.find(i=>i.id==t.id));e.forEach(t=>{var i=t.repeatingSignups.findIndex(o=>o.id===this.character.id);i>-1&&t.repeatingSignups.splice(i,1)});let r=this.repeatSignupList.filter(t=>!this.character.repeats.find(i=>i.id==t.id));r.forEach(t=>{var i=t.repeatingSignups.findIndex(o=>o.id===this.character.id);if(i<=-1){let o=structuredClone(this.character);o.raids.length=0,t.repeatingSignups.push(o)}}),this.character.repeats.length=0,Object.assign(this.character.repeats,this.repeatSignupList),console.log(this.character),this.characterService.signupRepeat(this.character),this.characterService.signupChange([...e,...r])}reset(){this.repeatSignupList.length=0,Object.assign(this.repeatSignupList,this.character.repeats)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=k({type:n,selectors:[["character-repeats-edit"]],inputs:{character:"character"},decls:42,vars:5,consts:[[1,"d-flex","h-100","flex-column","gap-3",3,"submit","formGroup"],[1,"d-flex","flex-column"],[1,"d-flex","gap-2"],["type","button","data-bs-toggle","collapse","data-bs-target","#chrCurrentRepeats","aria-expanded","true","aria-controls","chrCurrentRepeats",1,"btn","btn-secondary","mb-3","flex-grow-1"],[1,"dropdown","filter-dropdown"],["type","button","title","Filter Current Raids","id","chrCurrentRepeatFilter","data-bs-toggle","dropdown","data-bs-auto-close","outside","aria-expanded","false",1,"position-relative","btn","btn-secondary","dropdown-toggle","ps-5"],[1,"bi-filter","filter-symbol"],["aria-labelledby","chrCurrentRepeatFilter",1,"dropdown-menu","w-20r","raid-filter"],[1,"dropdown-header"],[1,"raid-filter",3,"filterForm"],["id","chrCurrentRepeats",1,"collapse"],[1,"d-flex","flex-wrap","gap-2","justify-content-center"],[1,"d-flex","mb-2"],["type","button","data-bs-toggle","collapse","data-bs-target","#chrAvailableRepeats","aria-expanded","true","aria-controls","chrAvailableRepeats",1,"btn","btn-secondary","mb-3","flex-grow-1"],["type","button","title","Filter Available Raids","id","chrAvailableRepeatsFilter","data-bs-toggle","dropdown","data-bs-auto-close","outside","aria-expanded","false",1,"position-relative","btn","btn-secondary","dropdown-toggle","ps-5"],["aria-labelledby","chrAvailableRepeatsFilter",1,"dropdown-menu","w-20r","raid-filter"],["id","chrAvailableRepeats",1,"collapse","show"],[1,"d-flex","flex-grow-1","align-items-end","justify-content-end","gap-2"],["type","button",1,"btn","btn-warning","flex-grow-1","mw-15r",3,"click"],["type","submit",1,"btn","btn-success","flex-grow-1","mw-15r"],[3,"click","raidpost","player","shortened"]],template:function(r,t){r&1&&(a(0,"form",0),f("submit",function(){return t.submit()}),a(1,"div",1)(2,"div",2)(3,"button",3),p(4,"Current Repeats"),s(),a(5,"div",4)(6,"button",5),h(7,"i",6),s(),a(8,"ul",7)(9,"li")(10,"h6",8),p(11,"Filter Raids"),s()(),a(12,"li"),h(13,"raid-filter",9),s()()()(),a(14,"div",10)(15,"div",11),y(16,N,2,5,"div",12,G,!1,D,3,1,"div",12),s()()(),a(19,"div",1)(20,"div",2)(21,"button",13),p(22,"Available Repeats"),s(),a(23,"div",4)(24,"button",14),h(25,"i",6),s(),a(26,"ul",15)(27,"li")(28,"h6",8),p(29,"Filter Raids"),s()(),a(30,"li"),h(31,"raid-filter",9),s()()()(),a(32,"div",16)(33,"div",11),y(34,U,2,5,"div",12,G,!1,z,3,1,"div",12),s()()(),a(37,"div",17)(38,"button",18),f("click",function(){return t.reset()}),p(39,"Reset"),s(),a(40,"button",19),p(41,"Save Raids"),s()()()),r&2&&(m("formGroup",t.repeatSignupForm),l(13),m("filterForm",t.currentRepeatFilterForm),l(3),R(t.currentRaids),l(15),m("filterForm",t.availableRepeatFilterForm),l(3),R(t.availableRaids))},dependencies:[P,$,M,O,L,I],styles:["raid-post[_ngcontent-%COMP%]{border:1px solid transparent;padding:1px;border-radius:3px}raid-post[_ngcontent-%COMP%]:hover{cursor:pointer;scale:1.01;border:1px solid var(--discord-content-text)}.raid-filter[_ngcontent-%COMP%]{background-color:var(--discord-menu)}.filter-dropdown[_ngcontent-%COMP%]{list-style-type:none!important}.filter-symbol[_ngcontent-%COMP%]{position:absolute;left:1rem;top:50%;transform:translateY(-50%);font-size:1.75rem;line-height:0}"]})}}return n})();export{te as CharacterRepeatsEditComponent};
