import{a as T,b as j,d as P}from"./chunk-GBDRTGKW.js";import{f as L,g as v,i as u,k as O,n as I,y as M}from"./chunk-4B4OTB3X.js";import{a as $}from"./chunk-4ZTZTUK3.js";import"./chunk-2XN2X2Z5.js";import{b as V}from"./chunk-HK5PXVLE.js";import"./chunk-52426QOG.js";import"./chunk-TCERKDUY.js";import"./chunk-K6APHVDK.js";import"./chunk-2ZA7EJYY.js";import"./chunk-7WIWJOLM.js";import{$a as o,Ca as E,Db as m,Gb as y,Lb as S,Mb as R,Nb as a,Ob as s,Pb as h,Rb as w,Tb as f,Ub as p,da as b,dc as l,fc as F,ka as _,la as x,lb as k,vc as A}from"./chunk-6543YJRO.js";var G=(n,c)=>c.id;function N(n,c){if(n&1){let e=w();a(0,"div",12)(1,"raid-post",20),f("click",function(){let t=_(e).$implicit,i=p();return x(i.toggleSignup(t))}),s()()}if(n&2){let e=c.$implicit,r=p();o(),y(r.raidStatus(e)),m("raidpost",e)("player",r.character.player)("shortened",!0)}}function D(n,c){if(n&1&&(a(0,"div",12)(1,"span"),l(2),s()()),n&2){let e=p();o(2),F("Character has no ",e.raids().length>0?"filtered":""," current raids")}}function U(n,c){if(n&1){let e=w();a(0,"div",12)(1,"raid-post",20),f("click",function(){let t=_(e).$implicit,i=p();return x(i.toggleSignup(t))}),s()()}if(n&2){let e=c.$implicit,r=p();o(),y(r.raidStatus(e)),m("raidpost",e)("player",r.character.player)("shortened",!0)}}function z(n,c){if(n&1&&(a(0,"div",12)(1,"span"),l(2),s()()),n&2){let e=p();o(2),F("No Available ",e.raids().length>0?"Filtered":""," Raids")}}var te=(()=>{class n{constructor(){this.playerService=b(V),this.characterService=b(T),this.raidService=b(j),this.raids=E([]),this.raidSignupList=[],this.subs=[],this.raidSignupForm=new v({}),this.currentRaidFilterForm=new v({raid:new u("Any"),server:new u("Any"),status:new u("Any")}),this.availableRaidFilterForm=new v({raid:new u("Any"),server:new u("Any"),status:new u("Any")}),this.raids=A(()=>{let e=[];for(let r of[...this.character.raids,...this.playerService.myRaids$()])e.findIndex(t=>t.id===r.id)<=-1&&e.push(r);return e})}ngOnInit(){this.raidSignupList=Object.assign(this.raidSignupList,this.character.raids)}ngOnDestroy(){for(let e of this.subs)e.unsubscribe()}get currentRaids(){if(!this.character.raids)return[];let e=[...this.character.raids];for(let[r,t]of Object.entries(this.currentRaidFilterForm.controls))if(t.value!="Any")switch(r){case"raid":e=e.filter(i=>i.properties.loaRaid.name==t.value||t.value==="");break;case"server":e=e.filter(i=>i.server.name==t.value||t.value==="");break;case"status":break}return e}get availableRaids(){if(!this.character.raids)return[];let e=[...this.raids()];for(let[r,t]of Object.entries(this.availableRaidFilterForm.controls))if(t.value!="Any")switch(r){case"raid":e=e.filter(i=>i.properties.loaRaid.name==t.value||t.value==="");break;case"server":e=e.filter(i=>i.server.name==t.value||t.value==="");break;case"status":t.value=="Not Signed Up"?e=e.filter(i=>!i.signups.find(d=>d.id==this.character.id)):t.value=="Signed Up"&&(e=e.filter(i=>i.signups.find(d=>d.id==this.character.id)));break}return e}toggleSignup(e){let r=this.raidSignupList.findIndex(t=>t.id===e.id);r==-1?this.raidSignupList.push(e):this.raidSignupList.splice(r,1)}raidStatus(e){let r=this.character.raids,t=this.raidSignupList,i=!!r.find(C=>C.id===e.id),d=!!t.find(C=>C.id===e.id),g={};return i&&d&&(g.backgroundColor="green"),i&&!d&&(g.backgroundColor="red"),!i&&d&&(g.backgroundColor="yellow"),g}submit(){let e=this.character.raids.filter(t=>!this.raidSignupList.find(i=>i.id==t.id));e.forEach(t=>{var i=t.signups.findIndex(d=>d.id===this.character.id);i>-1&&t.signups.splice(i,1)});let r=this.raidSignupList.filter(t=>!this.character.raids.find(i=>i.id==t.id));r.forEach(t=>{var i=t.signups.findIndex(d=>d.id===this.character.id);if(i<=-1){let d=structuredClone(this.character);d.raids.length=0,t.signups.push(d)}}),this.character.raids.length=0,Object.assign(this.character.raids,this.raidSignupList),console.log(this.character),this.characterService.signup(this.character),this.characterService.signupChange([...e,...r])}reset(){this.raidSignupList.length=0,Object.assign(this.raidSignupList,this.character.raids)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=k({type:n,selectors:[["character-raids-edit"]],inputs:{character:"character"},decls:42,vars:5,consts:[[1,"d-flex","h-100","flex-column","gap-3",3,"submit","formGroup"],[1,"d-flex","flex-column"],[1,"d-flex","gap-2"],["type","button","data-bs-toggle","collapse","data-bs-target","#chrCurrentRaids","aria-expanded","true","aria-controls","chrCurrentRaids",1,"btn","btn-secondary","mb-3","flex-grow-1"],[1,"dropdown","filter-dropdown"],["type","button","title","Filter Current Raids","id","chrCurrentRaidFilter","data-bs-toggle","dropdown","data-bs-auto-close","outside","aria-expanded","false",1,"position-relative","btn","btn-secondary","dropdown-toggle","ps-5"],[1,"bi-filter","filter-symbol"],["aria-labelledby","chrCurrentRaidFilter",1,"dropdown-menu","w-20r","raid-filter"],[1,"dropdown-header"],[1,"raid-filter",3,"filterForm"],["id","chrCurrentRaids",1,"collapse"],[1,"d-flex","flex-wrap","gap-2","justify-content-center"],[1,"d-flex","mb-2"],["type","button","data-bs-toggle","collapse","data-bs-target","#chrAvailableRaids","aria-expanded","true","aria-controls","chrAvailableRaids",1,"btn","btn-secondary","mb-3","flex-grow-1"],["type","button","title","Filter Available Raids","id","chrAvailableRaidsFilter","data-bs-toggle","dropdown","data-bs-auto-close","outside","aria-expanded","false",1,"position-relative","btn","btn-secondary","dropdown-toggle","ps-5"],["aria-labelledby","chrAvailableRaidsFilter",1,"dropdown-menu","w-20r","raid-filter"],["id","chrAvailableRaids",1,"collapse","show"],[1,"d-flex","flex-grow-1","align-items-end","justify-content-end","gap-2"],["type","button",1,"btn","btn-warning","flex-grow-1","mw-15r",3,"click"],["type","submit",1,"btn","btn-success","flex-grow-1","mw-15r"],[3,"click","raidpost","player","shortened"]],template:function(r,t){r&1&&(a(0,"form",0),f("submit",function(){return t.submit()}),a(1,"div",1)(2,"div",2)(3,"button",3),l(4,"Current Raids"),s(),a(5,"div",4)(6,"button",5),h(7,"i",6),s(),a(8,"ul",7)(9,"li")(10,"h6",8),l(11,"Filter Raids"),s()(),a(12,"li"),h(13,"raid-filter",9),s()()()(),a(14,"div",10)(15,"div",11),S(16,N,2,5,"div",12,G,!1,D,3,1,"div",12),s()()(),a(19,"div",1)(20,"div",2)(21,"button",13),l(22,"Available Raids"),s(),a(23,"div",4)(24,"button",14),h(25,"i",6),s(),a(26,"ul",15)(27,"li")(28,"h6",8),l(29,"Filter Raids"),s()(),a(30,"li"),h(31,"raid-filter",9),s()()()(),a(32,"div",16)(33,"div",11),S(34,U,2,5,"div",12,G,!1,z,3,1,"div",12),s()()(),a(37,"div",17)(38,"button",18),f("click",function(){return t.reset()}),l(39,"Reset"),s(),a(40,"button",19),l(41,"Save Raids"),s()()()),r&2&&(m("formGroup",t.raidSignupForm),o(13),m("filterForm",t.currentRaidFilterForm),o(3),R(t.currentRaids),o(15),m("filterForm",t.availableRaidFilterForm),o(3),R(t.availableRaids))},dependencies:[P,$,M,O,L,I],styles:["raid-post[_ngcontent-%COMP%]{border:1px solid transparent;padding:1px;border-radius:3px}raid-post[_ngcontent-%COMP%]:hover{cursor:pointer;scale:1.01;border:1px solid var(--discord-content-text)}.raid-filter[_ngcontent-%COMP%]{background-color:var(--discord-menu)}.filter-dropdown[_ngcontent-%COMP%]{list-style-type:none!important}.filter-symbol[_ngcontent-%COMP%]{position:absolute;left:1rem;top:50%;transform:translateY(-50%);font-size:1.75rem;line-height:0}"]})}}return n})();export{te as CharacterRaidsEditComponent};
