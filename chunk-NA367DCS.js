import{a as _e}from"./chunk-SDTNPKNQ.js";import{a as Z,b as ee,c as te,d as ne,e as se,f as ie,g as oe,h as de}from"./chunk-FEXUPZQG.js";import{a as he}from"./chunk-GTLMDP7R.js";import{a as le}from"./chunk-A7EGG3YZ.js";import"./chunk-LZDPGLQC.js";import{a as ce}from"./chunk-WNTG7EGI.js";import{a as pe}from"./chunk-WKW2DIE4.js";import"./chunk-VE7E4CMI.js";import{a as me}from"./chunk-ZBBT4DFR.js";import{a as ue}from"./chunk-PQ5B7Q3D.js";import"./chunk-RQELFUR7.js";import"./chunk-I7H33XEW.js";import"./chunk-ZB6RFN2X.js";import"./chunk-ZFOFE4YQ.js";import"./chunk-LUY36RVE.js";import"./chunk-INS7BFHF.js";import{a as ae}from"./chunk-MOY26VGU.js";import"./chunk-AJP6ELTP.js";import{a as re}from"./chunk-6WBH7IPC.js";import{b as k,c as Y}from"./chunk-LDB6UGBE.js";import"./chunk-3PMNG65X.js";import{a as Q,c as G,g as W,h as J,i as K,j as X}from"./chunk-4P6JCT6G.js";import{C as N,b as z,f as L,j as A,n as H}from"./chunk-ESTKDGOR.js";import"./chunk-HU7WFQWJ.js";import{a as j,b as O}from"./chunk-QCGIDFDQ.js";import{b as D,d as E}from"./chunk-RA5YA7SP.js";import"./chunk-AE4C5XQ6.js";import"./chunk-C5RMYWSX.js";import"./chunk-P4ZELJWN.js";import{b as R,d as F,i as T}from"./chunk-CG5ODPV4.js";import"./chunk-OQ23N4OO.js";import"./chunk-MB2EZ7OD.js";import{$ as U,Ba as b,Fa as q,Ib as p,Ob as h,Rb as x,Sb as S,Tb as i,Ub as a,Vb as d,Xb as P,Zb as f,_b as s,a as V,b as I,bb as B,cb as l,db as g,fa as v,jc as m,kc as C,ma as w,na as y,pb as $,wb as _}from"./chunk-UUT3EF6T.js";var Ce=(()=>{class n{constructor(){this.BASE_URL="/search",this.snsHttp=v(re),this.results={posts:{page:0,loading:!1,results:q([])},users:{page:0,loading:!1,results:q([])}},this.results$={posts:{page:0,loading:!1,results:this.results.posts.results.asReadonly()},users:{page:0,loading:!1,results:this.results.users.results.asReadonly()}},this.outgoingRequests={},this.postSearchResults$=this.results.posts.results.asReadonly(),this.userSearchResults$=this.results.users.results.asReadonly()}searchForPosts(e){let t="posts";this.outgoingRequests[t]&&!this.outgoingRequests[t].closed&&this.outgoingRequests[t].unsubscribe(),this.results[t].loading=!0,this.results$[t].loading=!0,this.results[t].results.set([]),this.outgoingRequests[t]=this.searchPosts$(e).subscribe({next:r=>{this.results[t].query=e,this.results[t].results.set(r),this.results[t].page=1,this.results$[t].query=e,this.results$[t].page=1},error:r=>{console.log(r)}}),this.outgoingRequests[t].add(()=>{this.results[t].loading=!1,this.results$[t].loading=!1})}searchForUsers(e){let t="users";this.outgoingRequests[t]&&!this.outgoingRequests[t].closed&&this.outgoingRequests[t].unsubscribe(),this.results[t].loading=!0,this.results$[t].loading=!0,this.results[t].results.set([]),this.outgoingRequests[t]=this.searchUsers$(e).subscribe(r=>{this.results[t].query=e,this.results[t].results.set(r),this.results[t].page=1,this.results$[t].query=e,this.results$[t].page=1}),this.outgoingRequests[t].add(()=>{this.results[t].loading=!1,this.results$[t].loading=!1})}loadMoreResults(e){if(!this.results[e].loading){var t=void 0;switch(e){case"posts":let r=this.results[e].query;r&&(t=this.searchPosts$(I(V({},r),{page:this.results[e].page})));break;case"users":let c=this.results[e].query;c&&(t=this.searchUsers$(I(V({},c),{page:this.results[e].page})));break}t&&this.handleSearchRequest(t,e)}}handleSearchRequest(e,t){let r=this.results[t].page;this.results[t].loading=!0,this.results$[t].loading=!0,this.outgoingRequests[t]=e.subscribe(c=>{this.results[t].results.update(u=>[...u,...c]),this.results[t].page=r+1,this.results$[t].page=r+1}),this.outgoingRequests[t].add(()=>{this.results[t].loading=!1,this.results$[t].loading=!1})}searchPosts$(e){return this.get$(`${this.BASE_URL}/posts?${this.params(e)}`)}searchUsers$(e){return this.get$(`${this.BASE_URL}/users?${this.params(e)}`)}params(e){var t=[];return t.push(`query=${e.query}`),e.after&&t.push(`after=${e.after}`),e.before&&t.push(`before=${e.before}`),e.sort&&t.push(`sort=${e.sort}`),e.type&&t.push(`type=${e.type}`),e.page=e.page||0,t.push(`page=${e.page}`),t.join("&")}get$(e){return this.snsHttp.get$(e)}post$(e,t){return this.snsHttp.post$(e,t)}delete$(e){return this.snsHttp.delete$(e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var M=(n,o)=>o.id;function Se(n,o){if(n&1){let e=P();i(0,"div",13)(1,"button",15),f("click",function(r){w(e);let c=s().$implicit,u=s(2);return y(u.isFollowing(c)?u.unfollow(c,r):u.follow(c,r))}),i(2,"span"),m(3),a()()()}if(n&2){let e=s().$implicit,t=s(2);l(3),C(t.isFollowing(e)?"Unfollow":"Follow")}}function ve(n,o){if(n&1){let e=P();i(0,"div",7),f("click",function(r){let c=w(e).$implicit,u=s(2);return y(u.toProfile(r,c.username))}),i(1,"div",8),d(2,"sns-user-avatar",9),i(3,"div",10)(4,"span",11),m(5),a(),i(6,"span",12),m(7),a()(),_(8,Se,4,1,"div",13),a(),i(9,"div",14)(10,"p"),m(11),a()()()}if(n&2){let e=o.$implicit,t=s(2);l(2),p("username",e.username)("avatar",e.avatar)("size","4.5rem"),l(2),p("title",e.displayName),l(),C(e.displayName),l(),p("title",e.username),l(),C("@"+e.username),l(),h(e.id!=t.me().id?8:-1),l(3),C(e.about)}}function we(n,o){if(n&1&&(i(0,"div",2)(1,"h3"),m(2,"People"),a(),i(3,"div",5),x(4,ve,12,9,"div",6,M),a()()),n&2){let e=s();l(4),S(e.userResults().slice(0,3))}}function ye(n,o){if(n&1&&d(0,"sns-basic-post",18),n&2){let e=s().$implicit,t=s(2);p("post",e)("user",t.me())}}function be(n,o){if(n&1&&d(0,"sns-basic-post",18),n&2){let e=s().$implicit,t=s(2);p("post",e)("user",t.me())}}function Pe(n,o){if(n&1&&d(0,"sns-announcement",18),n&2){let e=s().$implicit,t=s(2);p("post",t.announcement(e))("user",t.me())}}function Me(n,o){if(n&1&&d(0,"sns-comment",18),n&2){let e=s().$implicit,t=s(2);p("post",t.comment(e))("user",t.me())}}function $e(n,o){if(n&1&&d(0,"sns-pictorial",18),n&2){let e=s().$implicit,t=s(2);p("post",t.pictorial(e))("user",t.me())}}function Re(n,o){if(n&1&&d(0,"sns-article",18),n&2){let e=s().$implicit,t=s(2);p("post",t.article(e))("user",t.me())}}function Fe(n,o){if(n&1&&_(0,ye,1,2,"sns-basic-post",18)(1,be,1,2,"sns-basic-post",18)(2,Pe,1,2,"sns-announcement",18)(3,Me,1,2,"sns-comment",18)(4,$e,1,2,"sns-pictorial",18)(5,Re,1,2,"sns-article",18),n&2){let e,t=o.$implicit;h((e=t.type)==="basic"?0:e==="post"?1:e==="announcement"?2:e==="comment"?3:e==="pictorial"?4:e==="article"?5:-1)}}function Te(n,o){n&1&&(i(0,"div",17)(1,"h3"),m(2,"No Results Found"),a()())}function Ee(n,o){if(n&1&&(i(0,"div",3)(1,"h3"),m(2,"Posts"),a(),i(3,"div",16),x(4,Fe,6,1,null,null,M,!1,Te,3,0,"div",17),a()()),n&2){let e=s();l(4),S(e.postResults())}}function Oe(n,o){if(n&1){let e=P();i(0,"div",13)(1,"button",15),f("click",function(r){w(e);let c=s().$implicit,u=s(2);return y(u.isFollowing(c)?u.unfollow(c,r):u.follow(c,r))}),i(2,"span"),m(3),a()()()}if(n&2){let e=s().$implicit,t=s(2);l(3),C(t.isFollowing(e)?"Unfollow":"Follow")}}function ke(n,o){if(n&1){let e=P();i(0,"div",7),f("click",function(r){let c=w(e).$implicit,u=s(2);return y(u.toProfile(r,c.username))}),i(1,"div",8),d(2,"sns-user-avatar",9),i(3,"div",10)(4,"span",11),m(5),a(),i(6,"span",12),m(7),a()(),_(8,Oe,4,1,"div",13),a(),i(9,"div",14)(10,"p"),m(11),a()()()}if(n&2){let e=o.$implicit,t=s(2);l(2),p("username",e.username)("avatar",e.avatar)("size","3.5rem"),l(2),p("title",e.displayName),l(),C(e.displayName),l(),p("title",e.username),l(),C("@"+e.username),l(),h(e.id!=t.me().id?8:-1),l(3),C(e.about)}}function Ve(n,o){n&1&&(i(0,"div",17)(1,"h3"),m(2,"No Results Found"),a()())}function Ie(n,o){if(n&1&&(i(0,"div",4)(1,"h3"),m(2,"People"),a(),i(3,"div",16),x(4,ke,12,9,"div",6,M,!1,Ve,3,0,"div",17),a()()),n&2){let e=s();l(4),S(e.userResults())}}function qe(n,o){if(n&1&&d(0,"sns-basic-post",18),n&2){let e=s().$implicit,t=s(2);p("post",e)("user",t.me())}}function Ae(n,o){if(n&1&&d(0,"sns-basic-post",18),n&2){let e=s().$implicit,t=s(2);p("post",e)("user",t.me())}}function Ue(n,o){if(n&1&&d(0,"sns-announcement",18),n&2){let e=s().$implicit,t=s(2);p("post",t.announcement(e))("user",t.me())}}function Be(n,o){if(n&1&&d(0,"sns-comment",18),n&2){let e=s().$implicit,t=s(2);p("post",t.comment(e))("user",t.me())}}function De(n,o){if(n&1&&d(0,"sns-pictorial",18),n&2){let e=s().$implicit,t=s(2);p("post",t.pictorial(e))("user",t.me())}}function je(n,o){if(n&1&&d(0,"sns-article",18),n&2){let e=s().$implicit,t=s(2);p("post",t.article(e))("user",t.me())}}function ze(n,o){if(n&1&&_(0,qe,1,2,"sns-basic-post",18)(1,Ae,1,2,"sns-basic-post",18)(2,Ue,1,2,"sns-announcement",18)(3,Be,1,2,"sns-comment",18)(4,De,1,2,"sns-pictorial",18)(5,je,1,2,"sns-article",18),n&2){let e,t=o.$implicit;h((e=t.type)==="basic"?0:e==="post"?1:e==="announcement"?2:e==="comment"?3:e==="pictorial"?4:e==="article"?5:-1)}}function Le(n,o){n&1&&(i(0,"div",17)(1,"h3"),m(2,"No Results Found"),a()())}function He(n,o){if(n&1&&(i(0,"div",3)(1,"h3"),m(2,"Posts"),a(),i(3,"div",16),x(4,ze,6,1,null,null,M,!1,Le,3,0,"div",17),a()()),n&2){let e=s();l(4),S(e.postResults())}}function Ne(n,o){if(n&1&&d(0,"sns-pictorial",18),n&2){let e=s().$implicit,t=s(2);p("post",t.pictorial(e))("user",t.me())}}function Qe(n,o){if(n&1&&_(0,Ne,1,2,"sns-pictorial",18),n&2){let e,t=o.$implicit;h((e=t.type)==="pictorial"?0:-1)}}function Ge(n,o){n&1&&(i(0,"div",17)(1,"h3"),m(2,"No Results Found"),a()())}function We(n,o){if(n&1&&(i(0,"div",3)(1,"h3"),m(2,"Posts"),a(),i(3,"div",16),x(4,Qe,1,1,null,null,M,!1,Ge,3,0,"div",17),a()()),n&2){let e=s();l(4),S(e.postResults())}}var ge=(()=>{class n{constructor(e,t){this.route=e,this.router=t,this.me=b.required(),this.searchView=b.required(),this.postResults=b.required(),this.userResults=b.required(),this.announcement=ne,this.comment=se,this.pictorial=ie,this.article=oe}ngOnInit(){}follow(e,t){t?.stopPropagation()}unfollow(e,t){t?.stopPropagation()}isFollowing(e){return this.me().follows.includes(e.id)}toProfile(e,t){e?.stopPropagation(),window.getSelection()?.toString().length==0&&this.router.navigate([t],{relativeTo:this.route.parent})}static{this.\u0275fac=function(t){return new(t||n)(g(R),g(F))}}static{this.\u0275cmp=$({type:n,selectors:[["sns-search-content"]],inputs:{me:[1,"me"],searchView:[1,"searchView"],postResults:[1,"postResults"],userResults:[1,"userResults"]},decls:7,vars:2,consts:[["id","sns-search-content"],[1,"sns-search-results"],[1,"user-top"],[1,"post-results"],[1,"user-results"],[1,"top-user-results","search-results"],[1,"sns-follows-user"],[1,"sns-follows-user",3,"click"],[1,"follows-user-info"],[3,"username","avatar","size"],[1,"follows-user-name"],[1,"follows-displayname",3,"title"],[1,"follows-username",3,"title"],[1,"follow"],[1,"follows-about"],["mat-fab","","extended","",1,"follow-btn",3,"click"],[1,"search-results"],[1,"no","results"],[3,"post","user"]],template:function(t,r){if(t&1&&(i(0,"div",0)(1,"div",1),_(2,we,6,0,"div",2)(3,Ee,7,1,"div",3)(4,Ie,7,1,"div",4)(5,He,7,1,"div",3)(6,We,7,1,"div",3),a()()),t&2){let c;l(2),h(r.searchView()=="top"?2:-1),l(),h((c=r.searchView())==="top"?3:c==="people"?4:c==="latest"?5:c==="pictorials"?6:-1)}},dependencies:[k,E,D,O,T,ue,le,pe,me,ce,he],styles:[".follows-header[_ngcontent-%COMP%]{position:sticky;top:0;display:flex;flex-direction:column;gap:1rem;padding:.5rem 0rem 1.5rem;background-color:var(--sns-bg-trans);-webkit-backdrop-filter:blur(.25rem);backdrop-filter:blur(.25rem);z-index:100}.follows-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;padding:.25rem}.back-to-user[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:1rem}.back-to-user[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:var(--sns-hover-color)}.sns-user[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:2rem;margin:auto}.user-info[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;align-items:center;margin:auto;font-size:1.3rem}.displayname[_ngcontent-%COMP%]{font-size:1.75rem;overflow:hidden;text-overflow:ellipsis;margin-right:1rem}.username[_ngcontent-%COMP%]{font-size:1.25rem;color:var(--sns-username-color)}.user-section-group[_ngcontent-%COMP%]{flex:1;border:none;border-radius:0;background-color:var(--sns-bg-trans)}mat-button-toggle[_ngcontent-%COMP%]{color:var(--sns-text-color);width:100%;border:none!important}.sns-follows-user[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-content:center;gap:1.25rem;padding:.5rem .25rem .05rem;border-bottom:1px solid rgba(200,200,200,.25)}.sns-follows-user[_ngcontent-%COMP%]:hover{cursor:pointer;scale:1.01;background-color:var(--sns-hover-color)}.follows-user-info[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:.5rem}.follows-user-name[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.follows-displayname[_ngcontent-%COMP%]{font-size:1.25rem;margin-right:.5rem}.follows-displayname[_ngcontent-%COMP%]:hover{text-decoration:underline}.follows-username[_ngcontent-%COMP%]{font-size:1.15rem;color:var(--sns-username-color)}.follow[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin-left:auto}.follow-btn[_ngcontent-%COMP%]{height:2rem}.displayname[_ngcontent-%COMP%], .follows-displayname[_ngcontent-%COMP%], .follows-username[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;margin-right:1rem}.empty-follows[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:.25rem;margin:auto;justify-content:center;align-items:center;font-size:1.25rem}.empty-name[_ngcontent-%COMP%]{font-size:1.45rem}#sns-search-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-flow:column;gap:1rem}.search-results[_ngcontent-%COMP%]{display:flex;flex-flow:column;gap:1rem}.top-user-results[_ngcontent-%COMP%]{gap:0rem}"]})}}return n})();function Je(n,o){if(n&1&&d(0,"sns-search-content",14),n&2){let e=s();p("me",e.me())("postResults",e.postResults())("userResults",e.userReults())("searchView",e.searchView.value)("loadUntil",!e.loading())}}function Ke(n,o){n&1&&(i(0,"div",15)(1,"h2"),m(2,"Enter a query"),a()())}var Bt=(()=>{class n{constructor(e,t){this.route=e,this.router=t,this.userService=v(ae),this.searchService=v(Ce),this.throttler=new Y,this.searchQuery=new A(""),this.searchView=new A("top"),this.isLoading=!1,this.currentView="top",this.subs=[],this.me=this.userService.me$,this.searchResults=this.searchService.results$,this.postResults=this.searchService.postSearchResults$,this.userReults=this.searchService.userSearchResults$;let r=this.route.queryParams.subscribe(c=>{let u=c.q;u&&(this.searchQuery.setValue(u),this.currentSeach!=u&&this.doSearch(u,this.currentView))});this.subs.push(r)}ngOnInit(){}ngOnDestroy(){for(let e of this.subs)e.unsubscribe()}onScroll(){let e=window.document.documentElement;e.scrollHeight-(e.scrollTop+e.offsetHeight)<Math.min(2e3,e.scrollHeight*.1)&&this.throttler.throttle(()=>{switch(this.isLoading=!1,this.searchView.value){case"top":case"latest":case"pictorials":this.searchService.loadMoreResults("posts");break;case"people":this.searchService.loadMoreResults("users");break}},2e3)}loading(){return this.isLoading&&(this.searchResults.posts.loading||this.searchResults.users.loading)}search(e){let t=this.searchQuery.value;!t||!this.currentView||this.router.navigate(["."],{relativeTo:this.route,queryParams:{q:t}})}switchView(e){let t=e.value,r=this.searchQuery.value;!r||!t||(this.doSearch(r,t),this.currentView=t)}doSearch(e,t){switch(this.isLoading=!0,t){case"top":this.searchService.searchForPosts({before:new Date,sort:"top",type:"any",query:e}),this.searchService.searchForUsers({before:new Date,sort:"top",query:e});break;case"people":this.searchService.searchForUsers({before:new Date,sort:"relevant",query:e});break;case"latest":this.searchService.searchForPosts({before:new Date,sort:"latest",type:"any",query:e});break;case"pictorials":this.searchService.searchForPosts({before:new Date,sort:"latest",type:"pictorial",query:e});break}this.currentSeach=e}static{this.\u0275fac=function(t){return new(t||n)(g(R),g(F))}}static{this.\u0275cmp=$({type:n,selectors:[["sns-search-page"]],hostBindings:function(t,r){t&1&&f("scroll",function(){return r.onScroll()},!1,B)},decls:24,vars:4,consts:[["id","sns-search-page"],[1,"main-content"],[1,"search-search"],[1,"search-container"],["appearance","outline",1,"search-bar"],["matInput","",3,"keydown.enter","formControl"],["matPrefix","","fontIcon","search",1,"search-icon"],[1,"search-bar"],[1,"search-filters"],["value","top",3,"change","formControl"],["value","top",3,"checked"],["value","latest"],["value","people"],["value","pictorials"],["hasLoading","",3,"me","postResults","userResults","searchView","loadUntil"],[1,"no-query"],[1,"side-content"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),m(6,"Search"),a(),i(7,"input",5),f("keydown.enter",function(u){return r.search(u)}),a(),d(8,"mat-icon",6),a()(),i(9,"div",7)(10,"div",8)(11,"mat-button-toggle-group",9),f("change",function(u){return r.switchView(u)}),i(12,"mat-button-toggle",10),m(13,"Top"),a(),i(14,"mat-button-toggle",11),m(15,"Latest"),a(),i(16,"mat-button-toggle",12),m(17,"People"),a(),i(18,"mat-button-toggle",13),m(19,"Pictorials"),a()()()()(),_(20,Je,1,5,"sns-search-content",14)(21,Ke,3,0,"div",15),a(),i(22,"div",16),d(23,"sns-search"),a()()),t&2&&(l(7),p("formControl",r.searchQuery),l(4),p("formControl",r.searchView),l(),p("checked",!0),l(8),h(r.currentSeach?20:21))},dependencies:[k,E,te,Z,ee,J,W,Q,G,O,j,X,K,T,N,z,L,H,_e,de,ge],styles:["#sns-search-page[_ngcontent-%COMP%]{position:relative;display:flex;flex-flow:row nowrap;justify-content:center;width:100%;max-height:100%}.search-search[_ngcontent-%COMP%]{position:sticky;top:0%;z-index:100;background-color:var(--sns-bg-trans);-webkit-backdrop-filter:var(--sns-filter-blur);backdrop-filter:var(--sns-filter-blur);margin-bottom:1.5rem}mat-button-toggle-group[_ngcontent-%COMP%]{width:100%;border:none;border-radius:0}mat-button-toggle[_ngcontent-%COMP%]{color:var(--sns-text-color);width:100%;border:none!important}.search-bar[_ngcontent-%COMP%]{width:100%}.search-icon[_ngcontent-%COMP%]{color:unset}.search-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.no-query[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem}.loading[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;padding-top:10rem}@media (max-width:1080px){.main-content[_ngcontent-%COMP%]{min-width:10rem;padding-right:1rem}.side-content[_ngcontent-%COMP%]{flex:0!important;width:0px!important;min-width:0px!important;visibility:collapse}}"]})}}return n})();export{Bt as SnsSearchPageComponent};
