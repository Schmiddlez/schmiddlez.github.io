import{a as y}from"./chunk-C5RMYWSX.js";import{a as c}from"./chunk-P4ZELJWN.js";import{b as p}from"./chunk-OQ23N4OO.js";import{$ as a,Bc as h,Fa as o,H as n,P as l,ea as i}from"./chunk-UUT3EF6T.js";var m=(()=>{class t{constructor(e){this.http=e,this.baseUrl=c.loa()+"/api",this.options={}}get(e){return this.http.get(this.baseUrl+e,this.options)}post(e,r){return this.http.post(this.baseUrl+e,r,this.options)}delete(e){return this.http.delete(this.baseUrl+e,this.options)}getHttpClient(){return this.http}static{this.\u0275fac=function(r){return new(r||t)(i(p))}}static{this.\u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var $=(()=>{class t{constructor(e,r){this.loaService=e,this.toastService=r,this.MAX_RETRY_COUNT=0,this.DELAY_COUNT=3e3,this.player=o(void 0),this.player$=this.player.asReadonly(),this.me=o(void 0),this.me$=this.me.asReadonly(),this.myCharacters$=h(()=>this.me$()?.characters||[]),this.myServers=o([]),this.myServers$=this.myServers.asReadonly(),this.myRaids$=h(()=>this.myServers$().flatMap(s=>s.raids)),this.myRepeats$=h(()=>this.myServers$().flatMap(s=>s.repeats)),this.refreshMe(),this.loaService.get("/players/@me/servers").pipe(l(this.MAX_RETRY_COUNT),n(this.DELAY_COUNT)).subscribe({next:s=>{this.myServers.set(s)},error:s=>{console.log(s),s.error.message=="Please login again"?this.toastService.show({header:"Error",body:"Please Re-Login / Refresh",type:"danger",source_feature:"loa-assistant",link:"loa-assistant/login",delay:7500}):this.toastService.show({header:"Player",body:"Failed to get player's servers",type:"danger",source_feature:"loa-assistant"})}})}refreshMe(){this.getMe$().pipe(l(this.MAX_RETRY_COUNT),n(this.DELAY_COUNT)).subscribe({next:e=>{this.me.set(e)},error:e=>{console.log(e),this.toastService.show({header:"Player",body:"Failed to get player data",type:"danger",source_feature:"loa-assistant"})}})}updateMe(e){this.me.set(e)}getMe$(){return this.loaService.get("/players/@me")}getPlayer$(e){return this.loaService.get(`/players/${e}`)}setPlayer(e){this.player.set(e)}static{this.\u0275fac=function(r){return new(r||t)(i(m),i(y))}}static{this.\u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();export{m as a,$ as b};
