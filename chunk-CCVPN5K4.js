import{a as Ee,b as ee}from"./chunk-7X72VBHV.js";import{a as ve,b as _e,c as q,d as I,e as Se,g as O,h as Me,i as Pe,j as be}from"./chunk-INS7BFHF.js";import{a as ye,b as Fe}from"./chunk-7KCNP7I7.js";import{a as F}from"./chunk-MOY26VGU.js";import"./chunk-AJP6ELTP.js";import"./chunk-6WBH7IPC.js";import{a as xe,b as Y}from"./chunk-YQT2ZH4O.js";import{j as S}from"./chunk-3PMNG65X.js";import{a as z,b as W,g as Z,h as J,i as K,j as X}from"./chunk-4P6JCT6G.js";import{B as y,C as E,b as $,d as w,f as G,g as j,h as V,j as _,l as B,o as L,p as he,q as fe,r as H,w as Ce,y as U,z as we}from"./chunk-ESTKDGOR.js";import"./chunk-HU7WFQWJ.js";import{a as ge,b}from"./chunk-QCGIDFDQ.js";import{a as P,c as pe,d as v}from"./chunk-RA5YA7SP.js";import{O as ue}from"./chunk-AE4C5XQ6.js";import"./chunk-C5RMYWSX.js";import"./chunk-P4ZELJWN.js";import{d as me}from"./chunk-CG5ODPV4.js";import"./chunk-OQ23N4OO.js";import"./chunk-MB2EZ7OD.js";import{Aa as M,Ba as N,Fa as R,G as se,Ib as p,Ob as f,Pb as ce,Qb as le,Rb as te,Sb as ne,T as re,Tb as s,Ub as o,Vb as C,Xb as k,Zb as g,_b as l,bc as de,cb as a,db as D,fa as u,jc as r,kc as m,ma as Q,na as T,pb as x,tb as ae,wb as h}from"./chunk-UUT3EF6T.js";function ke(n,c){n&1&&(s(0,"mat-hint"),r(1,"Enter your current password"),o())}function Ve(n,c){n&1&&(s(0,"mat-hint"),r(1,"Incorrect password"),o())}function Ae(n,c){if(n&1&&(s(0,"mat-hint"),r(1),o()),n&2){let e=l();a(),m(e.minLengthHint)}}function Re(n,c){if(n&1&&(s(0,"mat-hint"),r(1),o()),n&2){let e=l();a(),m(e.invalidPasswordHint)}}function $e(n,c){if(n&1&&(s(0,"mat-hint"),r(1),o()),n&2){let e=l();a(),m(e.unconfirmedHint)}}var Ie=(()=>{class n{constructor(){this.userService=u(F),this.dialog=u(q),this.data=N.required(),this.onSuccess=M(),this.onFailure=M();let e=new _(void 0,[w.required,w.minLength(8),Pe.invalidPassword()]),t=new _(void 0,[w.required,this.passwordConfirmed(e)]);this.passwordForm=new V({currentPassword:new _(void 0,[w.required]),newPassword:e,confirmPassword:t})}ngOnInit(){}get currentPassword(){return this.passwordForm.controls.currentPassword}get newPassword(){return this.passwordForm.controls.newPassword}get confirmPassword(){return this.passwordForm.controls.confirmPassword}get minLengthHint(){return`Min Length: ${this.newPassword.getError("minlength").requiredLength}`}get invalidPasswordHint(){return`Invalid Character(s): ${this.newPassword.getError("invalidPassword").invalidCharacters.map(t=>`'${t}'`).join(", ")}`}get unconfirmedHint(){return this.confirmPassword.getError("notMatching").value}changePassword(){let e=this.passwordForm.controls.currentPassword.value,t=this.passwordForm.controls.newPassword.value,i=this.passwordForm.controls.confirmPassword.value;this.userService.changePassword$(e,t,i).subscribe({next:d=>this.handleSuccess(d),error:d=>this.handleError(d)})}handleSuccess(e){e.message=="success"?(this.dialog.open(ee,{disableClose:!0,restoreFocus:!1,scrollStrategy:new S,data:{confirmText:"Password has been changed",navText:"Close"}}),this.onSuccess.emit("success")):e.message=="invalid password"&&this.currentPassword.setErrors({incorrectPassword:"incorrect password"})}handleError(e){e.status==403?this.currentPassword.setErrors({incorrectPassword:"incorrect password"}):e.status==400&&this.currentPassword.setErrors({bad:e.error.message}),this.onFailure.emit("failure")}passwordConfirmed(e){return t=>t.value==e.value?null:{notMatching:{value:"Passwords do not match"}}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=x({type:n,selectors:[["change-password"]],inputs:{data:[1,"data"]},outputs:{onSuccess:"onSuccess",onFailure:"onFailure"},decls:26,vars:5,consts:[[1,"change-password",3,"formGroup"],["appearance","outline",1,"settings-input"],["formControlName","currentPassword","type","password","matInput","","maxlength","256","placeholder","Password...","cdkFocusInitial",""],["formControlName","newPassword","type","password","matInput","","maxlength","256","placeholder","Password..."],["formControlName","confirmPassword","type","password","matInput","","maxlength","256","placeholder","Password..."],[1,"change-buttons"],["mat-flat-button","",1,"change-btn","confirm",3,"click","disabled"],["mat-flat-button","","mat-dialog-close","",1,"change-btn","cancel"]],template:function(t,i){t&1&&(s(0,"form",0)(1,"div")(2,"mat-form-field",1)(3,"mat-label"),r(4,"Current Password"),o(),C(5,"input",2),h(6,ke,2,0,"mat-hint")(7,Ve,2,0,"mat-hint"),o()(),s(8,"div")(9,"mat-form-field",1)(10,"mat-label"),r(11,"New Password"),o(),C(12,"input",3),h(13,Ae,2,1,"mat-hint")(14,Re,2,1,"mat-hint"),o()(),s(15,"div")(16,"mat-form-field",1)(17,"mat-label"),r(18,"Confirm Password"),o(),C(19,"input",4),h(20,$e,2,1,"mat-hint"),o()(),s(21,"div",5)(22,"button",6),g("click",function(){return i.changePassword()}),r(23,"Confirm"),o(),s(24,"button",7),r(25,"Cancel"),o()()()),t&2&&(p("formGroup",i.passwordForm),a(6),f(i.currentPassword.hasError("required")?6:i.currentPassword.hasError("incorrectPassword")?7:-1),a(7),f(i.newPassword.hasError("minlength")?13:i.newPassword.hasError("invalidPassword")?14:-1),a(7),f(i.confirmPassword.hasError("notMatching")?20:-1),a(2),p("disabled",i.passwordForm.invalid))},dependencies:[y,B,$,G,j,U,O,I,b,v,P,X,K,Z,z,W,Y,J,E,L,H],styles:[".change-password[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;justify-content:center}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.settings-input[_ngcontent-%COMP%]{width:100%}.change-buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:1rem;justify-content:space-between}.change-btn[_ngcontent-%COMP%]{flex:1;border:2px solid;border-radius:3px}.change-btn[_ngcontent-%COMP%]:hover{background-color:#dcdcdc!important;color:#000}.cancel[_ngcontent-%COMP%]{border-color:#646464;background-color:#646464}.confirm[_ngcontent-%COMP%]{border-color:#4682b4;background-color:#4682b4}"]})}}return n})();function Ge(n,c){n&1&&(s(0,"mat-hint"),r(1,"Enter your current password"),o())}function je(n,c){n&1&&(s(0,"mat-hint"),r(1,"Incorrect password"),o())}function Be(n,c){if(n&1&&(s(0,"mat-option",9),r(1),o()),n&2){let e=l().$index,t=l();p("value",t.myQuestion(e)),a(),m(t.myQuestion(e))}}function Le(n,c){if(n&1&&(s(0,"mat-option",9),r(1),o()),n&2){let e=c.$implicit;p("value",e),a(),m(e)}}function He(n,c){n&1&&(s(0,"mat-hint"),r(1,"Enter answer"),o())}function Ue(n,c){if(n&1){let e=k();s(0,"div",4)(1,"mat-select",8),g("selectionChange",function(){Q(e);let i=l();return T(i.updateRemainingQuestions())}),h(2,Be,2,2,"mat-option",9),te(3,Le,2,2,"mat-option",9,le),o(),s(5,"mat-form-field",1)(6,"mat-label"),r(7,"Answer"),o(),C(8,"input",10),h(9,He,2,0,"mat-hint"),o()()}if(n&2){let e=c.$index,t=l();de("formGroupName",e),a(2),f(t.myQuestion(e)?2:-1),a(),ne(t.remainingQuestions()),a(6),f(-1)}}var Oe=(()=>{class n{constructor(){this.userService=u(F),this.dialog=u(q),this.numberQuestions=Me.NUMBER_REGISTRATION_QUESTIONS,this.questions=N.required(),this.data=N.required(),this.onSuccess=M(),this.onFailure=M(),this.remainingQuestions=R([]);let e=new V({currentPassword:new _(void 0,w.required),questions:new we([])});for(let t=0;t<this.numberQuestions;t++)e.controls.questions.push(new V({question:new _(void 0,{nonNullable:!0,validators:w.required}),answer:new _(void 0,{nonNullable:!0,validators:w.required})}));this.questionsForm=e}ngOnInit(){this.remainingQuestions.set([...this.questions()])}getQuestion(e,t){return t?this.questionsFormArray.at(e).controls.answer:this.questionsFormArray.at(e).controls.question}myQuestion(e){return this.getQuestion(e).value}updateRemainingQuestions(){let e=[...this.questions()];for(let t=0;t<this.numberQuestions;t++){let i=this.getQuestion(t).value,d=e.findIndex(A=>A==i);d>-1&&e.splice(d,1)}this.remainingQuestions.set(e)}changeQuestions(){let e=this.currentPassword.value?this.currentPassword.value.trim():this.currentPassword.value,t=[];for(let i=0;i<this.numberQuestions;i++){let d=this.getQuestion(i).value,A=this.getQuestion(i,!0).value;A&&t.push({question:d,answer:A.trim()})}this.userService.changeQuestions$(e,t).subscribe({next:i=>this.handleSuccess(i),error:i=>this.handleError(i)})}handleSuccess(e){e.message=="success"&&(this.dialog.open(ee,{disableClose:!0,restoreFocus:!1,scrollStrategy:new S,data:{confirmText:"Questions have been changed",navText:"Close"}}),this.onSuccess.emit("success"))}handleError(e){e.status==403?this.currentPassword.setErrors({incorrectPassword:"incorrect password"}):e.status==400&&this.currentPassword.setErrors({bad:e.error.message}),this.onFailure.emit("failure")}get currentPassword(){return this.questionsForm.controls.currentPassword}get questionsFormArray(){return this.questionsForm.get("questions")}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=x({type:n,selectors:[["change-questions"]],inputs:{questions:[1,"questions"],data:[1,"data"]},outputs:{onSuccess:"onSuccess",onFailure:"onFailure"},decls:16,vars:3,consts:[[1,"change-question",3,"formGroup"],["appearance","outline",1,"settings-input"],["formControlName","currentPassword","type","password","matInput","","maxlength","256","placeholder","Password...","cdkFocusInitial",""],["formArrayName","questions",1,"questions"],[1,"input-group",3,"formGroupName"],[1,"change-buttons"],["mat-flat-button","",1,"change-btn","confirm",3,"click","disabled"],["mat-flat-button","","mat-dialog-close","",1,"change-btn","cancel"],["formControlName","question","placeholder","Select a Question","required","",3,"selectionChange"],[3,"value"],["formControlName","answer","type","password","matInput","","maxlength","256","placeholder","Answer...","required",""]],template:function(t,i){t&1&&(s(0,"form",0)(1,"div")(2,"mat-form-field",1)(3,"mat-label"),r(4,"Current Password"),o(),C(5,"input",2),h(6,Ge,2,0,"mat-hint")(7,je,2,0,"mat-hint"),o()(),s(8,"div",3),te(9,Ue,10,3,"div",4,ce),o(),s(11,"div",5)(12,"button",6),g("click",function(){return i.changeQuestions()}),r(13,"Confirm"),o(),s(14,"button",7),r(15,"Cancel"),o()()()),t&2&&(p("formGroup",i.questionsForm),a(6),f(i.currentPassword.hasError("required")?6:i.currentPassword.hasError("incorrectPassword")?7:-1),a(3),ne(i.questionsFormArray.controls),a(3),p("disabled",i.questionsForm.invalid))},dependencies:[y,B,$,G,j,Ce,U,O,I,b,v,P,X,K,Z,z,W,Y,xe,ue,J,E,L,H,he,fe],styles:[".change-question[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;justify-content:center}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.settings-input[_ngcontent-%COMP%]{width:100%}.change-buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:1rem;justify-content:space-between}.change-btn[_ngcontent-%COMP%]{flex:1;border:2px solid;border-radius:3px}.change-btn[_ngcontent-%COMP%]:hover{background-color:#dcdcdc!important;color:#000}.cancel[_ngcontent-%COMP%]{border-color:#646464;background-color:#646464}.confirm[_ngcontent-%COMP%]{border-color:#4682b4;background-color:#4682b4}.questions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}"]})}}return n})();function ze(n,c){if(n&1){let e=k();s(0,"change-password",7),g("onSuccess",function(){Q(e);let i=l();return T(i.onPasswordSuccess())}),o()}if(n&2){let e=l();p("data",e.data)}}function We(n,c){if(n&1){let e=k();s(0,"change-questions",8),g("onSuccess",function(){Q(e);let i=l();return T(i.onQuestionSuccess())}),o()}if(n&2){let e=l();p("questions",e.questions())("data",e.data)}}function Ze(n,c){}var Qe=(()=>{class n extends be{constructor(e,t){super(),this.data=e,this.dialogRef=t,this.invalidRegex=/[^A-Za-z0-9?!@#$%&.?!:;]/,this.questions=R([]),this.data.questions&&(this.questions=this.data.questions)}ngOnInit(){}onQuestionSuccess(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!0})}onPasswordSuccess(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!0})}close(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!1})}get headerTitle(){return`Change ${this.capAllWords(this.data.setting)}`}capAllWords(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.substring(1)).join(" ")}static{this.\u0275fac=function(t){return new(t||n)(D(_e),D(ve))}}static{this.\u0275cmp=x({type:n,selectors:[["change-settings"]],features:[ae],decls:11,vars:2,consts:[[1,"change-settings"],[1,"change-header"],["mat-icon-button","","mat-dialog-close","",1,"change-cancel"],["fontIcon","close"],[1,"change-title"],[3,"data"],[3,"questions","data"],[3,"onSuccess","data"],[3,"onSuccess","questions","data"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"button",2),C(3,"mat-icon",3),o(),s(4,"div",4)(5,"h5"),r(6),o()()(),s(7,"mat-dialog-content"),h(8,ze,1,1,"change-password",5)(9,We,1,2,"change-questions",6)(10,Ze,0,0),o()()),t&2&&(a(6),m(i.headerTitle),a(2),f(i.data.setting=="password"?8:i.data.setting=="questions"?9:i.data.setting=="password-reset"?10:-1))},dependencies:[y,O,I,Se,b,ge,v,pe,E,Oe,Ie],styles:[".change-settings[_ngcontent-%COMP%]{width:100vw;max-width:560px;padding:.1rem 0rem;box-sizing:border-box}.change-header[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:2rem;align-items:center;padding:.5rem 1rem;border-bottom:1px solid rgba(30,30,30,.75)}.change-content[_ngcontent-%COMP%]{padding:.5rem 1rem}.change-title[_ngcontent-%COMP%]{font-size:1.25rem}@media (max-width:600px){.change-settings[_ngcontent-%COMP%]{width:80vw}}"]})}}return n})();var Xt=(()=>{class n{constructor(e){this.router=e,this.userService=u(F),this.userVerifyService=u(Fe),this.sessionService=u(ye),this.dialog=u(q),this.subs=[],this.me=this.userService.me$,this.questions=this.userVerifyService.questions$,this.validSecuredSessionCheck=setInterval(()=>{this.userVerifyService.isSecured$().subscribe(i=>this.securedCheck(i))},1e3*60*1);let t=this.sessionService.securedSession$.pipe(re(1)).subscribe(i=>this.checkSession(i));this.subs.push(t)}ngOnInit(){}ngOnDestroy(){clearInterval(this.validSecuredSessionCheck);for(let e of this.subs)e.unsubscribe()}securedCheck(e){e||this.sessionService.sessionExpired("secured")}checkSession(e){!e&&this.sessionExpiredDialogRef==null&&(this.sessionExpiredDialogRef=this.dialog.open(Ee,{disableClose:!0,restoreFocus:!1,scrollStrategy:new S,data:{session:"secured",state:this.router.routerState.snapshot}}),this.sessionExpiredDialogRef.afterClosed().subscribe(t=>{this.sessionExpiredDialogRef=void 0}))}changeSetting(e){this.dialog.open(Qe,{restoreFocus:!1,scrollStrategy:new S,closeOnNavigation:!0,data:{user:this.me(),setting:e,questions:this.questions}}).afterClosed().pipe(se(1)).subscribe(i=>{i&&i.hasChanged&&console.log(`${e} changed`)})}static{this.\u0275fac=function(t){return new(t||n)(D(me))}}static{this.\u0275cmp=x({type:n,selectors:[["sns-settings"]],decls:34,vars:2,consts:[[1,"main-content"],[1,"sns-settings"],[1,"settings-index"],[1,"settings-content"],[1,"settings-group"],[1,"group-header"],[1,"group-content"],[1,"group-item"],[1,"item-title"],[1,"username"],[1,"displayName"],["mat-flat-button","",1,"change-btn",3,"click"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),r(4,"Profile"),o(),s(5,"div"),r(6,"Account"),o(),s(7,"div"),r(8,"Logout"),o()(),s(9,"div",3)(10,"div",4)(11,"div",5),r(12,"Account Settings"),o(),s(13,"div",6)(14,"div",7)(15,"div",8),r(16,"Username"),o(),s(17,"div",9),r(18),o()(),s(19,"div",7)(20,"div",8),r(21,"Display name"),o(),s(22,"div",10),r(23),o()(),s(24,"div",7)(25,"div",8),r(26,"Password"),o(),s(27,"button",11),g("click",function(){return i.changeSetting("password")}),r(28,"Change Password"),o()(),s(29,"div",7)(30,"div",8),r(31,"Security Questions"),o(),s(32,"button",11),g("click",function(){return i.changeSetting("questions")}),r(33,"Change Questions"),o()()()()()()()),t&2&&(a(18),m("@"+i.me().username),a(5),m(i.me().displayName))},dependencies:[v,P],styles:[".main-content[_ngcontent-%COMP%]{max-width:calc(var(--sns-main-content-max-width) + var(--sns-side-content-max-width))!important}.sns-settings[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:6rem;padding:6rem 0rem}.settings-index[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-end;flex-direction:column;min-width:10rem}.settings-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.group-header[_ngcontent-%COMP%]{font-size:1.75rem;border-bottom:1px solid var(--sns-username-color)}.group-item[_ngcontent-%COMP%]{padding:1rem 2rem;border-bottom:1px solid var(--sns-username-color)}.item-title[_ngcontent-%COMP%]{font-size:1.25rem}.username[_ngcontent-%COMP%]{color:var(--sns-username-color)}.change-btn[_ngcontent-%COMP%]{border-radius:3px}@media (max-width:1080px){.main-content[_ngcontent-%COMP%]{max-width:var(--sns-main-content-max-width)!important;padding-right:1rem}}"]})}}return n})();export{Xt as SnsSettingsComponent};
