import{a as h}from"./chunk-AJP6ELTP.js";import{b as g}from"./chunk-NHPZMVIP.js";import{$,Fa as n,a as l,b as a,r as u}from"./chunk-UUT3EF6T.js";var R=(()=>{class t extends g{static{this.SERVICE_URL="/users"}constructor(){super(t.SERVICE_URL),this.loadingMe=n(!1),this.loadingMe$=this.loadingMe.asReadonly(),this.me=n(h),this.me$=this.me.asReadonly(),this.loadingUser=n(!1),this.loadingUser$=this.loadingUser.asReadonly(),this.user=n(h),this.user$=this.user.asReadonly(),this.refreshMe()}refreshMe(){this.loadingMe.set(!0),this.getMe$().subscribe(e=>{e.customStyles={"border-color":"pink"},this.me.set(e)}).add(()=>this.loadingMe.set(!1))}getMe$(){return this.get$(`${t.SERVICE_URL}/@me`)}changePassword$(e,s,r){return this.post$(`${t.SERVICE_URL}/@me/security/password/update`,{currentPassword:e,newPassword:s,confirmedPassword:r})}changeQuestions$(e,s){let r=this.questionsArrayToMap(s);return this.post$(`${t.SERVICE_URL}/@me/security/questions/reset`,{currentPassword:e,questions:r})}getUserQuestions$(e){return this.post$("/auth/passwordforgot",e)}questionsArrayToMap(e){return e.reduce((s,r)=>(s[r.question]=r.answer,s),{})}updateFollows(...e){let s=this.me().follows;for(let r of e)s.includes(r)||s.push(r);this.me.update(r=>a(l({},r),{follows:s}))}removeFollows(...e){let s=this.me().follows;for(let r of e){let o=s.findIndex(i=>i==r);o>=0&&s.splice(o,1)}this.me.update(r=>a(l({},r),{follows:s}))}updateLikes(e){this.me.update(s=>a(l({},s),{likes:e}))}getUserByUsername$(e){return this.get$(`${t.SERVICE_URL}/${e}?username=true`)}getUserByUsername(e){this.get$(`${t.SERVICE_URL}/${e}?username=true`).subscribe({next:s=>{this.user.set(s)},error:s=>{console.log(s)}})}getUserFollows$(e,s=0){return this.get$(`${t.SERVICE_URL}/${e.id}/follows?page=${s}`)}getUserFollowers$(e,s=0){return this.get$(`${t.SERVICE_URL}/${e.id}/followers?page=${s}`)}getUserAnnouncements$(e){return this.get$(`${t.SERVICE_URL}/${e.id}/announcements`)}getUserComments$(e,s=0){return this.get$(`${t.SERVICE_URL}/${e.id}/comments?page=${s}`)}getUserLikes$(e,s=0){return this.get$(`${t.SERVICE_URL}/${e.id}/likes?page=${s}`)}getUserPostsForProfile$(e,s=0){return this.get$(`${t.SERVICE_URL}/${e.id}/posts/profile?page=${s}`)}getUserFollows(e,s=0,r,o){this.getUserFollows$(e,s).subscribe({next:r,error:i=>this.showToastError(i,"An error while retrieving user's follows.")}).add(o)}getUserFollowers(e,s=0,r,o){this.getUserFollowers$(e,s).subscribe({next:r,error:i=>this.showToastError(i,"An error while retrieving user's followers.")}).add(o)}getUserAnnouncements(e,s,r){this.getUserAnnouncements$(e).subscribe({next:s,error:o=>this.showToastError(o,"An error while retrieving user's announcements.")}).add(r)}getUserComments(e,s=0,r,o){this.getUserComments$(e,s).subscribe({next:r,error:i=>this.showToastError(i,"An error while retrieving user's comments.")}).add(o)}getUserLikes(e,s=0,r,o){this.getUserLikes$(e,s).subscribe({next:r,error:i=>this.showToastError(i,"An error while retrieving user's likes.")}).add(o)}getUserPostsForProfile(e,s=0,r,o){this.getUserPostsForProfile$(e,s).subscribe({next:r,error:i=>this.showToastError(i,"An error while retrieving user's posts.")}).add(o)}followUser$(e){return this.post$(`${t.SERVICE_URL}/follow`,e.id).pipe(u(s=>s.message))}unfollowUser$(e){return this.post$(`${t.SERVICE_URL}/unfollow`,e.id).pipe(u(s=>s.message))}showToastError(e,s){this.toastService.show({header:"Error",body:s,type:"danger",source_feature:"sns"})}static{this.\u0275fac=function(s){return new(s||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();export{R as a};
