import{c as f}from"./chunk-5V4PC647.js";import{Ac as i,Bc as p,da as s,ia as d,j as c,k as a,qa as h,r as l,sa as b}from"./chunk-3AA7O2RR.js";function m(u,e){!e?.injector&&d(m);let r=e?.injector??s(h),t=new a(1),n=p(()=>{let o;try{o=u()}catch(v){i(()=>t.error(v));return}i(()=>t.next(o))},{injector:r,manualCleanup:!0});return r.get(b).onDestroy(()=>{n.destroy(),t.complete()}),t.asObservable()}var g=class{constructor(e,r,t,n){this.oauthUrl=e,this.tokenUrl=r,this.refreshUrl=t,this.logoutUrl=n,this.POPUP_WIDTH=500,this.POPUP_HEIGHT=650,this.http=s(f),this.tokensRecieved=new c(null),this.tokensRecieved$=this.tokensRecieved.asObservable()}login(){this.http.get(`${this.oauthUrl}`,{withCredentials:!0}).subscribe({next:e=>{this.beginExchange(e)},error:e=>{console.log(e)}})}logout$(){return this.http.get(`${this.logoutUrl}`,{withCredentials:!0}).pipe(l(e=>(this.tokensRecieved.next(null),e)))}getTokens$(e){return this.http.get(`${this.tokenUrl}?code=${e}`,{withCredentials:!0})}refreshTokens$(e){return this.http.get(`${this.refreshUrl}?refreshToken=${e}`,{withCredentials:!0})}beginExchange(e){if(e&&e!=""){let r=window.open(e,"popup",`popup=true, width=${this.POPUP_WIDTH}, height=${this.POPUP_HEIGHT}`),t=this.tokensRecieved,n=function(o){o.data.access_token&&(t.next(o.data),window.removeEventListener("message",n))};window.addEventListener("message",n)}}};export{g as a,m as b};
