import{a as at,b as st,c as mt,d as ct,f as lt,g as pt,h as dt,i as gt}from"./chunk-Y3TTJPGN.js";import{a as ut,b as ft,c as ht,d as Ct,e as Mt,f as vt,g as _t,h as Pt}from"./chunk-U54IN6QP.js";import{a as O}from"./chunk-JKNJZGAZ.js";import{a as $,b as B}from"./chunk-GSXTAEMJ.js";import{j as rt}from"./chunk-H2UTJKOZ.js";import{a as Z,b as tt,g as et,h as ot,i as nt,j as it}from"./chunk-N7TBWEAR.js";import{a as A,c as N,d as U}from"./chunk-NPZLEDH6.js";import{b as Q,e as Y,f as G,h as H,j as q,k as J,v as K,y as W,z as X}from"./chunk-HUAPMYXL.js";import{b as V,d as L}from"./chunk-KVX4MIOR.js";import{F as x,Fb as d,Mb as I,Ob as S,Pb as D,Qb as r,Rb as i,Sb as c,Ub as w,Wb as v,Xb as F,Z as b,Za as C,ab as s,ac as E,bb as u,bc as R,cc as T,da as l,fc as j,gc as m,hc as _,ic as P,ka as f,la as h,mb as M,qb as k,uc as z,va as y}from"./chunk-3AA7O2RR.js";var wt=(()=>{class n extends O{static{this.COMMENT_SERVICE_URL="/comments"}constructor(){super(n.COMMENT_SERVICE_URL)}static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var kt=["commentForm"];function It(n,yt){if(n&1){let t=w();r(0,"div",23)(1,"div",29)(2,"button",30),v("click",function(){let e=f(t),a=e.$implicit,p=e.$index,g=F();return h(g.removeMedia(a,p))}),c(3,"mat-icon",6),i()(),c(4,"img",31),i()}if(n&2){let t=yt.$implicit;s(4),d("src",t.data,C)}}var xt=(()=>{class n extends Pt{constructor(t,o){super(),this.data=t,this.dialogRef=o,this.VALID_FILE_TYPES=["image/jpeg","image/apng","image/png","image/webp","image/svg","image/avif","image/gif"].join(","),this.commentService=l(wt),this.media=[],this.selectedMedia=[],this.post=t.post,this.user=t.user}ngOnInit(){}postComment(){let t={id:"",title:this.commentForm.value.title,content:this.commentForm.value.comment,author:this.user,views:0,likes:0,comments:0,created_on:new Date,last_updated_on:new Date,originalPost:this.post,type:"comment"};console.log(t),console.log(this.media);let o=new FormData;o.append("post",new Blob([JSON.stringify(t)],{type:"application/json"})),o.append("media",this.media[0]),this.commentService.newPost$(o).subscribe(e=>{console.log(e),this.dialogRef.close({hasCommented:!0,post:e})})}addMedia(t){if(t.target.files){let o=t.target.files;this.media.push(...o),this.media.forEach((e,a)=>{a>=this.selectedMedia.length&&this.readFile(e,a)})}}removeMedia(t,o){this.media.splice(t.index,1),this.selectedMedia.splice(o,1)}close(){this.dialogRef.close({hasCommented:!1})}readFile(t,o){let e=new FileReader;e.onload=a=>{let p=a.target?.result;if(p){let g={name:t.name,index:o,data:p.toString()};this.selectedMedia.push(g)}},e.readAsDataURL(t)}get date(){return bt.getDate(this.post)}static{this.\u0275fac=function(o){return new(o||n)(u(ft),u(ut))}}static{this.\u0275cmp=M({type:n,selectors:[["compose-comment"]],viewQuery:function(o,e){if(o&1&&E(kt,5),o&2){let a;R(a=T())&&(e.commentForm=a.first)}},features:[k],decls:53,vars:12,consts:[["commentForm","ngForm"],["title",""],["comment",""],[1,"compose-post"],[1,"compose-header"],["mat-icon-button","","mat-dialog-close","",1,"compose-cancel"],["fontIcon","close"],[1,"compose-description"],["appearance","outlined",1,"compose-comment-original-post"],["mat-card-avatar","",3,"src","title"],[1,"post-title",3,"title"],[1,"post-date"],[1,"author-identification"],[1,"author-displayname"],[1,"author-username"],[1,"create-post"],[1,"avatar-wrapper"],[1,"avatar",3,"title","src"],["appearance","outline",1,"compose-input"],["name","title","matInput","","ngModel","","maxlength","256","placeholder","Title...","cdkFocusInitial",""],["name","comment","rich-input","","matInput","","ngModel","","maxlength","256","placeholder","Leave a comment..."],["align","end"],[1,"selected-media-list"],[1,"selected-media"],["title","Add Media",1,"upload-media"],["for","add-image"],["fontIcon","image",1,"upload-label"],["id","add-image","multiple","","type","file",1,"add-file-image",3,"change","accept"],["type","button","mat-button","",3,"click"],[1,"remove-media"],["mat-icon-button","","title","Remove Media",3,"click"],[1,"selected-media-media",3,"src"]],template:function(o,e){if(o&1){let a=w();r(0,"div",3)(1,"div",4)(2,"button",5),c(3,"mat-icon",6),i(),r(4,"div",7)(5,"span"),m(6,"Replying to post"),i()()(),r(7,"mat-card",8)(8,"mat-card-header"),c(9,"img",9),r(10,"mat-card-title",10)(11,"span"),m(12),i()(),r(13,"div",11)(14,"span"),m(15),i()(),r(16,"mat-card-subtitle")(17,"div",12)(18,"span",13),m(19),i(),c(20,"span"),r(21,"span",14),m(22),i()()()(),r(23,"mat-card-content"),m(24),i()(),r(25,"form",null,0)(27,"div",15)(28,"div",16),c(29,"img",17),i(),r(30,"mat-dialog-content")(31,"mat-form-field",18)(32,"mat-label"),m(33,"Title"),i(),c(34,"input",19,1),i(),r(36,"mat-form-field",18)(37,"mat-label"),m(38,"Comment..."),i(),c(39,"textarea",20,2),r(41,"mat-hint",21),m(42),i()(),r(43,"div",22),S(44,It,5,1,"div",23,I),i()()(),r(46,"mat-dialog-actions")(47,"div",24)(48,"label",25),c(49,"mat-icon",26),i(),r(50,"input",27),v("change",function(g){return f(a),h(e.addMedia(g))}),i()(),r(51,"button",28),v("click",function(){return f(a),h(e.postComment())}),m(52,"Done"),i()()()()}if(o&2){let a=j(40);s(9),d("src",e.post.author.avatar,C)("title",e.post.author.username),s(),d("title",e.post.title),s(2),_(e.post.title),s(3),_(e.date),s(4),_(e.post.author.displayName),s(3),P("@",e.post.author.username,""),s(2),P(" ",e.post.content," "),s(5),d("title","avatar")("src",e.user.avatar,C),s(13),P("",a.value.length," / 256"),s(2),D(e.selectedMedia),s(6),d("accept",e.VALID_FILE_TYPES)}},dependencies:[W,J,Q,Y,G,K,q,H,U,A,N,_t,Ct,vt,Mt,X,dt,at,pt,mt,lt,ct,st,ot,et,Z,tt,it,nt,B,$,gt],styles:["mat-card-actions[_ngcontent-%COMP%]{justify-content:end;gap:1rem;padding:0rem 1rem}.post[_ngcontent-%COMP%]{color:#000;border-color:var(--sns-post-border-color);border-radius:5px;overflow:hidden;background-color:var(--sns-post-bg-color)}.post[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:var(--sns-hover-color)}.post-title[_ngcontent-%COMP%], .author-identification[_ngcontent-%COMP%], .post-date[_ngcontent-%COMP%], .post-content[_ngcontent-%COMP%], .post-summary[_ngcontent-%COMP%]{color:var(--sns-post-text-color)}.post-title[_ngcontent-%COMP%]{text-wrap:nowrap;text-overflow:ellipsis;overflow:hidden}.author-identification[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:.5rem}.author-displayname[_ngcontent-%COMP%]{text-wrap:nowrap;text-overflow:ellipsis;overflow:hidden}.author-username[_ngcontent-%COMP%]{text-wrap:nowrap;color:var(--sns-username-color)}.post-media[_ngcontent-%COMP%]{max-height:700px;object-fit:cover}.post-action[_ngcontent-%COMP%]{height:1.75rem;box-shadow:none!important;background-color:transparent;color:var(--sns-post-text-color)}.post-action[_ngcontent-%COMP%]:hover{scale:1.05}.action-like[_ngcontent-%COMP%]{color:var(--sns-like-post-color)}.action-comment[_ngcontent-%COMP%]{color:var(--sns-comment-post-color)}.post-date[_ngcontent-%COMP%]{flex:1;justify-self:end;text-align:end;text-wrap:nowrap}.post-categories[_ngcontent-%COMP%]{flex:1;font-size:.9rem;display:flex;flex-flow:row nowrap;gap:.5rem;text-overflow:ellipsis}.post-categories[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.post-purpose[_ngcontent-%COMP%], .post-topic[_ngcontent-%COMP%], .post-mood[_ngcontent-%COMP%]{padding:.2rem;border:1px solid rgba(0,0,0,35%);border-radius:.3rem}.post-purpose[_ngcontent-%COMP%]{background-color:var(--sns-post-purpose-color)}.post-topic[_ngcontent-%COMP%]{background-color:var(--sns-post-topic-color)}.post-mood[_ngcontent-%COMP%]{background-color:var(--sns-post-mood-color)}.post-footer[_ngcontent-%COMP%]{padding-top:1rem;padding-bottom:.5rem}@media (max-width:1080px){.post-title[_ngcontent-%COMP%]{font-size:1.25rem}.author-identification[_ngcontent-%COMP%], .post-date[_ngcontent-%COMP%]{font-size:.9rem}.post-content[_ngcontent-%COMP%], .post-summary[_ngcontent-%COMP%]{font-size:1rem}.post-action[_ngcontent-%COMP%]{padding:.25rem}}.compose-post[_ngcontent-%COMP%]{--avatar-size: 3rem;min-width:30rem;border-radius:0rem!important}.compose-header[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;justify-content:space-between;align-items:center;padding:.1rem 0rem}.compose-cancel[_ngcontent-%COMP%]{margin:0rem .25rem}.compose-cancel[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-bottom:5px}.compose-description[_ngcontent-%COMP%]{margin:0rem .25rem}.create-post[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:.5rem;align-items:start;padding:.5rem}.avatar-wrapper[_ngcontent-%COMP%]{position:relative;float:left;flex-shrink:0;width:var(--avatar-size);height:var(--avatar-size);margin-top:.75rem;border-radius:100%;overflow:hidden}.avatar[_ngcontent-%COMP%]{width:var(--avatar-size);height:var(--avatar-size);object-fit:cover}.compose-input[_ngcontent-%COMP%]{width:100%}.upload-media[_ngcontent-%COMP%]{position:relative;margin-right:auto}.add-file-image[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:0px;width:0px;overflow:hidden}.upload-label[_ngcontent-%COMP%]:hover{cursor:pointer;scale:1.05}.selected-media-list[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:.5rem}.selected-media[_ngcontent-%COMP%]{position:relative}.selected-media-media[_ngcontent-%COMP%]{height:150px;border:1px solid;border-radius:3px}.remove-media[_ngcontent-%COMP%]{position:absolute;top:.1rem;right:.1rem;border-radius:100%;background-color:#00000080}.remove-media[_ngcontent-%COMP%]:hover{background-color:#00000059}.remove-media[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:red}mat-dialog-content[_ngcontent-%COMP%]{padding:1rem .75rem .25rem!important}mat-dialog-actions[_ngcontent-%COMP%]{padding-top:.25rem!important}@media (max-width:32rem){.compose-post[_ngcontent-%COMP%]{min-width:unset;width:400px}}.compose-comment-original-post[_ngcontent-%COMP%]{border-radius:0rem;border-left:none;border-right:none}.comment-to-original[_ngcontent-%COMP%]{margin-top:1rem;margin-left:.1rem;rotate:90deg;vertical-align:text-bottom;float:left}"]})}}return n})();var bt=(()=>{class n{static{this.day=864e5}static{this.hour=36e5}static{this.minute=6e4}constructor(t){this.postService=t,this.changeRef=l(z),this.dialog=l(ht),this.router=l(L),this.route=l(V),this.onComment=new y}ngOnInit(){}fav(t){t?.stopPropagation(),this.user&&(this.user.likes.findIndex(e=>e==this.post.id)>-1?this.unfavPost():this.favPost())}favPost(){this.postService.favoritePost$(this.post.id).subscribe(t=>{let o=t.message;this.user&&(this.user.likes.push(o),this.post.likes++,this.changeRef.markForCheck())})}unfavPost(){this.postService.unfavoritePost$(this.post.id).subscribe(t=>{let o=t.message;if(this.user){let e=this.user.likes.findIndex(a=>a==o);this.user.likes.splice(e,1),this.post.likes--,this.changeRef.markForCheck()}})}isFav(){if(this.user){for(let t of this.user.likes)if(t==this.post.id)return!0}return!1}commentPost(t){t?.stopPropagation(),this.dialog.open(xt,{restoreFocus:!1,scrollStrategy:new rt,data:{post:this.post,user:this.user}}).afterClosed().pipe(x(1)).subscribe(e=>{e.hasCommented&&(this.post.comments=this.post.comments+1,this.onComment.emit(e.post),this.changeRef.markForCheck())})}toProfile(t){t?.stopPropagation(),this.post&&this.post.author&&this.router.navigate([this.post.author.username],{relativeTo:this.route.parent})}toPost(t){t?.stopPropagation(),this.post&&this.router.navigate(["posts",this.post.id],{relativeTo:this.route.parent})}get date(){return n.getDate(this.post)}static getDate(t){if(!t)return"unknown time";let o=new Date(Date.parse(t.created_on.toString())),e=Date.now()-o.getTime();return e<n.hour?(e/n.minute).toFixed(0)+"min ago":e<n.day?(e/n.hour).toFixed(0)+"hr ago":o.getUTCFullYear()==new Date().getUTCFullYear()?o.toLocaleDateString("locale",{month:"short",day:"numeric"}):o.toLocaleDateString("locale",{month:"short",day:"numeric",year:"numeric"})}static{this.\u0275fac=function(o){return new(o||n)(u(O))}}static{this.\u0275cmp=M({type:n,selectors:[["ng-component"]],inputs:{post:"post",user:"user"},outputs:{onComment:"onComment"},decls:0,vars:0,template:function(o,e){},styles:["mat-card-actions[_ngcontent-%COMP%]{justify-content:end;gap:1rem;padding:0rem 1rem}.post[_ngcontent-%COMP%]{color:#000;border-color:var(--sns-post-border-color);border-radius:5px;overflow:hidden;background-color:var(--sns-post-bg-color)}.post[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:var(--sns-hover-color)}.post-title[_ngcontent-%COMP%], .author-identification[_ngcontent-%COMP%], .post-date[_ngcontent-%COMP%], .post-content[_ngcontent-%COMP%], .post-summary[_ngcontent-%COMP%]{color:var(--sns-post-text-color)}.post-title[_ngcontent-%COMP%]{text-wrap:nowrap;text-overflow:ellipsis;overflow:hidden}.author-identification[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:.5rem}.author-displayname[_ngcontent-%COMP%]{text-wrap:nowrap;text-overflow:ellipsis;overflow:hidden}.author-username[_ngcontent-%COMP%]{text-wrap:nowrap;color:var(--sns-username-color)}.post-media[_ngcontent-%COMP%]{max-height:700px;object-fit:cover}.post-action[_ngcontent-%COMP%]{height:1.75rem;box-shadow:none!important;background-color:transparent;color:var(--sns-post-text-color)}.post-action[_ngcontent-%COMP%]:hover{scale:1.05}.action-like[_ngcontent-%COMP%]{color:var(--sns-like-post-color)}.action-comment[_ngcontent-%COMP%]{color:var(--sns-comment-post-color)}.post-date[_ngcontent-%COMP%]{flex:1;justify-self:end;text-align:end;text-wrap:nowrap}.post-categories[_ngcontent-%COMP%]{flex:1;font-size:.9rem;display:flex;flex-flow:row nowrap;gap:.5rem;text-overflow:ellipsis}.post-categories[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.post-purpose[_ngcontent-%COMP%], .post-topic[_ngcontent-%COMP%], .post-mood[_ngcontent-%COMP%]{padding:.2rem;border:1px solid rgba(0,0,0,35%);border-radius:.3rem}.post-purpose[_ngcontent-%COMP%]{background-color:var(--sns-post-purpose-color)}.post-topic[_ngcontent-%COMP%]{background-color:var(--sns-post-topic-color)}.post-mood[_ngcontent-%COMP%]{background-color:var(--sns-post-mood-color)}.post-footer[_ngcontent-%COMP%]{padding-top:1rem;padding-bottom:.5rem}@media (max-width:1080px){.post-title[_ngcontent-%COMP%]{font-size:1.25rem}.author-identification[_ngcontent-%COMP%], .post-date[_ngcontent-%COMP%]{font-size:.9rem}.post-content[_ngcontent-%COMP%], .post-summary[_ngcontent-%COMP%]{font-size:1rem}.post-action[_ngcontent-%COMP%]{padding:.25rem}}"]})}}return n})();export{wt as a,bt as b};
