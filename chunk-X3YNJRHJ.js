import{a as _}from"./chunk-YIJK7SBS.js";import{c as N}from"./chunk-ZUWKRBQH.js";import{b as w,e as T,f as V,g as P,i as S,m as O,n as k,p as j,v as M,y as C}from"./chunk-4B4OTB3X.js";import"./chunk-7WIWJOLM.js";import{$a as n,Db as u,Jb as G,Kb as $,Lb as F,Mb as x,Nb as o,Ob as s,Pb as y,Tb as b,Ub as f,Ya as D,ab as g,dc as l,ec as d,fc as E,lb as v,sb as A}from"./chunk-6543YJRO.js";function U(i,c){if(i&1&&(y(0,"img",4),o(1,"span",5),l(2),s(),o(3,"span",6),l(4),s()),i&2){let t=f();u("src",t.characterImage,D),n(2),d(t.characterInfo),n(2),d(t.playerInfo)}}function q(i,c){if(i&1&&(o(0,"span",3),l(1),s()),i&2){let t=f();n(),d(t.display)}}var L=(()=>{class i{constructor(t){this.groupEditService=t,this.valueChanged=!1,this.subs=[],this.display="Empty Slot"}ngOnInit(){this.input.value&&(this.character=this.available.find(r=>r.id==this.input.value),this.character&&(this.fillDisplayValue(),this.assignCharacter(),this.initalCharacter=this.character));var t=this.groupEditService.resetEvent$.subscribe(r=>{r&&this.reset()}),e=this.groupEditService.saveEvent$.subscribe(r=>{r&&(this.initalCharacter=this.character)});this.subs.push(t,e)}ngOnDestroy(){for(let t of this.subs)t.unsubscribe()}get characterInfo(){return`${this.character?.name} - ${this.character?.itemlevel}`}get playerInfo(){return this.character?.player.name}reset(){this.character=this.initalCharacter,this.character?(this.fillDisplayValue(),this.assignCharacter()):(this.display="Empty Slot",this.characterImage="",this.input.reset(""))}focused(){this.valueChanged=!1,this.character&&this.input.setValue(this.character.name),this.display=this.input.value,this.characterImage="",this.unassignCharacter()}typing(){this.display=this.input.value}changed(){this.valueChanged=!0,this.setDisplay()}blurred(){this.valueChanged||this.setDisplay()}setDisplay(){this.input.setValue(this.input.value.trim());var t=this.input.value.trim().toLowerCase();if(t){if(this.character=this.raidpost.signups.find(r=>r.name.toLowerCase()==t),!this.character){var e=this.available.filter(r=>r.name.toLowerCase().includes(t));e.length==1&&(this.character=e[0])}this.character&&(this.fillDisplayValue(),this.assignCharacter(),this.input.setValue(this.character.id))}this.display.length===0&&(this.display="Empty Slot")}fillDisplayValue(){this.character&&(this.display=`${this.character.name} | ${this.character.player.name}`,this.characterImage=N(this.character.loaClass))}assignCharacter(){if(this.character){var t=this.available.findIndex(e=>e.id==this.character?.id);t>-1&&this.available.splice(t,1)}}unassignCharacter(){if(this.character){var t=this.available.findIndex(e=>e.id==this.character?.id);t<=-1&&this.available.push(this.character),this.character=void 0}}static{this.\u0275fac=function(e){return new(e||i)(g(_))}}static{this.\u0275cmp=v({type:i,selectors:[["member-input"]],inputs:{raidpost:"raidpost",available:"available",input:"input"},decls:5,vars:3,consts:[[1,"member-input","position-relative","h-5r",3,"title"],["list","raidSignups",1,"input-member","position-absolute","top-0","form-control",3,"focus","input","change","blur","formControl"],[1,"output-member","position-relative","top-0","d-flex","flex-nowrap","gap-2"],[1,"member-display"],[1,"member-img",3,"src"],[1,"member-display","text-truncate"],[1,"member-display","flex-grow-1","text-end"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"input",1),b("focus",function(){return r.focused()})("input",function(){return r.typing()})("change",function(){return r.changed()})("blur",function(){return r.blurred()}),s(),o(2,"div",2),A(3,U,5,3)(4,q,2,1,"span",3),s()()),e&2&&(u("title",r.character?r.characterInfo+" | "+r.playerInfo:""),n(),u("formControl",r.input),n(2),G(r.character?3:4))},dependencies:[C,w,T,O],styles:[".input-member[_ngcontent-%COMP%]{color:transparent;caret-color:#000;background-color:var(--discord-menu-text)}.output-member[_ngcontent-%COMP%]{color:#000;pointer-events:none!important;background-color:transparent;padding:.375rem .75rem;text-align:start}.member-img[_ngcontent-%COMP%]{height:1.8rem;margin-right:.2rem}"]})}}return i})();var H=(i,c)=>c.value;function J(i,c){if(i&1&&(o(0,"div",10),y(1,"member-input",11),s()),i&2){let t=c.$implicit,e=f(2);n(),u("raidpost",e.raidpost)("available",e.available)("input",t)}}function K(i,c){if(i&1&&(o(0,"div",7)(1,"h6"),l(2),s(),o(3,"div",9),F(4,J,2,3,"div",10,$),s()()),i&2){let t=c.$implicit,e=c.$index;u("formArrayName",e),n(2),E("Party ",e+1,""),n(2),x(t.controls)}}var tt=(()=>{class i{constructor(t){this.groupEditService=t,this.membersPerParty=4,this.groupForm=new P({}),this.subs=[]}ngOnInit(){this.initializeForms(),this.groupForm.setControl("groupId",new S(this.group.id)),this.groupForm.setControl("partys",this.partyForms),this.groupsFormArray.push(this.groupForm);var t=this.groupEditService.resetEvent$.subscribe(e=>{e&&this.reset()});this.subs.push(t)}ngOnDestroy(){for(let t of this.subs)t.unsubscribe()}initializeForms(){let t=this.raidpost.properties.playerCount;this.partyForms=new M([]);for(let e=1;e<=t/4;e++){let r=new M([]);for(let a=1;a<=this.membersPerParty;a++)r.push(new S(""));this.partyForms.push(r)}for(let e=0;e<this.group.parties.length;e++){let r=this.group.parties[e];for(let a=0;a<r.members.length;a++)this.setControlValue(this.partyForms.controls[e].controls[a],r.members[a])}}reset(){this.groupsFormArray.value.find(t=>t.groupId==this.groupForm.controls.groupId.value)||this.groupsFormArray.push(this.groupForm)}get average(){var t=0,e=0;for(let m=0;m<this.partyForms.controls.length;m++){var r=this.partyForms.controls[m];for(let p=0;p<r.controls.length;p++){var a=r.controls[p].value;let h=this.raidpost.signups.find(I=>I.id==a);h&&(t++,e+=h.itemlevel)}}return(e/t).toFixed(2)}getIdString(t,e){return`group-${this.group.id}-party-${t}-member-${e}`}deleteGroup(){var t=this.groupsFormArray.controls.findIndex(p=>p.get("groupId")?.value==this.group.id),e=this.raidpost.groups.findIndex(p=>p.id==this.group.id);for(let p=0;p<this.partyForms.controls.length;p++){var r=this.partyForms.controls[p];for(let h=0;h<r.controls.length;h++){var a=r.controls[h].value,m=this.raidpost.signups.find(I=>I.id==a);m&&this.available.push(m)}}t>-1&&this.groupsFormArray.removeAt(t),e>-1&&this.raidpost.groups.splice(e,1)}setControlValue(t,e){t.setValue(e.id)}assignCharacter(t){var e=this.available.findIndex(r=>r.id==t?.id);e>-1&&this.available.splice(e,1)}static{this.\u0275fac=function(e){return new(e||i)(g(_))}}static{this.\u0275cmp=v({type:i,selectors:[["group-edit"]],inputs:{raidpost:"raidpost",group:"group",groupsFormArray:"groupsFormArray",available:"available"},decls:13,vars:3,consts:[[1,"raid-edit-group","card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"group-name"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"card-body"],[3,"formGroup"],["formArrayName","partys",1,"row"],[1,"group-party","col-6","text-center",3,"formArrayName"],[1,"card-footer"],[1,"party-member-list","d-flex","flex-column","gap-2"],[1,"form-floating"],[3,"raidpost","available","input"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),l(3),s(),o(4,"button",3),b("click",function(){return r.deleteGroup()}),l(5,"Delete Group"),s()(),o(6,"div",4)(7,"div",5)(8,"div",6),F(9,K,6,2,"div",7,H),s()()(),o(11,"div",8),l(12),s()()),e&2&&(n(3),d(r.group.name),n(4),u("formGroup",r.groupForm),n(2),x(r.partyForms.controls),n(3),E(" Average Level: ",r.average," "))},dependencies:[C,V,k,j,L],styles:[".raid-edit-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:var(--discord-type)}"]})}}return i})();export{tt as GroupEditComponent};
