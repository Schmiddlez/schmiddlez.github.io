import{b as Ee,c as Fe,d as ee}from"./chunk-53IPGW7G.js";import{a as qe}from"./chunk-NR7K7WWT.js";import{a as F}from"./chunk-4SU4UW77.js";import"./chunk-AJP6ELTP.js";import{a as _e,b as xe,c as q,d as I,e as Se,g as O,h as Me,i as Pe,j as be}from"./chunk-QKYLMYUG.js";import"./chunk-HPQ4FWEG.js";import{a as ye}from"./chunk-Q7GYF4UI.js";import{a as we,b as ve,c as Y}from"./chunk-LCBHDNMZ.js";import"./chunk-MAA5GSAZ.js";import{o as S}from"./chunk-OG2F7MK6.js";import{a as z,b as W,g as Z,j as J,k as K,l as X}from"./chunk-CVYHWQ3C.js";import{A as U,C as y,D as E,b as $,d as w,f as G,g as L,i as V,k as x,m as j,o as ge,q as he,r as fe,s as B,t as H,y as Ce}from"./chunk-XT72EIBI.js";import{a as pe,b}from"./chunk-WRSMBKFW.js";import{F as ue,H as P,J as _}from"./chunk-KCLKHEQV.js";import"./chunk-RVDJVD4K.js";import"./chunk-EJWSQFFV.js";import"./chunk-JLWIDV3F.js";import{e as me}from"./chunk-E7SDSQEU.js";import"./chunk-KE4LITEF.js";import"./chunk-76PGFOOU.js";import{Dc as le,K as re,Rb as h,Sb as f,Tb as ce,Tc as M,Ub as de,Uc as k,V as se,Vb as te,Wb as ne,Xb as m,Yb as r,Zb as o,_b as C,db as a,dc as D,fc as u,ha as g,hc as d,ma as N,mb as T,na as Q,ub as v,wc as s,xc as p,ya as A,zb as ae}from"./chunk-W56RDURX.js";function ke(n,c){n&1&&(r(0,"mat-hint"),s(1,"Enter your current password"),o())}function Ve(n,c){n&1&&(r(0,"mat-hint"),s(1,"Incorrect password"),o())}function Re(n,c){if(n&1&&(r(0,"mat-hint"),s(1),o()),n&2){let e=d();a(),p(e.minLengthHint)}}function Ae(n,c){if(n&1&&(r(0,"mat-hint"),s(1),o()),n&2){let e=d();a(),p(e.invalidPasswordHint)}}function $e(n,c){if(n&1&&(r(0,"mat-hint"),s(1),o()),n&2){let e=d();a(),p(e.unconfirmedHint)}}var Oe=(()=>{class n{constructor(){this.userService=g(F),this.dialog=g(q),this.data=k.required(),this.onSuccess=M(),this.onFailure=M();let e=new x(void 0,[w.required,w.minLength(8),Pe.invalidPassword()]),t=new x(void 0,[w.required,this.passwordConfirmed(e)]);this.passwordForm=new V({currentPassword:new x(void 0,[w.required]),newPassword:e,confirmPassword:t})}ngOnInit(){}get currentPassword(){return this.passwordForm.controls.currentPassword}get newPassword(){return this.passwordForm.controls.newPassword}get confirmPassword(){return this.passwordForm.controls.confirmPassword}get minLengthHint(){return`Min Length: ${this.newPassword.getError("minlength").requiredLength}`}get invalidPasswordHint(){return`Invalid Character(s): ${this.newPassword.getError("invalidPassword").invalidCharacters.map(t=>`'${t}'`).join(", ")}`}get unconfirmedHint(){return this.confirmPassword.getError("notMatching").value}changePassword(){let e=this.passwordForm.controls.currentPassword.value,t=this.passwordForm.controls.newPassword.value,i=this.passwordForm.controls.confirmPassword.value;this.userService.changePassword$(e,t,i).subscribe({next:l=>this.handleSuccess(l),error:l=>this.handleError(l)})}handleSuccess(e){e.message=="success"?(this.dialog.open(ee,{disableClose:!0,restoreFocus:!1,scrollStrategy:new S,data:{confirmText:"Password has been changed",navText:"Close"}}),this.onSuccess.emit("success")):e.message=="invalid password"&&this.currentPassword.setErrors({incorrectPassword:"incorrect password"})}handleError(e){e.status==403?this.currentPassword.setErrors({incorrectPassword:"incorrect password"}):e.status==400&&this.currentPassword.setErrors({bad:e.error.message}),this.onFailure.emit("failure")}passwordConfirmed(e){return t=>t.value==e.value?null:{notMatching:{value:"Passwords do not match"}}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=v({type:n,selectors:[["change-password"]],inputs:{data:[1,"data"]},outputs:{onSuccess:"onSuccess",onFailure:"onFailure"},decls:26,vars:5,consts:[[1,"change-password",3,"formGroup"],["appearance","outline",1,"settings-input"],["formControlName","currentPassword","type","password","matInput","","maxlength","256","placeholder","Password...","cdkFocusInitial",""],["formControlName","newPassword","type","password","matInput","","maxlength","256","placeholder","Password..."],["formControlName","confirmPassword","type","password","matInput","","maxlength","256","placeholder","Password..."],[1,"change-buttons"],["mat-flat-button","",1,"change-btn","confirm",3,"click","disabled"],["mat-flat-button","","mat-dialog-close","",1,"change-btn","cancel"]],template:function(t,i){t&1&&(r(0,"form",0)(1,"div")(2,"mat-form-field",1)(3,"mat-label"),s(4,"Current Password"),o(),C(5,"input",2),h(6,ke,2,0,"mat-hint")(7,Ve,2,0,"mat-hint"),o()(),r(8,"div")(9,"mat-form-field",1)(10,"mat-label"),s(11,"New Password"),o(),C(12,"input",3),h(13,Re,2,1,"mat-hint")(14,Ae,2,1,"mat-hint"),o()(),r(15,"div")(16,"mat-form-field",1)(17,"mat-label"),s(18,"Confirm Password"),o(),C(19,"input",4),h(20,$e,2,1,"mat-hint"),o()(),r(21,"div",5)(22,"button",6),u("click",function(){return i.changePassword()}),s(23,"Confirm"),o(),r(24,"button",7),s(25,"Cancel"),o()()()),t&2&&(m("formGroup",i.passwordForm),a(6),f(i.currentPassword.hasError("required")?6:i.currentPassword.hasError("incorrectPassword")?7:-1),a(7),f(i.newPassword.hasError("minlength")?13:i.newPassword.hasError("invalidPassword")?14:-1),a(7),f(i.confirmPassword.hasError("notMatching")?20:-1),a(2),m("disabled",i.passwordForm.invalid))},dependencies:[y,j,$,G,L,U,O,I,b,_,P,X,K,Z,z,W,Y,J,E,H,B],styles:[".change-password[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;justify-content:center}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.settings-input[_ngcontent-%COMP%]{width:100%}.change-buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:1rem;justify-content:space-between}.change-btn[_ngcontent-%COMP%]{flex:1;border:2px solid;border-radius:3px}.change-btn[_ngcontent-%COMP%]:hover{background-color:#dcdcdc!important;color:#000}.cancel[_ngcontent-%COMP%]{border-color:#646464;background-color:#646464}.confirm[_ngcontent-%COMP%]{border-color:#4682b4;background-color:#4682b4}"]})}}return n})();function Ge(n,c){n&1&&(r(0,"mat-hint"),s(1,"Enter your current password"),o())}function Le(n,c){n&1&&(r(0,"mat-hint"),s(1,"Incorrect password"),o())}function je(n,c){if(n&1&&(r(0,"mat-option",9),s(1),o()),n&2){let e=d().$index,t=d();m("value",t.myQuestion(e)),a(),p(t.myQuestion(e))}}function Be(n,c){if(n&1&&(r(0,"mat-option",9),s(1),o()),n&2){let e=c.$implicit;m("value",e),a(),p(e)}}function He(n,c){n&1&&(r(0,"mat-hint"),s(1,"Enter answer"),o())}function Ue(n,c){if(n&1){let e=D();r(0,"div",4)(1,"mat-select",8),u("selectionChange",function(){N(e);let i=d();return Q(i.updateRemainingQuestions())}),h(2,je,2,2,"mat-option",9),te(3,Be,2,2,"mat-option",9,de),o(),r(5,"mat-form-field",1)(6,"mat-label"),s(7,"Answer"),o(),C(8,"input",10),h(9,He,2,0,"mat-hint"),o()()}if(n&2){let e=c.$index,t=d();m("formGroupName",le(e)),a(2),f(t.myQuestion(e)?2:-1),a(),ne(t.remainingQuestions()),a(6),f(-1)}}var Ne=(()=>{class n{constructor(){this.userService=g(F),this.dialog=g(q),this.numberQuestions=Me.NUMBER_REGISTRATION_QUESTIONS,this.questions=k.required(),this.data=k.required(),this.onSuccess=M(),this.onFailure=M(),this.remainingQuestions=A([]);let e=new V({currentPassword:new x(void 0,w.required),questions:new ge([])});for(let t=0;t<this.numberQuestions;t++)e.controls.questions.push(new V({question:new x(void 0,{nonNullable:!0,validators:w.required}),answer:new x(void 0,{nonNullable:!0,validators:w.required})}));this.questionsForm=e}ngOnInit(){this.remainingQuestions.set([...this.questions()])}getQuestion(e,t){return t?this.questionsFormArray.at(e).controls.answer:this.questionsFormArray.at(e).controls.question}myQuestion(e){return this.getQuestion(e).value}updateRemainingQuestions(){let e=[...this.questions()];for(let t=0;t<this.numberQuestions;t++){let i=this.getQuestion(t).value,l=e.findIndex(R=>R==i);l>-1&&e.splice(l,1)}this.remainingQuestions.set(e)}changeQuestions(){let e=this.currentPassword.value?this.currentPassword.value.trim():this.currentPassword.value,t=[];for(let i=0;i<this.numberQuestions;i++){let l=this.getQuestion(i).value,R=this.getQuestion(i,!0).value;R&&t.push({question:l,answer:R.trim()})}this.userService.changeQuestions$(e,t).subscribe({next:i=>this.handleSuccess(i),error:i=>this.handleError(i)})}handleSuccess(e){e.message=="success"&&(this.dialog.open(ee,{disableClose:!0,restoreFocus:!1,scrollStrategy:new S,data:{confirmText:"Questions have been changed",navText:"Close"}}),this.onSuccess.emit("success"))}handleError(e){e.status==403?this.currentPassword.setErrors({incorrectPassword:"incorrect password"}):e.status==400&&this.currentPassword.setErrors({bad:e.error.message}),this.onFailure.emit("failure")}get currentPassword(){return this.questionsForm.controls.currentPassword}get questionsFormArray(){return this.questionsForm.get("questions")}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=v({type:n,selectors:[["change-questions"]],inputs:{questions:[1,"questions"],data:[1,"data"]},outputs:{onSuccess:"onSuccess",onFailure:"onFailure"},decls:16,vars:3,consts:[[1,"change-question",3,"formGroup"],["appearance","outline",1,"settings-input"],["formControlName","currentPassword","type","password","matInput","","maxlength","256","placeholder","Password...","cdkFocusInitial",""],["formArrayName","questions",1,"questions"],[1,"input-group",3,"formGroupName"],[1,"change-buttons"],["mat-flat-button","",1,"change-btn","confirm",3,"click","disabled"],["mat-flat-button","","mat-dialog-close","",1,"change-btn","cancel"],["formControlName","question","placeholder","Select a Question","required","",3,"selectionChange"],[3,"value"],["formControlName","answer","type","password","matInput","","maxlength","256","placeholder","Answer...","required",""]],template:function(t,i){t&1&&(r(0,"form",0)(1,"div")(2,"mat-form-field",1)(3,"mat-label"),s(4,"Current Password"),o(),C(5,"input",2),h(6,Ge,2,0,"mat-hint")(7,Le,2,0,"mat-hint"),o()(),r(8,"div",3),te(9,Ue,10,4,"div",4,ce),o(),r(11,"div",5)(12,"button",6),u("click",function(){return i.changeQuestions()}),s(13,"Confirm"),o(),r(14,"button",7),s(15,"Cancel"),o()()()),t&2&&(m("formGroup",i.questionsForm),a(6),f(i.currentPassword.hasError("required")?6:i.currentPassword.hasError("incorrectPassword")?7:-1),a(3),ne(i.questionsFormArray.controls),a(3),m("disabled",i.questionsForm.invalid))},dependencies:[y,j,$,G,L,Ce,U,O,I,b,_,P,X,K,Z,z,W,Y,ve,we,J,E,H,B,he,fe],styles:[".change-question[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;justify-content:center}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.settings-input[_ngcontent-%COMP%]{width:100%}.change-buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:1rem;justify-content:space-between}.change-btn[_ngcontent-%COMP%]{flex:1;border:2px solid;border-radius:3px}.change-btn[_ngcontent-%COMP%]:hover{background-color:#dcdcdc!important;color:#000}.cancel[_ngcontent-%COMP%]{border-color:#646464;background-color:#646464}.confirm[_ngcontent-%COMP%]{border-color:#4682b4;background-color:#4682b4}.questions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}"]})}}return n})();function ze(n,c){if(n&1){let e=D();r(0,"change-password",7),u("onSuccess",function(){N(e);let i=d();return Q(i.onPasswordSuccess())}),o()}if(n&2){let e=d();m("data",e.data)}}function We(n,c){if(n&1){let e=D();r(0,"change-questions",8),u("onSuccess",function(){N(e);let i=d();return Q(i.onQuestionSuccess())}),o()}if(n&2){let e=d();m("questions",e.questions())("data",e.data)}}function Ze(n,c){}var Qe=(()=>{class n extends be{constructor(e,t){super(),this.data=e,this.dialogRef=t,this.invalidRegex=/[^A-Za-z0-9?!@#$%&.?!:;]/,this.questions=A([]),this.data.questions&&(this.questions=this.data.questions)}ngOnInit(){}onQuestionSuccess(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!0})}onPasswordSuccess(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!0})}close(){this.dialogRef.close({setting:this.data.setting,user:this.data.user,hasChanged:!1})}get headerTitle(){return`Change ${this.capAllWords(this.data.setting)}`}capAllWords(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.substring(1)).join(" ")}static{this.\u0275fac=function(t){return new(t||n)(T(xe),T(_e))}}static{this.\u0275cmp=v({type:n,selectors:[["change-settings"]],features:[ae],decls:11,vars:2,consts:[[1,"change-settings"],[1,"change-header"],["mat-icon-button","","mat-dialog-close","",1,"change-cancel"],["fontIcon","close"],[1,"change-title"],[3,"data"],[3,"questions","data"],[3,"onSuccess","data"],[3,"onSuccess","questions","data"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),C(3,"mat-icon",3),o(),r(4,"div",4)(5,"h5"),s(6),o()()(),r(7,"mat-dialog-content"),h(8,ze,1,1,"change-password",5)(9,We,1,2,"change-questions",6)(10,Ze,0,0),o()()),t&2&&(a(6),p(i.headerTitle),a(2),f(i.data.setting=="password"?8:i.data.setting=="questions"?9:i.data.setting=="password-reset"?10:-1))},dependencies:[y,O,I,Se,b,pe,_,ue,E,Ne,Oe],styles:[".change-settings[_ngcontent-%COMP%]{width:100vw;max-width:560px;padding:.1rem 0rem;box-sizing:border-box}.change-header[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:2rem;align-items:center;padding:.5rem 1rem;border-bottom:1px solid rgba(30,30,30,.75)}.change-content[_ngcontent-%COMP%]{padding:.5rem 1rem}.change-title[_ngcontent-%COMP%]{font-size:1.25rem}@media(max-width:600px){.change-settings[_ngcontent-%COMP%]{width:80vw}}"]})}}return n})();var Xt=(()=>{class n{constructor(e){this.router=e,this.userService=g(F),this.userVerifyService=g(qe),this.sessionService=g(ye),this.dialog=g(q),this.subs=[],this.me=this.userService.me$,this.questions=this.userVerifyService.questions$,this.validSecuredSessionCheck=setInterval(()=>{this.userVerifyService.isSecured$().subscribe(i=>this.securedCheck(i))},1e3*60*1);let t=this.sessionService.securedSession$.pipe(se(1)).subscribe(i=>this.checkSession(i));this.subs.push(t)}ngOnInit(){}ngOnDestroy(){clearInterval(this.validSecuredSessionCheck);for(let e of this.subs)e.unsubscribe()}securedCheck(e){e||this.sessionService.sessionExpired("secured")}checkSession(e){!e&&this.sessionExpiredDialogRef==null&&(this.sessionExpiredDialogRef=this.dialog.open(Fe,{disableClose:!0,restoreFocus:!1,scrollStrategy:new S,data:{session:"secured",state:this.router.routerState.snapshot}}),this.sessionExpiredDialogRef.afterClosed().subscribe(t=>{this.sessionExpiredDialogRef=void 0}))}changeSetting(e){this.dialog.open(Qe,{restoreFocus:!1,scrollStrategy:new S,closeOnNavigation:!0,data:{user:this.me(),setting:e,questions:this.questions}}).afterClosed().pipe(re(1)).subscribe(i=>{i&&i.hasChanged&&console.log(`${e} changed`)})}promptLogout(){this.dialog.open(Ee,{disableClose:!0,restoreFocus:!1,scrollStrategy:new S,data:{state:this.router.routerState.snapshot}})}static{this.\u0275fac=function(t){return new(t||n)(T(me))}}static{this.\u0275cmp=v({type:n,selectors:[["sns-settings"]],decls:30,vars:2,consts:[[1,"main-content"],[1,"sns-settings"],[1,"settings-index"],[1,"hover-click",3,"click"],[1,"settings-content"],[1,"settings-group"],[1,"group-header"],[1,"group-content"],[1,"group-item"],[1,"item-title"],[1,"username"],[1,"displayName"],["mat-flat-button","",1,"change-btn",3,"click"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),u("click",function(){return i.promptLogout()}),s(4,"Logout"),o()(),r(5,"div",4)(6,"div",5)(7,"div",6),s(8,"Account Settings"),o(),r(9,"div",7)(10,"div",8)(11,"div",9),s(12,"Username"),o(),r(13,"div",10),s(14),o()(),r(15,"div",8)(16,"div",9),s(17,"Display name"),o(),r(18,"div",11),s(19),o()(),r(20,"div",8)(21,"div",9),s(22,"Password"),o(),r(23,"button",12),u("click",function(){return i.changeSetting("password")}),s(24,"Change Password"),o()(),r(25,"div",8)(26,"div",9),s(27,"Security Questions"),o(),r(28,"button",12),u("click",function(){return i.changeSetting("questions")}),s(29,"Change Questions"),o()()()()()()()),t&2&&(a(14),p("@"+i.me().username),a(5),p(i.me().displayName))},dependencies:[_,P],styles:[".main-content[_ngcontent-%COMP%]{max-width:calc(var(--sns-main-content-max-width) + var(--sns-side-content-max-width))!important}.sns-settings[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;gap:6rem;padding:6rem 0rem}.settings-index[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-end;flex-direction:column;min-width:10rem}.settings-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.group-header[_ngcontent-%COMP%]{font-size:1.75rem;border-bottom:1px solid var(--sns-username-color)}.group-item[_ngcontent-%COMP%]{padding:1rem 2rem;border-bottom:1px solid var(--sns-username-color)}.item-title[_ngcontent-%COMP%]{font-size:1.25rem}.username[_ngcontent-%COMP%]{color:var(--sns-username-color)}.change-btn[_ngcontent-%COMP%]{border-radius:3px}.hover-click[_ngcontent-%COMP%]{cursor:pointer}@media(max-width:1080px){.main-content[_ngcontent-%COMP%]{max-width:var(--sns-main-content-max-width)!important;padding-right:1rem}}"]})}}return n})();export{Xt as SnsSettingsComponent};
